!function a(i,o,r){function n(t,e){if(!o[t]){if(!i[t]){var s="function"==typeof require&&require;if(!e&&s)return s(t,!0);if(d)return d(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}s=o[t]={exports:{}},i[t][0].call(s.exports,function(e){return n(i[t][1][e]||e)},s,s.exports,a,i,o,r)}return o[t].exports}for(var d="function"==typeof require&&require,e=0;e<r.length;e++)n(r[e]);return n}({1:[function(e,t,s){e("./postbox"),e("./pages"),e("./page-pages"),e("./page-pages-categories")},{"./page-pages":4,"./page-pages-categories":3,"./pages":5,"./postbox":6}],2:[function(e,t,a){!function(s){!function(){Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var e,o=(e="undefined"!=typeof window?window.jQuery:void 0!==s?s.jQuery:null)&&e.__esModule?e:{default:e},r=((e,t)=>{if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};if((t=n(t))&&t.has(e))return t.get(e);var s,a,i={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(s in e)"default"!==s&&{}.hasOwnProperty.call(e,s)&&((a=o?Object.getOwnPropertyDescriptor(e,s):null)&&(a.get||a.set)?Object.defineProperty(i,s,a):i[s]=e[s]);return i.default=e,t&&t.set(e,i),i})("undefined"!=typeof window?window.peepso:void 0!==s?s.peepso:null);function n(e){var t,s;return"function"!=typeof WeakMap?null:(t=new WeakMap,s=new WeakMap,(n=function(e){return e?s:t})(e))}let t=peepsopagesdata.listItemMemberActionsTemplate;a.default=class{constructor(e){this.id=e.id,this.actions=this.constructor.normalize(e),this.template=(0,r.template)(t),this.$el=(0,o.default)("<div />"),this.$el.on("click","[data-method]",e=>{this.onClick(e)}),this.render()}render(){var e=this.template(_.extend({id:this.id},this.actions));this.$el.html(e)}fetch(){return new Promise((t,s)=>{var e={page_id:this.id,keys:"pageuserajax.member_actions,pagefollowerajax.follower_actions"};r.default.postJson("pageajax.page",e,e=>{e.success?t(e.data):s(e.errors)})})}confirmAction(s){return new Promise((e,t)=>{s?pswindow.confirm(s,()=>{pswindow.hide(),e()},()=>{t()}):e()})}doAction(t,e){return new Promise((s,a)=>{r.default.ajax.post(t,e,-1).done(e=>{if(e.success)if(t.match(/\.(join|leave)$/)){let t=e.data.member_count;this.fetch().then(e=>{_.extend(e,{member_count:t}),s(e)}).catch(e=>{a(e)})}else s(e.data);else a(e.errors)}).fail(a)})}onClick(a){a.preventDefault(),a.stopPropagation();let i=(0,o.default)(a.currentTarget);if(!i.data("ps-loading")){let s=o.default.extend({},i.data());if(s.method&&s.id){let e=i.find("img"),t=(!e.length&&i.parent().hasClass("ps-js-dropdown-menu")&&(e=(e=i.parent().siblings(".ps-js-dropdown-toggle")).find("img"),i.parent().hide()),s.method);a=s.confirm;s.page_id=s.id,delete s.method,delete s.confirm,delete s.id,this.confirmAction(a).then(()=>{i.data("ps-loading",!0),e.show(),this.doAction(t,s).then(e=>{var t=this.constructor.normalize(e);this.actions=_.defaults({},t,this.actions),this.render(),e.member_count&&r.observer.applyFilters("page_update_member_count",this.id,e.member_count)}).catch(()=>{i.removeData("ps-loading"),e.hide()})}).catch(o.default.noop)}}}static normalize(e){let t,s,a;function i(e,t){return _.map(e,e=>(_.isString(e.action)&&e.action.indexOf(".")<0?e.action=t+"."+e.action:_.isArray(e.action)&&(e.action=i(e.action,t)),e))}return(t=(e=e||{}).page||{}).pageuserajax&&void 0!==t.pageuserajax.member_actions?s=i(t.pageuserajax.member_actions||[],"pageuserajax"):void 0!==e.member_actions&&(s=i(e.member_actions||[],"pageuserajax")),t.pagefollowerajax&&void 0!==t.pagefollowerajax.follower_actions?a=i(t.pagefollowerajax.follower_actions||[],"pagefollowerajax"):void 0!==e.follower_actions&&(a=i(e.follower_actions||[],"pagefollowerajax")),{member_actions:s,follower_actions:a}}}}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(e,t,s){!function(s){!function(){var r,i,a,o="undefined"!=typeof window?window.peepso:void 0!==s?s.peepso:null,e=jQuery;function t(){t.super_.apply(this,arguments)&&r(r.proxy(this.init_page,this))}r=e,e=peepsodata.pages&&peepsodata.pages.categories||{},i=+e.pages_categories_expand_all,a=+e.pages_categories_page_count||4,peepso.npm.inherits(t,PsPageAutoload),peepso.npm.objectAssign(t.prototype,{init_page:function(){var e;this._search_$ct.length&&(this._search_$ct.on("click",".ps-js-pages-cat .ps-js-page-category-title",r.proxy(this._toggle,this)),e=this._search_$ct.data("mode")||"grid",+peepsodata.currentuserid&&(e=o.ls.get("pages_viewmode_"+peepsodata.currentuserid)||e),this.toggleViewMode(e),r(".ps-js-pages-viewmode").on("click",e=>{e.preventDefault();e=r(e.currentTarget).data("mode");+peepsodata.currentuserid&&o.ls.set("pages_viewmode_"+peepsodata.currentuserid,e),this.toggleViewMode(e)}))},_search_url:"pagecategoriesajax.search",_search_params:{keys:"id,name,description,url,pages_count",page:1},_search_debounced:_.debounce(function(){this._fetch(this._search_params).done(function(e){e=this._search_render_html(e&&e.page_categories);this._search_toggle_loading("hide"),e?(this._search_$ct.append(e),this._search_toggle_autoscroll("on")):(this._render_uncategorized(),this._search_$nomore.show())}).fail(function(e){this._search_toggle_loading("hide"),this._search_params.page<=1?this._render_uncategorized().done(r.proxy(function(){this._search_$nomore.show()},this)).fail(r.proxy(function(){this._search_$ct.html(e.join("<br>"))},this)):(this._render_uncategorized(),this._search_$nomore.show())})},500),toggleViewMode:function(e){var t=r(".ps-js-pages-viewmode"),s=t.filter(`[data-mode="${e}"]`),a=r(".ps-js-pages"),i="ps-btn--active",o="ps-pages__list--single";s.addClass(i),t.not(s).removeClass(i),"list"===e?a.addClass(o):a.removeClass(o)},_search_render_html:function(e){var t,s=peepso.template(peepsopagesdata.listCategoriesTemplate),a=null;return e&&e.length&&(a="",_.each(e,function(e){a+=s(_.extend({},e)),t=t||e})),i?setTimeout(r.proxy(function(){this._search_$ct.find(".ps-js-pages-cat").filter(function(){return r(this).find(".ps-js-page-category-action i").hasClass("gci-expand-alt")}).find(".ps-js-page-category-title").trigger("click")},this),1):t&&0<+t.pages_count&&setTimeout(r.proxy(function(){this._unfold_first_row||(this._unfold_first_row=!0,this._search_$ct.find(".ps-js-pages-cat").eq(0).find(".ps-js-page-category-title").trigger("click"))},this),1),setTimeout(()=>{var e=this._search_$ct.data("mode")||"grid";+peepsodata.currentuserid&&(e=o.ls.get("pages_viewmode_"+peepsodata.currentuserid)||e),this.toggleViewMode(e)},1),a},_search_get_items:function(){return this._search_$ct.children(".ps-js-page-category-item")},_fetch:function(e){return r.Deferred(r.proxy(function(t){e=r.extend({},e),_.isUndefined(e.limit)||(e.limit*=2),this._fetch_xhr&&this._fetch_xhr.abort(),this._fetch_xhr=peepso.disableAuth().disableError().getJson(this._search_url,e,r.proxy(function(e){e.success?t.resolveWith(this,[e.data]):t.rejectWith(this,[e.errors])},this))},this))},_toggle:function(e){"A"===e.target.tagName&&e.target.href.match(/^https?:\/\//)||(e.preventDefault(),e.stopPropagation(),this._toggle_throttled(e))},_toggle_throttled:_.throttle(function(e){var e=r(e.currentTarget).find(".ps-js-page-category-action i"),t=e.closest(".ps-js-pages-cat"),s="gcis gci-compress-alt";e.hasClass(s)?(e.attr("class","gcis gci-expand-alt"),t.find(".ps-js-pages").hide(),this._collapse(t)):(e.attr("class",s),t.find(".ps-js-pages").show(),this._expand(t))},500),_expand:function(t){var e,s="ps-js-loaded";t.addClass("ps-pages__category--open"),t.hasClass(s)||(e={uid:peepsodata.currentuserid,user_id:void 0,query:"",category:t.data("id"),order_by:void 0,order:void 0,admin:void 0,keys:"id,name,description,date_created_formatted,members_count,url,published,avatar_url_full,cover_url,privacy,pageuserajax.member_actions,pagefollowerajax.follower_actions",limit:a,page:1},ps_pages._fetch(e).done(function(e){t.addClass(s),t.find(".ps-js-pages").html(e),t.find(".ps-js-page-category-footer").show()}).fail(function(e){t.addClass(s),t.find(".ps-js-pages").html(e.join("<br>")),t.find(".ps-js-page-category-footer").remove()}))},_collapse:function(e){e.removeClass("ps-pages__category--open")},_render_uncategorized:function(){var a=this;return r.Deferred(function(s){var e={uid:peepsodata.currentuserid,user_id:void 0,query:"",category:-1,order_by:void 0,order:void 0,admin:void 0,keys:"id,name,description,date_created_formatted,members_count,url,published,avatar_url_full,cover_url,privacy,pageuserajax.member_actions,pagefollowerajax.follower_actions",limit:1,page:1};ps_pages._fetch(e).done(function(){var e,t;e=peepsopagesdata.lang.uncategorized,t=peepsopagesdata.page_url.replace("##category_id##","-1"),(e=a._search_render_html([{id:"-1",name:e,url:t,__uncategorized:!0}]))&&a._search_$ct.append(e),s.resolve()}).fail(function(e){s.reject()})})}}),new t(".ps-js-page-cats")}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(a,e,t){!function(s){!function(){var p=e("undefined"!=typeof window?window.jQuery:void 0!==s?s.jQuery:null),l=e("undefined"!=typeof window?window._:void 0!==s?s._:null),c=((e,t)=>{if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};if((t=r(t))&&t.has(e))return t.get(e);var s,a,i={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(s in e)"default"!==s&&{}.hasOwnProperty.call(e,s)&&((a=o?Object.getOwnPropertyDescriptor(e,s):null)&&(a.get||a.set)?Object.defineProperty(i,s,a):i[s]=e[s]);return i.default=e,t&&t.set(e,i),i})("undefined"!=typeof window?window.peepso:void 0!==s?s.peepso:null),h=e(a("./page-actions"));function r(e){var t,s;return"function"!=typeof WeakMap?null:(t=new WeakMap,s=new WeakMap,(r=function(e){return e?s:t})(e))}function e(e){return e&&e.__esModule?e:{default:e}}let u=peepsopagesdata.listItemTemplate,_=peepsopagesdata.listItemMemberActionsTemplate;class t extends PsPageAutoload{constructor(e){super(e),this._search_url="pagesajax.search",this._search_params={uid:peepsodata.currentuserid,user_id:void 0,query:"",category:0,order_by:void 0,order:void 0,admin:void 0,keys:"id,name,description,date_created_formatted,members_count,url,published,avatar_url_full,cover_url,privacy,pageuserajax.member_actions,pagefollowerajax.follower_actions",limit:2,page:1}}onDocumentLoaded(){if(!1===super.onDocumentLoaded())return!1;this._search_$query=(0,p.default)(".ps-js-pages-query"),this._search_$sortby=(0,p.default)(".ps-js-pages-sortby"),this._search_$sortorder=(0,p.default)(".ps-js-pages-sortby-order"),this._search_$category=(0,p.default)(".ps-js-pages-category"),this._search_$searchmode=(0,p.default)(".ps-js-pages-search-mode"),this._search_params.user_id=+peepsodata.userid||void 0,this._search_params.category=this._search_$category.val()||0,this._search_params.search_mode=this._search_$searchmode.val()||void 0,this._search_$query.on("input",()=>{this._filter()}),this._search_$sortby.on("change",()=>{this._filter()}),this._search_$sortorder.on("change",()=>{this._filter()}),this._search_$category.on("change",e=>{this._filter_category(e)}),this._search_$searchmode.on("change",()=>{this._filter()}),(0,p.default)(".ps-form-search-opt").on("click",()=>{this._toggle()});var e=this._search_$ct.data("mode")||"grid";+peepsodata.currentuserid&&(e=c.ls.get("pages_viewmode_"+peepsodata.currentuserid)||e),this.toggleViewMode(e),(0,p.default)(".ps-js-pages-viewmode").on("click",e=>{e.preventDefault();e=(0,p.default)(e.currentTarget).data("mode");+peepsodata.currentuserid&&c.ls.set("pages_viewmode_"+peepsodata.currentuserid,e),this.toggleViewMode(e)}),this._filter()}toggleViewMode(e){var t=(0,p.default)(".ps-js-pages-viewmode"),s=t.filter(`[data-mode="${e}"]`),a=(0,p.default)(".ps-js-pages"),i="ps-btn--active",o="ps-pages__list--single";s.addClass(i),t.not(s).removeClass(i),"list"===e?a.addClass(o):a.removeClass(o)}_search_render_html(e){let t=(0,c.template)(u),s=((0,c.template)(_),this._search_params.query),a="",i,o,r,n,d;if(e.pages&&e.pages.length)for(d=0;d<e.pages.length;d++)(i=e.pages[d]).nameHighlight=i.name||"",n=i.description.match("peepso-markdown"),i.description=n?c.default.observer.applyFilters("peepso_parse_content",'<div class="peepso-markdown">'+i.description+"</div>"):(0,p.default)("<div/>").html(i.description||"").text(),s&&(o=l.default.filter(s.split(" "),function(e){return""!==e}),o=l.default.map(o,function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}),o=RegExp("("+o.join("|")+")","ig"),r='<span style="background:'+c.default.getLinkColor(.3)+'">$1</span>',i.nameHighlight=i.nameHighlight.replace(o,r),n||(i.description=(i.description||"").replace(o,r))),a+=t(p.default.extend({},i,{member_actions:""})),l.default.defer(function(e){var t=(0,p.default)(".ps-js-page-item--"+e.id).find(".ps-js-member-actions"),e=new h.default({id:e.id,member_actions:e.pageuserajax.member_actions,follower_actions:e.pagefollowerajax.follower_actions});t.html(e.$el)},i);return a}_search_get_items(){return this._search_$ct.children(".ps-js-page-item")}_search_should_load_more(){var e=+peepsodata.activity_limit_below_fold,t=this._search_get_items();return this._search_loadmore_enable&&this._search_loadmore_repeat?!(t.length>=this._search_loadmore_repeat*this._search_params.page):(e=0<e?e:3,this._search_params.limit&&(e*=this._search_params.limit),!!((t=t.slice(0-e).eq(0)).length&&(this._search_loadmore_enable?t.eq(0).offset():t.get(0).getBoundingClientRect()).top<(window.innerHeight||document.documentElement.clientHeight)))}_fetch(a){return p.default.Deferred(t=>{var e=c.default.disableAuth().disableError(),s=this._search_url;a=p.default.extend({},a),this._search_loadmore_enable&&this._search_loadmore_repeat?a.limit=this._search_loadmore_repeat:l.default.isUndefined(a.limit)||(a.limit*=2),this._fetch_xhr&&this._fetch_xhr.abort(),this._fetch_xhr=e.getJson(s,a,e=>{e.success?t.resolveWith(this,[e.data]):t.rejectWith(this,[e.errors])})})}_filter(){this._fetch_xhr&&this._fetch_xhr.abort(),this._search_params.query=p.default.trim(this._search_$query.val()),this._search_params.category=this._search_$category.val(),this._search_params.order_by=this._search_$sortby.val(),this._search_params.order=this._search_$sortorder.val(),this._search_params.search_mode=this._search_$searchmode.val(),this._search_params.page=1,this._search()}_filter_category(e){this._filter();let t=window.location.href,s=/(category=)-?\d+/,a=e.target.value||0;t.match(s)&&(t=t.replace(s,"$1"+a),window.history)&&history.pushState&&history.pushState(null,"",t)}_toggle(){(0,p.default)(".ps-js-page-filters").stop().slideToggle()}}new t(".ps-js-pages")}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./page-actions":2}],5:[function(e,t,s){var a,c,h,u=e("./page-actions").default;function i(){h.observer.addFilter("page_update_member_count",function(e,t){var s,e=c(".ps-js-page-item--"+e).find(".ps-js-member-count");e.length&&(s=1<+t?peepsopagesdata.lang.members:peepsopagesdata.lang.member,e.html(t+" "+s))},10,2),c(document.body).on("click",".ps-js-pages .ps-js-member-action",c.proxy(function(e){var t,a,s,i=c(e.currentTarget);e.preventDefault(),e.stopPropagation(),i.data("ps-loading")||(a=c.extend({},i.data())).method&&a.id&&(!(t=i.find("img")).length&&i.parent().hasClass("ps-js-dropdown-menu")&&(t=(t=i.parent().siblings(".ps-js-dropdown-toggle")).find("img"),i.parent().hide()),s=a.method,e=a.confirm,a.page_id=a.id,delete a.method,delete a.confirm,delete a.id,this._member_action_confirmation(e).done(function(){i.data("ps-loading",!0),t.show(),this.member_action(s,a).done(function(e){var t=i.closest(".ps-js-member-actions"),s=h.template(peepsopagesdata.listItemMemberActionsTemplate)(c.extend({id:a.page_id},e));t.html(s),e.member_count&&h.observer.applyFilters("page_update_member_count",a.page_id,e.member_count)})}))},this)),c(document.body).on("click",".ps-js-pages .ps-js-more",c.proxy(function(e){var t=".ps-js-page-item",s="ps-page--expanded",a=c(e.currentTarget).closest(t);e.preventDefault(),e.stopPropagation(),c(".ps-pages").find(t).each(function(){var e=c(this);e.is(a)&&!e.hasClass(s)?(e.addClass(s),e.find(".ps-js-more span").html(peepsopagesdata.lang.less)):e.hasClass(s)&&(e.removeClass(s),e.find(".ps-js-more span").html(peepsopagesdata.lang.more))})},this))}e=jQuery,a=peepso,window.ps_pages=(c=e,h=a,i.prototype._fetch=function(l){return c.Deferred(c.proxy(function(p){var e=(l.category||0)+"";this._fetch_xhr=this._fetch_xhr||{},this._fetch_xhr[e]&&this._fetch_xhr[e].abort(),this._fetch_xhr[e]=h.disableAuth().getJson("pagesajax.search",l,c.proxy(function(e){var t,s,a,i,o,r=h.template(peepsopagesdata.listItemTemplate),n=(h.template(peepsopagesdata.listItemMemberActionsTemplate),e.data||{}),d="";if(n.pages&&n.pages.length){for(o=0;o<n.pages.length;o++)(t=n.pages[o]).nameHighlight=t.name||"",i=t.description.match("peepso-markdown"),t.description=i?h.observer.applyFilters("peepso_parse_content",'<div class="peepso-markdown">'+t.description+"</div>"):c("<div/>").html(t.description||"").text(),l.query&&(s=l.query.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),s=RegExp("("+s+")","ig"),a='<span style="background:'+h.getLinkColor(.3)+'">$1</span>',t.nameHighlight=t.nameHighlight.replace(s,a),i||(t.description=(t.description||"").replace(s,a))),d+=r(c.extend({},t,{member_actions:""})),_.defer(function(e){var t=c(".ps-js-page-item--"+e.id).find(".ps-js-member-actions"),e=new u({id:e.id,member_actions:e.pageuserajax.member_actions,follower_actions:e.pagefollowerajax.follower_actions});t.html(e.$el)},t);p.resolveWith(this,[d])}else 1<l.page?p.resolveWith(this,[null]):p.rejectWith(this,[e.errors])},this))},this))},i.prototype._member_action_confirmation=function(t){return c.Deferred(c.proxy(function(e){t?pswindow.confirm(t,c.proxy(function(){pswindow.hide(),e.resolveWith(this)},this),c.proxy(function(){e.rejectWith(this)},this)):e.resolveWith(this)},this))},i.prototype.member_action=function(e,s){return c.Deferred(c.proxy(function(t){(e||"").indexOf(".")<0&&(e="pageuserajax."+e),h.postJson(e,s,c.proxy(function(e){e.success?t.resolveWith(this,[e.data]):t.rejectWith(this,[e.errors])},this))},this))},new i)},{"./page-actions":2}],6:[function(e,t,s){e("./postbox"),e("./postbox-new")},{"./postbox":8,"./postbox-new":7}],7:[function(e,t,s){!function(t){!function(){var c=e("undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null),s=(e("undefined"!=typeof window?window._:void 0!==t?t._:null),"undefined"!=typeof window?window.peepso:void 0!==t?t.peepso:null),h="undefined"!=typeof window?window.peepsodata:void 0!==t?t.peepsodata:null;function e(e){return e&&e.__esModule?e:{default:e}}let a=window.peepsopagesdata&&+peepsopagesdata.page_id,i=window.peepsopagesdata&&+peepsopagesdata.module_id;s.hooks.addFilter("postbox_data",(e,t)=>(a&&(e.module_id=i,e.page_id=a,e.post_as_page=1,e.acc=void 0),e)),s.hooks.addFilter("postbox_validate",(e,t,s)=>e=!(window.peepsoPageCategory&&+peepsoPageCategory.id)||s.module_id&&s.page_id?e:!1,100),s.hooks.addAction("postbox_option_init",(e,t)=>{if(void 0!==e.postTo){e=e.$dropdown.find("[data-value=page]");if(e.length){let a=window.peepsoGroupCategory&&+peepsoGroupCategory.id,i=e.find("[name=query]"),o=e.find(".ps-js-loading"),r=e.find(".ps-js-result"),n=e.find(".ps-js-result-list"),d=(0,s.template)(e.find(".ps-js-result-item-template").text()),p,l;i.one("focus",()=>i.trigger("input")),i.on("input",e=>{let s=p=Date.now();var t;n.empty(),r.hide(),o.show(),l&&l.abort(),l=([t=""]=[i.val().trim()],t={uid:h.currentuserid,user_id:h.currentuserid,category:a,query:t.trim(),writable_only:1,keys:"id,name,description,avatar_url_full,privacy,pageuserajax.can_pin_posts",order_by:"post_title",order:"ASC",limit:40,page:1},c.default.ajax({url:h.ajaxurl_legacy+"pagesajax.search",type:"GET",dataType:"json",beforeSend:e=>e.setRequestHeader("X-PeepSo-Nonce",h.peepso_nonce),data:t}).always(()=>l=null).done(t=>{if(s===p&&(o.hide(),r.show(),t)&&t.data){t=t.data;let e=`<i>${h.pages.textNoResult}</i>`;t.pages&&t.pages.length&&(e=t.pages.map(e=>d(e))),n.html(e)}}))})}}})}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(e,t,s){!function(p){!function(){var a=e("undefined"!=typeof window?window.jQuery:void 0!==p?p.jQuery:null),i=(e("undefined"!=typeof window?window._:void 0!==p?p._:null),((e,t)=>{if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};if((t=r(t))&&t.has(e))return t.get(e);var s,a,i={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(s in e)"default"!==s&&{}.hasOwnProperty.call(e,s)&&((a=o?Object.getOwnPropertyDescriptor(e,s):null)&&(a.get||a.set)?Object.defineProperty(i,s,a):i[s]=e[s]);return i.default=e,t&&t.set(e,i),i})("undefined"!=typeof window?window.peepso:void 0!==p?p.peepso:null)),o="undefined"!=typeof window?window.peepsodata:void 0!==p?p.peepsodata:null;function r(e){var t,s;return"function"!=typeof WeakMap?null:(t=new WeakMap,s=new WeakMap,(r=function(e){return e?s:t})(e))}function e(e){return e&&e.__esModule?e:{default:e}}let s=window.peepsopagesdata.module_id,n=+window.peepsopagesdata.force_posts_in_pages;var t=i.observer.applyFilters("class_postbox_dropdown",10,1);class d extends t{constructor(e){super(e.find("#page-tab")[0]),this.$postbox=e,this.$selected=this.$container.find(".ps-postbox__menu-item-label").hide(),this.$radio=this.$container.find("[type=radio]"),this.$finder=this.$container.find(".ps-js-page-finder"),this.$search=this.$finder.find("input[type=text]"),this.$loading=this.$finder.find(".ps-js-loading"),this.$result=this.$finder.find(".ps-js-result"),this.CATEGORY_ID=void 0,window.peepsoPageCategory&&(this.CATEGORY_ID=+window.peepsoPageCategory.id),this.resultTemplate=i.default.template(this.$result.find(".ps-js-result-item-template").text()),this.$dropdown.on("click","[data-option-value]",e=>{var t=(0,a.default)(e.currentTarget).data("optionValue");e.stopPropagation(),this.select(t),"page"!==t&&this.hide()}),this.$postbox.on("postbox.post_cancel postbox.post_saved",()=>this.remove()),i.observer.addFilter("postbox_req",a.default.proxy(this.filterPostboxReq,this),10,1),i.hooks.addFilter("postbox_can_submit","postbox_page",a.default.proxy(this.filterPostboxCanSubmit,this))}show(){super.show(),(n||this.CATEGORY_ID)&&(this.$radio.eq(0).closest("[data-option-value]").hide(),this.$dropdown.find("[data-option-value] .ps-checkbox").hide(),this.select("page"),this.$finder.show())}hide(){super.hide(),this.$radio.get(1).checked&&!this.value()&&(this.$radio.get(0).checked=!0,this.$finder.hide(),this.$container.removeClass("active"),this.$selected.hide())}value(){let e;return e=this.$radio.get(1).checked&&this.selectedPage?this.selectedPage:e}select(e){n||"page"===e?!n&&"page"!==e||(this.$radio.get(1).checked=!0,this.$finder.show(),this.initFinder()):(this.remove(),this.hide())}remove(){var e=!!this.selectedPage;this.selectedPage=void 0,this.$radio.get(0).checked=!0,this.$finder.hide(),this.$container.removeClass("active"),this.$selected.hide(),e&&i.observer.doAction("postbox_page_reset",this.$postbox)}search(t,s){var e,a;return t=(t||"").trim(),s=parseInt(s)||1,e={uid:o.currentuserid,user_id:o.currentuserid,category:this.CATEGORY_ID,query:t,writable_only:1,keys:"id,name,description,avatar_url_full,privacy,pageuserajax.can_pin_posts",order_by:"post_title",order:"ASC",limit:10,page:s},a=e=>{e&&e.data&&(this.query=t,this.page=s,this.render(e.data,s),this.searchEnd=!(e.data&&e.data.pages&&e.data.pages.length))},this.xhr&&this.xhr.abort(),this.xhr=i.default.disableAuth().getJson("pagesajax.search",e,a),this.xhr}render(t,e){var s=this.$result.children(".ps-js-result-list");if(t=t||{},1===(e=e||1)&&s.empty(),t&&t.pages&&t.pages.length)for(let e=0;e<t.pages.length;e++)s.append(this.resultTemplate(t.pages[e]));else 1===e&&s.append(`<li><em>${o.pages.textNoResult}</em></li>`)}initFinder(){this._initialSearch||(this.$search.on("keydown",a.default.proxy(this.onQueryEnter,this)),this.$search.on("input",a.default.proxy(this.onQueryInput,this)),this.$search.on("click",e=>e.stopPropagation()),this.$result.on("click","[data-id]",a.default.proxy(this.onResultSelect,this)),this.$result.on("scroll",a.default.proxy(this.onResultScroll,this)),this.$result.hide(),this.$loading.show(),this.search().always(()=>{this.$loading.hide(),this.$result.show()}),this._initialSearch=!0)}onQueryInput(){let e=this.$search.val(),t=e.replace(/^\s+/,"");e!==t&&this.$search.val(t),this.$result.hide(),this.$loading.show(),clearTimeout(this._onQueryTimer),this._onQueryTimer=setTimeout(a.default.proxy(function(){this.search(t,1).always(a.default.proxy(function(){this.$loading.hide(),this.$result.show()},this))},this),1e3)}onQueryEnter(e){13===e.keyCode&&(e.preventDefault(),e=this.$search.val().replace(/(^\s+|\s+$)/g,""),clearTimeout(this._onQueryTimer),this.$result.hide(),this.$loading.show(),this.search(e,1).always(a.default.proxy(function(){this.$loading.hide(),this.$result.show()},this)))}onResultSelect(e){var e=(0,a.default)(e.currentTarget),t=e.data("id"),s=e.data("name"),e={can_pin_posts:e.data("can-pin-posts")};this.selectedPage=t,this.$container.addClass("active"),this.$selected.html(s).show(),this.hide(),i.observer.doAction("postbox_page_set",this.$postbox,this.selectedPage,e)}onResultScroll(e){e.stopPropagation(),!this.searchEnd&&this.$loading.is(":hidden")&&this.$result[0].scrollHeight<=this.$result.scrollTop()+this.$result.innerHeight()&&(this.$loading.show(),this.search(this.query,this.page+1).always(()=>this.$loading.hide()))}filterPostboxReq(e){var t=this.value();return t&&(e.module_id=s,e.page_id=t,e.post_as_page=1,e.force_as_page_post=1,e.acc=void 0),e}filterPostboxCanSubmit(e,t){return t!==this.$postbox||!n&&!this.CATEGORY_ID||this.value()||(e=!1,this.show()),e}}i.observer.addAction("peepso_postbox_addons",e=>(e.push({init(){},set_postbox(e){e.find("#page-tab").length&&new d(e)}}),e),10,1),i.observer.addAction("postbox_init",e=>{e.$el.find("#page-tab").remove()},10,1)}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1]);