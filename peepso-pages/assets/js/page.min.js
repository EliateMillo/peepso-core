((e,a)=>{ps_page=new(((g,h)=>{let r=window.peepsopagesdata&&+window.peepsopagesdata.max_categories;function e(){this.ajax={},this.cover={},this.cover.x_position_percent=0,this.cover.y_position_percent=0,this.$cover_ct=jQuery(".js-focus-cover"),this.$cover_image=peepsopagesdata.page_id?jQuery("img#"+peepsopagesdata.page_id):jQuery(),this.initial_cover_position=this.$cover_image.attr("style"),h.observer.addFilter("postbox_req",function(e){return+peepsopagesdata.page_id&&(e.module_id=peepsopagesdata.module_id,e.page_id=peepsopagesdata.page_id,e.post_as_page=1),e},10,1),h.observer.addFilter("show_more_posts",function(e){return+peepsopagesdata.page_id?(e.stream_id=peepsopagesdata.module_id,e.module_id=peepsopagesdata.module_id,e.page_id=peepsopagesdata.page_id):+peepsopagesdata.page_category_id&&(e.page_category_id=peepsopagesdata.page_category_id),e},10,1),h.observer.addFilter("photos_validate_req",function(e){return+peepsopagesdata.page_id&&(e.module_id=peepsopagesdata.module_id,e.page_id=peepsopagesdata.page_id),e},10,1),h.observer.addFilter("photos_upload_req",function(e){return+peepsopagesdata.page_id&&(e.module_id=peepsopagesdata.module_id,e.page_id=peepsopagesdata.page_id),e},10,1),h.observer.addFilter("photos_rotate_req",function(e){return+peepsopagesdata.page_id&&(e.module_id=peepsopagesdata.module_id,e.page_id=peepsopagesdata.page_id),e},10,1),h.observer.addFilter("photos_get_list_photos",function(e){return!(peepsodata.profile&&+peepsodata.profile.id)&&+peepsopagesdata.page_id&&(e.module_id=peepsopagesdata.module_id,e.page_id=peepsopagesdata.page_id,e.post_as_page=1),e},10,1),h.observer.addFilter("photos_get_list_albums",function(e){return!(peepsodata.profile&&+peepsodata.profile.id)&&+peepsopagesdata.page_id&&(e.module_id=peepsopagesdata.module_id,e.page_id=peepsopagesdata.page_id,e.post_as_page=1),e},10,1),h.observer.addFilter("photos_create_album_req",function(e){return+peepsopagesdata.page_id&&(e.module_id=peepsopagesdata.module_id,e.page_id=peepsopagesdata.page_id,e.post_as_page=1),e},10,1),h.observer.addFilter("photos_add_photos_to_album_req",function(e){return+peepsopagesdata.page_id&&(e.module_id=peepsopagesdata.module_id,e.page_id=peepsopagesdata.page_id,e.post_as_page=1),e},10,1),h.observer.addFilter("photos_remove_temp_files",function(e){return+peepsopagesdata.page_id&&(e.module_id=peepsopagesdata.module_id,e.page_id=peepsopagesdata.page_id),e},10,1),h.observer.addFilter("photos_delete_album",function(e){return+peepsopagesdata.page_id&&(e.module_id=peepsopagesdata.module_id,e.page_id=peepsopagesdata.page_id),e},10,1),h.observer.addFilter("photos_delete_stream_album",function(e){return+peepsopagesdata.page_id&&(e.module_id=peepsopagesdata.module_id,e.page_id=peepsopagesdata.page_id),e},10,1),h.observer.addFilter("peepso_list_videos",function(e){return+peepsopagesdata.page_id&&(e.module_id=peepsopagesdata.module_id,e.page_id=peepsopagesdata.page_id),e},10,1),h.observer.addFilter("tags_get_taggable_params",function(e){return+peepsopagesdata.page_id&&(e.module_id=peepsopagesdata.module_id,e.page_id=peepsopagesdata.page_id),e},10,1),h.observer.addFilter("show_avatar_dialog",function(e){return peepsopagesdata.id?g.proxy(this.showAvatarDialog,this):e},10,1,this),h.observer.addAction("page_name_updated",function(e,a){+peepsopagesdata.page_id==+e&&(e=g(".ps-js-page-header")).length&&e.find(".ps-focus-title > span").text(a)},10,2,this),h.observer.addAction("page_privacy_updated",function(e,a){+peepsopagesdata.page_id==+e&&g(".ps-page--page-settings").length&&window.location.reload()},10,2,this),h.observer.addFilter("files_upload_req",function(e){return+peepsopagesdata.page_id&&(e.module_id=peepsopagesdata.module_id,e.page_id=peepsopagesdata.page_id,e.post_as_page=1),e},10,1),h.observer.addFilter("files_get_list_files",function(e){return!(peepsodata.profile&&+peepsodata.profile.id)&&+peepsopagesdata.page_id&&(e.module_id=peepsopagesdata.module_id,e.page_id=peepsopagesdata.page_id,e.post_as_page=1),e},10,1)}return e.prototype.init_page=function(t){t&&(this._header_$el=g(".ps-js-page-header"),this._header_$actions=g(".ps-js-page-header-actions"),this._header_$actions_loadingHtml=this._header_$actions.eq(0).html(),this._header_$actions.html(this._header_$actions_loadingHtml),this._get_data(t).done(function(e){this._data=e,h.observer.applyFilters("page_data",e)}),h.observer.addFilter("page_data",g.proxy(function(e){this._update_header_actions(e)},this),10,1),this._header_$actions.on("click",".ps-js-join",g.proxy(function(e){var a=g(e.currentTarget).find("img").show();this.join(t).done(function(e){a.hide(),window.location.reload()})},this)),this._header_$actions.on("click",".ps-js-leave",g.proxy(function(e){var a=g(e.currentTarget).find("img").show();this.leave(t).done(function(e){a.hide(),window.location.reload()})},this)),this.init()),g(document.body).on("click",".ps-js-page-member-action",g.proxy(function(e){var o,a,s,p=g(e.currentTarget);p.data("ps-loading")||(e.preventDefault(),e.stopPropagation(),(o=g.extend({},p.data())).method&&(o.id||t)&&(!(a=p.find("img")).length&&p.parent().hasClass("ps-js-dropdown-menu")&&(a=(a=p.parent().siblings(".ps-js-dropdown-toggle")).find("img"),p.parent().hide()),s=o.method,e=o.confirm,o.page_id=o.id||t,delete o.method,delete o.confirm,delete o.id,this._member_action_confirmation(e).done(function(){0<=s.indexOf("search_to_invite")?this.invite(t):(p.data("ps-loading",!0),a.show(),this.member_action(s,o).done(function(e){var a,t,i=p.closest(".ps-js-member");0<=s.indexOf("passive")?e.reload?window.location.reload():(e.hide?(i.remove(),_.isUndefined(e.pending_user_member_count)||h.observer.doAction("pending_user_member_count",+o.page_id,+e.pending_user_member_count),_.isUndefined(e.pending_admin_member_count)||h.observer.doAction("pending_admin_member_count",+o.page_id,+e.pending_admin_member_count)):(_.isUndefined(e.display_role)||(a=e.display_role,a=i.find('script[data-role="'+a+'"]'),t=i.find(".ps-js-member-role"),a.length?t.html(a.text()).show():t.hide().html("")),e.member_passive_actions&&e.member_passive_actions.length&&(a=h.template(peepsopagesdata.memberItemActionsTemplate),t={member_passive_actions:e.member_passive_actions,id:o.page_id,passive_user_id:o.passive_user_id},i.find(".ps-js-dropdown").html(a(t)))),+peepsodata.currentuserid==+o.passive_user_id&&(this._header_$actions.html(this._header_$actions_loadingHtml),this._get_data(o.page_id).done(function(e){this._data=e,h.observer.applyFilters("page_data",e)})),h.observer.doAction("notification_clear_cache")):!s.match(/\.?join$/)&&(!(0<=s.indexOf("leave"))||e.member_actions&&1<e.member_actions.length)?this._update_header_actions(e):window.location.reload()}).fail(function(e){p.removeData("ps-loading"),a.hide(),e&&e.length&&pswindow.show("",e.join("<br/>"))}))})))},this)),g(document.body).on("click",".ps-js-pages .ps-js-more",g.proxy(function(e){e.preventDefault(),e.stopPropagation();var e=g(e.currentTarget).closest(".ps-js-page-item"),a=e.find(".ps-js-owner"),t=e.find(".ps-js-categories"),i=e.find(".ps-js-category-icon");!+peepsopagesdata.list_show_owner||a.data("ps-loaded")||a.data("ps-loading")||(a.data("ps-loading",!0),this.get_owners(a.data("id")).done(function(e){a.data("ps-loaded",!0),a.removeData("ps-loading"),e&&e.length?a.html('<a href="'+e[0].profileurl+'">'+e[0].fullname+"</a>"):a.html("<em>No owner</em>")})),t.data("ps-loaded")||t.data("ps-loading")||(t.data("ps-loading",!0),this.get_categories(t.data("id")).done(function(e){t.data("ps-loaded",!0),t.removeData("ps-loading"),e&&e.length?(e=_.map(e,function(e){return'<a href="'+e.url+'">'+e.name+"</a>"}),t.html(e.join(", ")),1<e.length&&i.attr("class","ps-icon-tags")):t.html("<em>No category</em>")}))},this)),g(".ps-js-pages .ps-js-focus .ps-js-privacy .ps-js-dropdown-menu").on("click","[data-option-value]",function(e){var s,e=g(e.currentTarget),p=e.closest(".ps-js-dropdown-menu").siblings(".ps-js-dropdown-toggle"),e=+e.data("optionValue");e!=+peepsopagesdata.privacy&&(s={privacy:e,page_id:peepsopagesdata.page_id,_wpnonce:peepsopagesdata.nonce_set_page_privacy},pswindow.confirm(peepsopagesdata.lang.privacy_change_confirmation,function(){var o=p.find("img").show();pswindow.hide(),h.getJson("pageajax.set_page_privacy",s,function(e){var a,t=p.find("i"),i=t.siblings("span");o.hide(),e.success?(a=e.data.new_privacy,peepsopagesdata.privacy=a.id,t.attr("class",a.icon),i.html(a.name),p.addClass("ps-list-info-success"),setTimeout(function(){p.removeClass("ps-list-info-success")},1e3),h.observer.doAction("page_privacy_updated",s.page_id,{id:a.id,icon:a.icon,name:a.name})):e.errors&&psmessage.show("",e.errors[0])})}))}),g(".ps-js-focus-box-toggle").on("click",function(e){var a=g(".ps-js-focus-description"),t=g(document),i="click.ps-focusbox-toggle",o="ps-focus__desc--open";e.stopPropagation(),a.hasClass(o)?(a.removeClass(o),t.off(i)):(a.addClass(o),t.one(i,function(){a.removeClass(o)}))})},e.prototype._get_data=function(e){return g.Deferred(g.proxy(function(a){h.ajax.get("pageajax.page",{page_id:e,context:"cover",keys:"pageuserajax.member_actions,pagefollowerajax.follower_actions"},5).done(function(e){e.success?a.resolveWith(this,[e.data]):a.rejectWith(this,[e.errors])}.bind(this))},this))},e.prototype._normalize_header_actions=function(e,i){return _.map(e,function(e){var a=e.label||"",t=a.charAt(0);return t.match(/[a-z]/)&&(a=t.toUpperCase()+a.slice(1)),e.label=a,_.isString(e.action)&&e.action.indexOf(".")<0?e.action=i+"."+e.action:_.isArray(e.action)&&(e.action=this._normalize_header_actions(e.action,i)),e},this)},e.prototype._update_header_actions=function(e){var a,t,i,o=h.template(peepsopagesdata.headerActionsTemplate);(i=(e=e||{}).page||{}).pageuserajax&&!_.isUndefined(i.pageuserajax.member_actions)?a=i.pageuserajax.member_actions||[]:_.isUndefined(e.member_actions)||(a=e.member_actions||[]),a=a&&this._normalize_header_actions(a,"pageuserajax"),i.pagefollowerajax&&!_.isUndefined(i.pagefollowerajax.follower_actions)?t=i.pagefollowerajax.follower_actions||[]:_.isUndefined(e.follower_actions)||(t=e.follower_actions||[]),t=t&&this._normalize_header_actions(t,"pagefollowerajax"),this._header_actions=this._header_actions||{},this._header_actions.member_actions=a||this._header_actions.member_actions,this._header_actions.follower_actions=t||this._header_actions.follower_actions,this._header_$actions.html(o(this._header_actions)),_.defer(g.proxy(function(){var e,a,t=window.location;t.href.match(/#membership/)&&(e=this._header_$actions.find(".ps-js-btn-membership"),a=e.siblings(".ps-js-dropdown-menu").show(),e.add(a).addClass("ps-list-info-success"),setTimeout(function(){e.add(a).removeClass("ps-list-info-success")},1e3),"replaceState"in window.history)&&history.replaceState("",document.title,t.pathname+t.search)},this))},e.prototype.get_owners=function(e){return g.Deferred(g.proxy(function(a){h.getJson("pageusersajax.search",{page_id:e,role:"owner",keys:"fullname,profileurl"},g.proxy(function(e){e.data&&e.data.members?a.resolveWith(this,[e.data.members]):a.rejectWith(this,[e.errors])},this))},this))},e.prototype.get_members=function(e){return g.Deferred(g.proxy(function(a){h.getJson("pageusersajax.search",{page_id:e,keys:"avatar,fullname,profileurl,role"},g.proxy(function(e){e.data&&e.data.members?a.resolveWith(this,[e.data.members]):a.rejectWith(this,[e.errors])},this))},this))},e.prototype.get_categories=function(e){return g.Deferred(g.proxy(function(a){h.getJson("pagecategoriespagesajax.categories_for_page",{page_id:e,keys:"name,url"},g.proxy(function(e){e.data&&e.data.categories?a.resolveWith(this,[e.data.categories]):a.rejectWith(this,[e.errors])},this))},this))},e.prototype.join=function(e,t,a){if(a){a=g(a);if(a.data("progress"))return;a.data("progress",1).append(`&nbsp;<img src="${peepsodata.loading_gif}">`)}return g.Deferred(g.proxy(function(a){h.postJson("pageuserajax.join",{page_id:e},g.proxy(function(e){e.success?(t&&activity.reload(t),a.resolveWith(this,[e.data])):a.rejectWith(this,[e.errors])},this))},this))},e.prototype.leave=function(e){return g.Deferred(g.proxy(function(a){h.postJson("pageuserajax.leave",{page_id:e},g.proxy(function(e){e.success?a.resolveWith(this,[e.data]):a.rejectWith(this,[e.errors])},this))},this))},e.prototype.invite=function(e){h.pages.dlgInvite(e)},e.prototype.inviteUser=function(e,t){return g.Deferred(g.proxy(function(a){h.getJson("pageuserajax.passive_invite",{page_id:e,passive_user_id:t},g.proxy(function(e){e.success?a.resolveWith(this,[e.data]):a.rejectWith(this,[e.errors])},this))},this))},e.prototype.edit_name=function(t,e){var e=g(e).closest(".ps-js-page-name"),i=e.find(".ps-js-page-name-text"),a=e.find(".ps-js-page-name-editor"),o=e.find(".ps-js-btn-edit"),s=e.find(".ps-js-btn-cancel"),p=e.find(".ps-js-btn-submit"),n=a.find("input[type=text]"),r=e.find(".ps-js-limit"),d=n.val();a.is(":visible")||(i.hide(),o.hide(),s.show(),p.show(),a.show(),n.focus(),_.defer(function(){n[0].selectionStart=n[0].selectionEnd=d.length}),n.data("original-value")||(n.data("original-value",d),n.off("input keydown").on("input",function(e){var a=g.trim(n.val()),t=g.trim(n.data("original-value")),i=+n.data("maxlength");i&&a.length>i&&(a=a.substr(0,i),n.val(a)),r.html(i-a.length),a&&a!==t?p.removeAttr("disabled"):p.attr("disabled","disabled")}).on("keydown",function(e){13===e.keyCode&&(e.preventDefault(),e.stopPropagation(),p.attr("disabled")||p.click())})),n.trigger("input"),s.off("click").on("click",function(){n.val(n.data("original-value")),a.hide(),p.hide(),s.hide(),o.show(),i.show()}),p.off("click").on("click",g.proxy(function(){var e=peepsopagesdata.lang.name_change_confirmation;pswindow.confirm(e,g.proxy(function(){var e=p.find("img").show(),a=n.val();pswindow.hide(),this._updateName(t,a).always(function(){e.hide()}).done(function(){n.data("original-value",a),i.text(a),s.click()}).fail(function(e){psmessage.show("",e)})},this),function(){pswindow.hide(),s.click()})},this)))},e.prototype._updateName=function(t,i){var o="_xhr_"+t,e=this._updateName[o];return e&&e.abort(),g.Deferred(g.proxy(function(a){var e=h.postJson("pageajax.set_page_name",{page_id:t,name:i,_wpnonce:peepsopagesdata.nonce_set_page_name},g.proxy(function(e){e.success?(h.observer.doAction("page_name_updated",t,i),a.resolve()):e.errors?a.reject(e.errors[0]):a.reject()},this));this._updateName[o]=e.ret},this))},e.prototype.edit_slug=function(a,e){var t,o,i,e=g(e).closest(".ps-js-page-slug"),s=e.find(".ps-js-page-slug-text"),p=e.find(".ps-js-page-slug-editor"),n=e.find(".ps-js-page-slug-trigger"),r=e.find(".ps-js-cancel"),d=e.find(".ps-js-submit");p.is(":visible")||(s.hide(),n.hide(),r.show(),d.show(),p.show(),o=p.find(".ps-js-submit"),(t=p.find("input")).data("original-value",i=t.val()),t.focus().val("").val(i),p.off("click input"),r.off("click").on("click",function(){t.val(i),p.hide(),d.hide(),r.hide(),n.show(),s.show()}),d.off("click").on("click",g.proxy(function(e){this.save_slug(a,t.val(),e.currentTarget)},this)),p.on("input","input",function(e){var e=g(e.currentTarget),a=e.closest(".ps-js-page-slug").find(".ps-js-limit"),t=+e.data("maxlength"),i=e.val();t&&i.length>t&&(i=i.substr(0,t),e.val(i)),a.html(t-i.length),g.trim(i)?o.removeAttr("disabled"):o.attr("disabled","disabled")}),t.trigger("input"))},e.prototype.save_slug=function(e,a,t){var i,o="save_slug";this.ajax[o]||(this.ajax[o]=!0,a=g.trim(a),(i=g(t).find(".ps-js-loading")).show(),h.postJson("pageajax.set_page_slug",{page_id:e,slug:a,_wpnonce:peepsopagesdata.nonce_set_page_slug},g.proxy(function(e){this.ajax[o]=!1,i.hide(),e.success?window.location=e.data.redirect:e.errors&&h.dialog(e.errors[0],{error:!0}).show()},this)))},e.prototype.save_name=function(e,s,p){var n,r="save_name";this.ajax[r]||(this.ajax[r]=!0,s=g.trim(s),(n=g(p).find(".ps-js-loading")).show(),h.postJson("pageajax.set_page_name",{page_id:e,name:s,_wpnonce:peepsopagesdata.nonce_set_page_name},g.proxy(function(e){var a=g(p).closest(".ps-js-page-name"),t=a.find(".ps-js-page-name-text"),i=a.find(".ps-js-page-name-editor"),a=a.find(".ps-js-page-name-trigger"),o=i.find("input");this.ajax[r]=!1,n.hide(),e.success?(o.val(s),i.off("click").hide(),t.text(s).show(),a.show(),e.data&&e.data.redirect&&(window.location=e.data.redirect)):e.errors&&psmessage.show("",e.errors[0])},this)))},e.prototype.edit_cats=function(t,e){var o,e=g(e).closest(".ps-js-page-cat"),a=e.find(".ps-js-page-cat-text"),s=e.find(".ps-js-page-cat-editor"),i=e.find(".ps-js-btn-edit"),p=e.find(".ps-js-cancel"),n=e.find(".ps-js-submit");s.is(":visible")||(a.hide(),i.hide(),p.show(),n.show(),s.show(),(o=s.find("input[type=checkbox], input[type=radio]")).each(function(){g(this).data("original-value",this.checked)}),s.off("click"),p.off("click").on("click",function(){o.each(function(){this.checked=g(this).data("original-value")}),s.hide(),n.hide(),p.hide(),i.show(),a.show()}),n.off("click").on("click",g.proxy(function(e){var a=o.filter(function(){return this.checked}).map(function(){return+this.value}),a=Array.prototype.slice.call(a);this.save_cats(t,a,e.currentTarget)},this)),o.on("click",function(e){var a=s.find(".ps-js-submit"),t=o.filter(":checked"),i=o.not(t);"checkbox"===e.target.type&&(t.length>=r?(i.prop("disabled",!0),i.parent().css("opacity",.3)):(i.prop("disabled",!1),i.parent().css("opacity",""))),1<=t.length?a.removeAttr("disabled"):a.attr("disabled","disabled")}),o.first().triggerHandler("click"))},e.prototype.save_cats=function(e,r,d){var c,l="save_cats";this.ajax[l]||(this.ajax[l]=!0,(c=g(d).find(".ps-js-loading")).show(),h.postJson("pageajax.set_page_categories",{page_id:e,category_id:r,_wpnonce:peepsopagesdata.nonce_set_page_categories},g.proxy(function(e){var a=g(d).closest(".ps-js-page-cat"),t=a.find(".ps-js-page-cat-text"),i=a.find(".ps-js-page-cat-editor"),o=a.find(".ps-js-btn-edit"),s=a.find(".ps-js-cancel"),a=a.find(".ps-js-submit"),p=i.find("input[type=checkbox], input[type=radio]"),n=[];this.ajax[l]=!1,c.hide(),e.success?(p.each(function(){this.checked=0<=r.indexOf(+this.value),this.checked&&n.push(['<a href="',peepsopagesdata.page_url.replace("##category_id##",this.value),'">',g(this).next("label").text(),"</a>"].join(""))}),i.off("click").hide(),t.html(n.join("")).show(),a.hide(),s.hide(),o.show()):e.errors&&psmessage.show("",e.errors[0])},this)))},e.prototype.edit_desc=function(a,e){var t,i,e=g(e).closest(".ps-js-page-desc"),o=e.find(".ps-js-page-desc-text"),s=e.find(".ps-js-page-desc-placeholder"),p=e.find(".ps-js-page-desc-editor"),n=e.find(".ps-js-btn-edit"),r=e.find(".ps-js-cancel"),d=e.find(".ps-js-submit");p.is(":visible")||(o.hide(),s.hide(),n.hide(),r.show(),d.show(),p.show(),$submit=p.find(".ps-js-submit"),(t=p.find("textarea")).data("original-value",i=t.val()),t.focus().val("").val(i),p.off("click input"),r.off("click").on("click",function(){t.val(i),p.hide(),d.hide(),r.hide(),n.show(),g.trim(i)?(o.show(),s.hide()):(o.hide(),s.show())}),d.off("click").on("click",g.proxy(function(e){this.save_desc(a,t.val(),e.currentTarget)},this)),p.on("input","textarea",function(e){var e=g(e.currentTarget),a=e.closest(".ps-js-page-desc").find(".ps-js-limit"),t=+e.data("maxlength"),i=e.val();t&&i.length>t&&(i=i.substr(0,t),e.val(i)),a.html(t-i.length),g.trim(i)?$submit.removeAttr("disabled"):$submit.attr("disabled","disabled")}),t.trigger("input"))},e.prototype.save_desc=function(e,d,c){var l,u="save_desc";this.ajax[u]||(this.ajax[u]=!0,d=g.trim(d||""),(l=g(c).find(".ps-js-loading")).show(),h.postJson("pageajax.set_page_description",{page_id:e,description:d,_wpnonce:peepsopagesdata.nonce_set_page_description},g.proxy(function(e){var a=g(c).closest(".ps-js-page-desc"),t=a.find(".ps-js-page-desc-text"),i=a.find(".ps-js-page-desc-placeholder"),o=a.find(".ps-js-page-desc-editor"),s=a.find(".ps-js-btn-edit"),p=a.find(".ps-js-cancel"),a=a.find(".ps-js-submit"),n=o.find("textarea"),r=g(".ps-js-focus-desc");this.ajax[u]=!1,l.hide(),e.success?(n.val(d),o.off("click").hide(),a.hide(),p.hide(),s.show(),d=(d=_.escape(g.trim(d))).replace(/(?:\r\n|\r|\n)/g,"<br />"),n=t.find(".peepso-markdown"),a=o=d,n.length&&(a=h.observer.applyFilters("peepso_parse_content",'<div class="peepso-markdown">'+a+"</div>")),o?(t.html(a).show(),i.hide(),r.html(a)):(t.text(a).hide(),i.show(),r.text(a))):e.errors&&psmessage.show("",e.errors[0])},this)))},e.prototype._member_action_confirmation=function(a){return g.Deferred(g.proxy(function(e){a?pswindow.confirm(a,g.proxy(function(){pswindow.hide(),e.resolveWith(this)},this),g.proxy(function(){e.rejectWith(this)},this)):e.resolveWith(this)},this))},e.prototype.member_action=function(e,t){return g.Deferred(function(a){e?(-1===e.indexOf(".")&&(e="pageuserajax."+e),h.ajax.post(e,t,-1).done(function(e){e.data?a.resolveWith(this,[e.data]):a.rejectWith(this,[e.errors])}.bind(this)).fail(function(){a.rejectWith(this)}.bind(this))):a.rejectWith(this)}.bind(this))},e.prototype.init=function(){jQuery(".js-focus-cover").hover(function(){!1===pswindow.is_visible&&jQuery(".js-focus-change-cover").show()},function(){jQuery(".js-focus-change-cover").hide()}),jQuery(".ps-tab__bar").unbind("click");var e=this;this.$cover_image.one("load",function(){e.fix_horizontal_padding()}).each(function(){this.complete&&jQuery(this).trigger("load")}),jQuery(window).on("resize.focus-image",jQuery.proxy(this.fix_horizontal_padding_debounced,this))},e.prototype.fix_horizontal_padding=function(){var e;this.$cover_image.css({height:"auto",width:"100%",minWidth:"100%",maxWidth:"100%"}),e=.375*this.$cover_ct.width(),e=Math.max(e,this.$cover_ct.height()),this.$cover_image.height()<e&&this.$cover_image.css({height:e,width:"auto",minWidth:"100%",maxWidth:"none"}),this.initial_cover_position=this.$cover_image.attr("style")},e.prototype.fix_horizontal_padding_debounced=_.debounce(function(){this.fix_horizontal_padding()},300),e.prototype.show_avatar_dialog=function(){jQuery(".ps-js-error").html("");var e=jQuery("#dialog-upload-avatar"),a=e.find("#dialog-upload-avatar-title").html(),t=e.find("#dialog-upload-avatar-content").html(),e=e.find(".dialog-action").html(),i=pswindow.show(a,t).set_actions(e).$container.find(".ps-dialog");i.addClass("ps-dialog-wide"),h.observer.addFilter("pswindow_close",function(){i.removeClass("ps-dialog-wide")},10,1),this.init_avatar_fileupload(),jQuery("#ps-window").on("pswindow.hidden",function(){jQuery(".upload-avatar .fileupload:visible").psFileupload("destroy")})},e.prototype.init_avatar_fileupload=function(){var s=this;jQuery(".upload-avatar .fileupload:visible").psFileupload({formData:{page_id:peepsopagesdata.page_id,_wpnonce:jQuery("#_covernonce").val()},dataType:"json",url:peepsodata.ajaxurl_legacy+"pageajax.avatar_upload?avatar",add:function(e,a){var t;a.files[0].type.length&&!/(\.|\/)(jpe?g|png|webp)$/i.test(a.files[0].type)?(t=jQuery("#profile-avatar-error-filetype").text(),jQuery(".ps-js-error").html(t)):parseInt(a.files[0].size)>peepsodata.upload_size?(t=jQuery("#profile-avatar-error-filesize").text(),jQuery(".ps-js-error").html(t)):(jQuery("#ps-window .ps-loading-image").show(),jQuery("#ps-window .show-avatar, #ps-window .show-thumbnail, #ps-window .upload-avatar").hide(),jQuery(".ps-js-error").hide(),pswindow.refresh(),a.submit())},done:function(e,a){var t,i,o,a=a.result;a.success?(t=jQuery("#dialog-upload-avatar-content",jQuery(a.data.html)),i=jQuery("#dialog-upload-avatar .dialog-action").html(),o="?"+Math.random(),jQuery(".js-focus-avatar img",t).attr("src",a.data.image_url+o),jQuery(".imagePreview img",t).attr("src",a.data.orig_image_url+o),jQuery(".imagePreview",t).after('<input type="hidden" name="is_tmp" value="1"/>'),jQuery(".ps-js-has-avatar",t).show(),jQuery(".ps-js-no-avatar",t).hide(),pswindow.set_content(t),pswindow.set_actions(i),jQuery("#imagePreview img").one("load",function(){pswindow.refresh()}),s.init_avatar_fileupload(),jQuery("#ps-window button[name=rep_submit]").removeAttr("disabled").addClass("ps-btn-primary"),s.invalid_avatar_upload=!1,s.avatar_use_gravatar=!1):(jQuery("#ps-window .show-avatar, #ps-window .show-thumbnail, #ps-window .upload-avatar").show(),jQuery(".ps-js-error").html(a.errors).show(),jQuery("#ps-window .ps-loading-image").hide(),jQuery("#ps-window button[name=rep_submit]").attr("disabled","disabled").removeClass("ps-btn-primary"),s.invalid_avatar_upload=!0)}})},e.prototype.confirm_avatar=function(a){var t,e;this.invalid_avatar_upload||(t=this.confirm_avatar)._loading||(t._loading=!0,a&&(a=jQuery(a)).attr("disabled","disabled"),e={page_id:peepsopagesdata.page_id,module_id:peepsopagesdata.module_id,_wpnonce:jQuery("#_covernonce").val()},h.postJson("pageajax.avatar_confirm",e,function(e){e&&e.success?window.location.reload():(t._loading=!1,a&&a.removeAttr("disabled"))}))},e.prototype.confirm_remove_avatar=function(){var e=jQuery("#delete-confirmation #delete-title").html(),a=jQuery("#delete-confirmation #delete-content").html();pswindow.show(e,a)},e.prototype.remove_avatar=function(e){e={page_id:peepsopagesdata.page_id,user_id:e,_wpnonce:jQuery("#_covernonce").val()};h.postJson("pageajax.avatar_delete",e,function(e){e.success&&window.location.reload()})},e.prototype.confirm_remove_cover_photo=function(){var e=jQuery("#delete-confirmation #delete-title").html(),a=jQuery("#delete-confirmation #delete-content").html();pswindow.show(e,a)},e.prototype.remove_cover_photo=function(e){var a={page_id:peepsopagesdata.page_id,_wpnonce:jQuery("#_covernonce").val()};h.postJson("pageajax.cover_delete",a,function(e){e.success&&window.location.reload()})},e.prototype.reposition_cover=function(){jQuery(".js-focus-gradient",".js-focus-cover").hide(),jQuery(".js-focus-change-cover > a",".js-focus-cover").hide(),jQuery(".reposition-cover-actions",".js-focus-cover").show(),jQuery(".js-focus-cover").addClass("ps-focus-cover-edit");var s=this,t=jQuery(".js-focus-cover").height()-jQuery("img#"+peepsopagesdata.page_id).height(),i=jQuery(".js-focus-cover").width()-jQuery("img#"+peepsopagesdata.page_id).width();jQuery("img#"+peepsopagesdata.page_id).draggable({cursor:"move",drag:function(e,a){a.position.top<t&&(a.position.top=t),0<a.position.top&&(a.position.top=0),a.position.left<i&&(a.position.left=i),0<a.position.left&&(a.position.left=0)},stop:function(e,a){var t=jQuery("img#"+peepsopagesdata.page_id),i=t.closest(".js-focus-cover"),o=100*a.position.top/i.height(),o=Math.round(1e4*o)/1e4;y=100*a.position.left/i.width(),y=Math.round(1e4*y)/1e4,s.cover.x_position_percent=o,s.cover.y_position_percent=y,t.css("top",o+"%"),t.css("left",y+"%")}})},e.prototype.cancel_reposition_cover=function(){jQuery(".js-focus-gradient",".js-focus-cover").show(),jQuery(".js-focus-change-cover > a",".js-focus-cover").show(),jQuery(".reposition-cover-actions",".js-focus-cover").hide(),jQuery(".js-focus-cover").removeClass("ps-focus-cover-edit"),jQuery("img#"+peepsopagesdata.page_id).attr("style",this.initial_cover_position),jQuery("img#"+peepsopagesdata.page_id).draggable("destroy")},e.prototype.save_reposition_cover=function(){var e={page_id:peepsopagesdata.page_id,x:this.cover.x_position_percent,y:this.cover.y_position_percent,_wpnonce:jQuery("#_covernonce").val()},a=this;jQuery(".reposition-cover-actions",".js-focus-cover").hide(),jQuery(".ps-reposition-loading",".js-focus-cover").show(),jQuery(".js-focus-cover").removeClass("ps-focus-cover-edit"),h.postJson("pageajax.cover_reposition",e,function(e){jQuery(".ps-reposition-loading",".js-focus-cover").hide(),a.initial_cover_position=jQuery("img#"+peepsopagesdata.page_id).attr("style"),a.cancel_reposition_cover()})},e.prototype.show_cover_dialog=function(){jQuery(".ps-js-error").html("");var e=jQuery("#dialog-upload-cover"),a=e.find("#dialog-upload-cover-title").html(),e=e.find("#dialog-upload-cover-content").html();pswindow.show(a,e),this.init_cover_fileupload(),jQuery("#ps-window").on("pswindow.hidden",function(){jQuery(".upload-cover .fileupload:visible").psFileupload("destroy")})},e.prototype.init_cover_fileupload=function(){var t=this;jQuery(".upload-cover .fileupload:visible").psFileupload({formData:{page_id:peepsopagesdata.page_id,module_id:peepsopagesdata.module_id,_wpnonce:jQuery("#_covernonce").val()},dataType:"json",url:peepsodata.ajaxurl_legacy+"pageajax.cover_upload?cover",add:function(e,a){var t;a.files[0].type.length&&!/(\.|\/)(jpe?g|png|webp)$/i.test(a.files[0].type)?(t=jQuery("#profile-cover-error-filetype").text(),jQuery(".ps-js-error").html(t)):parseInt(a.files[0].size)>peepsodata.upload_size?(t=jQuery("#profile-cover-error-filesize").text(),jQuery(".ps-js-error").html(t)):(jQuery("#ps-window .ps-loading-image").show(),jQuery("#ps-window .upload-cover").hide(),a.submit())},done:function(e,a){a=a.result;jQuery("#ps-window .ps-loading-image").hide(),jQuery("#ps-window .upload-cover").show(),a.success?(jQuery(".cover-image").attr("src",a.data.image_url+"?"+Math.random()).css("top","0").css("left","0").removeClass("default").addClass("has-cover"),pswindow.fade_out("slow"),jQuery("#profile-reposition-cover").show(),jQuery("#dialog-upload-cover-content").html(a.data.html),pswindow.set_content(jQuery("#dialog-upload-cover-content",a.data.html).html()),t.fix_horizontal_padding_debounced(),t.init_cover_fileupload()):jQuery(".ps-js-error").html(a.errors)}})},e.prototype.showAvatarDialog=function(){var e;peepsopagesdata.id&&(this.avatarDialog||((e={id:+peepsopagesdata.id,name:peepsopagesdata.name,hasAvatar:+peepsopagesdata.hasAvatar,imgAvatar:peepsopagesdata.imgAvatar,imgOriginal:peepsopagesdata.imgOriginal}).hasAvatar||(e.imgOriginal=""),this.avatarDialog=new PsPageAvatarDialog(e)),this.avatarDialog.show())},e.prototype.edit_property=function(e,i,o){var e=g(e).closest(".ps-js-page-"+o),s=e.find(".ps-js-text"),a=e.find(".ps-js-editor"),t=e.find(".ps-js-btn-edit"),p=e.find(".ps-js-btn-cancel"),n=e.find(".ps-js-btn-submit"),r=a.find('select[name="'+o+'"]'),e=r.val();a.is(":visible")||(s.hide(),t.hide(),p.show(),n.show(),a.show(),r.data("psInitialized"))||(r.data("psInitialized",1),r.data("initialValue",e),r.off("change").on("change",function(){var e=g(this),a=e.val(),e=e.data("initialValue");a&&a!==e?n.removeAttr("disabled"):n.attr("disabled","disabled")}),p.off("click").on("click",function(){r.val(r.data("initialValue")),a.hide(),n.hide(),p.hide(),t.show(),s.show()}),n.off("click").on("click",function(){var a=n.find("img"),t=r.val();a.is(":visible")||(a.show(),h.postJson("pageajax.set_page_property",{page_id:i,property_name:o,property_value:t,_wpnonce:peepsopagesdata.nonce_set_page_property},function(e){a.hide(),e.success&&(r.data("initialValue",t),s.html(r.children("option:selected").text())),p.click()}))}))},e.prototype.edit_custom_input=function(e,i,o){var e=g(e).closest(".ps-js-page-"+o),s=e.find(".ps-js-text"),a=e.find(".ps-js-editor"),t=e.find(".ps-js-btn-edit"),p=e.find(".ps-js-btn-cancel"),n=e.find(".ps-js-btn-submit"),r=a.find(`[name="${o}"]`),e=r.val();a.is(":visible")||(s.hide(),t.hide(),p.show(),n.show(),a.show(),r.data("psInitialized"))||(r.data("psInitialized",1),r.data("initialValue",e),r.off("change").on("change",function(){var e=g(this),a=e.val(),e=e.data("initialValue");a&&a!==e?n.removeAttr("disabled"):n.attr("disabled","disabled")}),p.off("click").on("click",function(){r.val(r.data("initialValue")),a.hide(),n.hide(),p.hide(),t.show(),s.show()}),n.off("click").on("click",function(){var a=n.find("img"),t=r.val();a.is(":visible")||(a.show(),h.postJson("pageajax.set_page_custom_input",{page_id:i,custom_name:o,custom_value:t,_wpnonce:peepsopagesdata.nonce_set_page_custom_input},function(e){a.hide(),e.success&&(r.data("initialValue",t),s.html(r.children("option:selected").text())),p.click()}))}))},e})(e,a)),e(function(){ps_page.init_page(+peepsopagesdata.page_id)})})(jQuery,peepso);