!function r(s,i,a){function n(t,e){if(!i[t]){if(!s[t]){var o="function"==typeof require&&require;if(!e&&o)return o(t,!0);if(d)return d(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}o=i[t]={exports:{}},s[t][0].call(o.exports,function(e){return n(s[t][1][e]||e)},o,o.exports,r,s,i,a)}return i[t].exports}for(var d="function"==typeof require&&require,e=0;e<a.length;e++)n(a[e]);return n}({1:[function(e,t,r){!function(o){!function(){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var e,i=(e="undefined"!=typeof window?window.jQuery:void 0!==o?o.jQuery:null)&&e.__esModule?e:{default:e},a=((e,t)=>{if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};if((t=n(t))&&t.has(e))return t.get(e);var o,r,s={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(o in e)"default"!==o&&{}.hasOwnProperty.call(e,o)&&((r=i?Object.getOwnPropertyDescriptor(e,o):null)&&(r.get||r.set)?Object.defineProperty(s,o,r):s[o]=e[o]);return s.default=e,t&&t.set(e,s),s})("undefined"!=typeof window?window.peepso:void 0!==o?o.peepso:null);function n(e){var t,o;return"function"!=typeof WeakMap?null:(t=new WeakMap,o=new WeakMap,(n=function(e){return e?o:t})(e))}let t=peepsogroupsdata.listItemMemberActionsTemplate;r.default=class{constructor(e){this.id=e.id,this.actions=this.constructor.normalize(e),this.template=(0,a.template)(t),this.$el=(0,i.default)("<div />"),this.$el.on("click","[data-method]",e=>{this.onClick(e)}),this.render()}render(){var e=this.template(_.extend({id:this.id},this.actions));this.$el.html(e)}fetch(){return new Promise((t,o)=>{var e={group_id:this.id,keys:"groupuserajax.member_actions,groupfollowerajax.follower_actions"};a.default.postJson("groupajax.group",e,e=>{e.success?t(e.data):o(e.errors)})})}confirmAction(o){return new Promise((e,t)=>{o?pswindow.confirm(o,()=>{pswindow.hide(),e()},()=>{t()}):e()})}doAction(t,e){return new Promise((o,r)=>{a.default.ajax.post(t,e,-1).done(e=>{if(e.success)if(t.match(/\.(join|leave)$/)){let t=e.data.member_count;this.fetch().then(e=>{_.extend(e,{member_count:t}),o(e)}).catch(e=>{r(e)})}else o(e.data);else r(e.errors)}).fail(r)})}onClick(r){r.preventDefault(),r.stopPropagation();let s=(0,i.default)(r.currentTarget);if(!s.data("ps-loading")){let o=i.default.extend({},s.data());if(o.method&&o.id){let e=s.find("img"),t=(!e.length&&s.parent().hasClass("ps-js-dropdown-menu")&&(e=(e=s.parent().siblings(".ps-js-dropdown-toggle")).find("img"),s.parent().hide()),o.method);r=o.confirm;o.group_id=o.id,delete o.method,delete o.confirm,delete o.id,this.confirmAction(r).then(()=>{s.data("ps-loading",!0),e.show(),this.doAction(t,o).then(e=>{var t=this.constructor.normalize(e);this.actions=_.defaults({},t,this.actions),this.render(),e.member_count&&a.observer.applyFilters("group_update_member_count",this.id,e.member_count)}).catch(()=>{s.removeData("ps-loading"),e.hide()})}).catch(i.default.noop)}}}static normalize(e){let t,o,r;function s(e,t){return _.map(e,e=>(_.isString(e.action)&&e.action.indexOf(".")<0?e.action=t+"."+e.action:_.isArray(e.action)&&(e.action=s(e.action,t)),e))}return(t=(e=e||{}).group||{}).groupuserajax&&void 0!==t.groupuserajax.member_actions?o=s(t.groupuserajax.member_actions||[],"groupuserajax"):void 0!==e.member_actions&&(o=s(e.member_actions||[],"groupuserajax")),t.groupfollowerajax&&void 0!==t.groupfollowerajax.follower_actions?r=s(t.groupfollowerajax.follower_actions||[],"groupfollowerajax"):void 0!==e.follower_actions&&(r=s(e.follower_actions||[],"groupfollowerajax")),{member_actions:o,follower_actions:r}}}}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,o){var r,u,c,h=e("./group-actions").default;function s(){c.observer.addFilter("group_update_member_count",function(e,t){var o,e=u(".ps-js-group-item--"+e).find(".ps-js-member-count");e.length&&(o=1<+t?peepsogroupsdata.lang.members:peepsogroupsdata.lang.member,e.html(t+" "+o))},10,2),u(document.body).on("click",".ps-js-groups .ps-js-member-action",u.proxy(function(e){var t,r,o,s=u(e.currentTarget);e.preventDefault(),e.stopPropagation(),s.data("ps-loading")||(r=u.extend({},s.data())).method&&r.id&&(!(t=s.find("img")).length&&s.parent().hasClass("ps-js-dropdown-menu")&&(t=(t=s.parent().siblings(".ps-js-dropdown-toggle")).find("img"),s.parent().hide()),o=r.method,e=r.confirm,r.group_id=r.id,delete r.method,delete r.confirm,delete r.id,this._member_action_confirmation(e).done(function(){s.data("ps-loading",!0),t.show(),this.member_action(o,r).done(function(e){var t=s.closest(".ps-js-member-actions"),o=c.template(peepsogroupsdata.listItemMemberActionsTemplate)(u.extend({id:r.group_id},e));t.html(o),e.member_count&&c.observer.applyFilters("group_update_member_count",r.group_id,e.member_count)})}))},this)),u(document.body).on("click",".ps-js-groups .ps-js-more",u.proxy(function(e){var t=".ps-js-group-item",o="ps-group--expanded",r=u(e.currentTarget).closest(t);e.preventDefault(),e.stopPropagation(),u(".ps-groups").find(t).each(function(){var e=u(this);e.is(r)&&!e.hasClass(o)?(e.addClass(o),e.find(".ps-js-more span").html(peepsogroupsdata.lang.less)):e.hasClass(o)&&(e.removeClass(o),e.find(".ps-js-more span").html(peepsogroupsdata.lang.more))})},this))}e=jQuery,r=peepso,window.ps_groups=(u=e,c=r,s.prototype._fetch=function(l){return u.Deferred(u.proxy(function(p){var e=(l.category||0)+"";this._fetch_xhr=this._fetch_xhr||{},this._fetch_xhr[e]&&this._fetch_xhr[e].abort(),this._fetch_xhr[e]=c.disableAuth().getJson("groupsajax.search",l,u.proxy(function(e){var t,o,r,s,i,a=c.template(peepsogroupsdata.listItemTemplate),n=(c.template(peepsogroupsdata.listItemMemberActionsTemplate),e.data||{}),d="";if(n.groups&&n.groups.length){for(i=0;i<n.groups.length;i++)(t=n.groups[i]).nameHighlight=t.name||"",s=t.description.match("peepso-markdown"),t.description=s?c.observer.applyFilters("peepso_parse_content",'<div class="peepso-markdown">'+t.description+"</div>"):u("<div/>").html(t.description||"").text(),l.query&&(o=l.query.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),o=RegExp("("+o+")","ig"),r='<span style="background:'+c.getLinkColor(.3)+'">$1</span>',t.nameHighlight=t.nameHighlight.replace(o,r),s||(t.description=(t.description||"").replace(o,r))),d+=a(u.extend({},t,{member_actions:""})),_.defer(function(e){var t=u(".ps-js-group-item--"+e.id).find(".ps-js-member-actions"),e=new h({id:e.id,member_actions:e.groupuserajax.member_actions,follower_actions:e.groupfollowerajax.follower_actions});t.html(e.$el)},t);p.resolveWith(this,[d])}else 1<l.page?p.resolveWith(this,[null]):p.rejectWith(this,[e.errors])},this))},this))},s.prototype._member_action_confirmation=function(t){return u.Deferred(u.proxy(function(e){t?pswindow.confirm(t,u.proxy(function(){pswindow.hide(),e.resolveWith(this)},this),u.proxy(function(){e.rejectWith(this)},this)):e.resolveWith(this)},this))},s.prototype.member_action=function(e,o){return u.Deferred(u.proxy(function(t){(e||"").indexOf(".")<0&&(e="groupuserajax."+e),c.postJson(e,o,u.proxy(function(e){e.success?t.resolveWith(this,[e.data]):t.rejectWith(this,[e.errors])},this))},this))},new s)},{"./group-actions":1}],3:[function(e,t,o){e("./postbox"),e("./groups"),e("./page-groups"),e("./page-groups-categories")},{"./groups":2,"./page-groups":5,"./page-groups-categories":4,"./postbox":6}],4:[function(e,t,o){!function(o){!function(){var a,s,r,i="undefined"!=typeof window?window.peepso:void 0!==o?o.peepso:null,e=jQuery;function t(){t.super_.apply(this,arguments)&&a(a.proxy(this.init_page,this))}a=e,e=peepsodata.groups&&peepsodata.groups.categories||{},s=+e.groups_categories_expand_all,r=+e.groups_categories_group_count||4,peepso.npm.inherits(t,PsPageAutoload),peepso.npm.objectAssign(t.prototype,{init_page:function(){var e;this._search_$ct.length&&(this._search_$ct.on("click",".ps-js-groups-cat .ps-js-group-category-title",a.proxy(this._toggle,this)),e=this._search_$ct.data("mode")||"grid",+peepsodata.currentuserid&&(e=i.ls.get("groups_viewmode_"+peepsodata.currentuserid)||e),this.toggleViewMode(e),a(".ps-js-groups-viewmode").on("click",e=>{e.preventDefault();e=a(e.currentTarget).data("mode");+peepsodata.currentuserid&&i.ls.set("groups_viewmode_"+peepsodata.currentuserid,e),this.toggleViewMode(e)}))},_search_url:"groupcategoriesajax.search",_search_params:{keys:"id,name,description,url,groups_count",page:1},_search_debounced:_.debounce(function(){this._fetch(this._search_params).done(function(e){e=this._search_render_html(e&&e.group_categories);this._search_toggle_loading("hide"),e?(this._search_$ct.append(e),this._search_toggle_autoscroll("on")):(this._render_uncategorized(),this._search_$nomore.show())}).fail(function(e){this._search_toggle_loading("hide"),this._search_params.page<=1?this._render_uncategorized().done(a.proxy(function(){this._search_$nomore.show()},this)).fail(a.proxy(function(){this._search_$ct.html(e.join("<br>"))},this)):(this._render_uncategorized(),this._search_$nomore.show())})},500),toggleViewMode:function(e){var t=a(".ps-js-groups-viewmode"),o=t.filter(`[data-mode="${e}"]`),r=a(".ps-js-groups"),s="ps-btn--active",i="ps-groups__list--single";o.addClass(s),t.not(o).removeClass(s),"list"===e?r.addClass(i):r.removeClass(i)},_search_render_html:function(e){var t,o=peepso.template(peepsogroupsdata.listCategoriesTemplate),r=null;return e&&e.length&&(r="",_.each(e,function(e){r+=o(_.extend({},e)),t=t||e})),s?setTimeout(a.proxy(function(){this._search_$ct.find(".ps-js-groups-cat").filter(function(){return a(this).find(".ps-js-group-category-action i").hasClass("gci-expand-alt")}).find(".ps-js-group-category-title").trigger("click")},this),1):t&&0<+t.groups_count&&setTimeout(a.proxy(function(){this._unfold_first_row||(this._unfold_first_row=!0,this._search_$ct.find(".ps-js-groups-cat").eq(0).find(".ps-js-group-category-title").trigger("click"))},this),1),setTimeout(()=>{var e=this._search_$ct.data("mode")||"grid";+peepsodata.currentuserid&&(e=i.ls.get("groups_viewmode_"+peepsodata.currentuserid)||e),this.toggleViewMode(e)},1),r},_search_get_items:function(){return this._search_$ct.children(".ps-js-group-category-item")},_fetch:function(e){return a.Deferred(a.proxy(function(t){e=a.extend({},e),_.isUndefined(e.limit)||(e.limit*=2),this._fetch_xhr&&this._fetch_xhr.abort(),this._fetch_xhr=peepso.disableAuth().disableError().getJson(this._search_url,e,a.proxy(function(e){e.success?t.resolveWith(this,[e.data]):t.rejectWith(this,[e.errors])},this))},this))},_toggle:function(e){"A"===e.target.tagName&&e.target.href.match(/^https?:\/\//)||(e.preventDefault(),e.stopPropagation(),this._toggle_throttled(e))},_toggle_throttled:_.throttle(function(e){var e=a(e.currentTarget).find(".ps-js-group-category-action i"),t=e.closest(".ps-js-groups-cat"),o="gcis gci-compress-alt";e.hasClass(o)?(e.attr("class","gcis gci-expand-alt"),t.find(".ps-js-groups").hide(),this._collapse(t)):(e.attr("class",o),t.find(".ps-js-groups").show(),this._expand(t))},500),_expand:function(t){var e,o="ps-js-loaded";t.addClass("ps-groups__category--open"),t.hasClass(o)||(e={uid:peepsodata.currentuserid,user_id:void 0,query:"",category:t.data("id"),order_by:void 0,order:void 0,admin:void 0,keys:"id,name,description,date_created_formatted,members_count,url,published,avatar_url_full,cover_url,privacy,groupuserajax.member_actions,groupfollowerajax.follower_actions",limit:r,page:1},ps_groups._fetch(e).done(function(e){t.addClass(o),t.find(".ps-js-groups").html(e),t.find(".ps-js-group-category-footer").show()}).fail(function(e){t.addClass(o),t.find(".ps-js-groups").html(e.join("<br>")),t.find(".ps-js-group-category-footer").remove()}))},_collapse:function(e){e.removeClass("ps-groups__category--open")},_render_uncategorized:function(){var r=this;return a.Deferred(function(o){var e={uid:peepsodata.currentuserid,user_id:void 0,query:"",category:-1,order_by:void 0,order:void 0,admin:void 0,keys:"id,name,description,date_created_formatted,members_count,url,published,avatar_url_full,cover_url,privacy,groupuserajax.member_actions,groupfollowerajax.follower_actions",limit:1,page:1};ps_groups._fetch(e).done(function(){var e,t;e=peepsogroupsdata.lang.uncategorized,t=peepsogroupsdata.group_url.replace("##category_id##","-1"),(e=r._search_render_html([{id:"-1",name:e,url:t,__uncategorized:!0}]))&&r._search_$ct.append(e),o.resolve()}).fail(function(e){o.reject()})})}}),new t(".ps-js-group-cats")}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],5:[function(r,e,t){!function(o){!function(){var p=e("undefined"!=typeof window?window.jQuery:void 0!==o?o.jQuery:null),l=e("undefined"!=typeof window?window._:void 0!==o?o._:null),u=((e,t)=>{if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};if((t=a(t))&&t.has(e))return t.get(e);var o,r,s={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(o in e)"default"!==o&&{}.hasOwnProperty.call(e,o)&&((r=i?Object.getOwnPropertyDescriptor(e,o):null)&&(r.get||r.set)?Object.defineProperty(s,o,r):s[o]=e[o]);return s.default=e,t&&t.set(e,s),s})("undefined"!=typeof window?window.peepso:void 0!==o?o.peepso:null),c=e(r("./group-actions"));function a(e){var t,o;return"function"!=typeof WeakMap?null:(t=new WeakMap,o=new WeakMap,(a=function(e){return e?o:t})(e))}function e(e){return e&&e.__esModule?e:{default:e}}let h=peepsogroupsdata.listItemTemplate,_=peepsogroupsdata.listItemMemberActionsTemplate;class t extends PsPageAutoload{constructor(e){super(e),this._search_url="groupsajax.search",this._search_params={uid:peepsodata.currentuserid,user_id:void 0,query:"",category:0,order_by:void 0,order:void 0,admin:void 0,keys:"id,name,description,date_created_formatted,members_count,url,published,avatar_url_full,cover_url,privacy,groupuserajax.member_actions,groupfollowerajax.follower_actions",limit:2,page:1}}onDocumentLoaded(){if(!1===super.onDocumentLoaded())return!1;this._search_$query=(0,p.default)(".ps-js-groups-query"),this._search_$sortby=(0,p.default)(".ps-js-groups-sortby"),this._search_$sortorder=(0,p.default)(".ps-js-groups-sortby-order"),this._search_$category=(0,p.default)(".ps-js-groups-category"),this._search_$searchmode=(0,p.default)(".ps-js-groups-search-mode"),this._search_params.user_id=+peepsodata.userid||void 0,this._search_params.category=this._search_$category.val()||0,this._search_params.search_mode=this._search_$searchmode.val()||void 0,this._search_$query.on("input",()=>{this._filter()}),this._search_$sortby.on("change",()=>{this._filter()}),this._search_$sortorder.on("change",()=>{this._filter()}),this._search_$category.on("change",e=>{this._filter_category(e)}),this._search_$searchmode.on("change",()=>{this._filter()}),(0,p.default)(".ps-form-search-opt").on("click",()=>{this._toggle()});var e=this._search_$ct.data("mode")||"grid";+peepsodata.currentuserid&&(e=u.ls.get("groups_viewmode_"+peepsodata.currentuserid)||e),this.toggleViewMode(e),(0,p.default)(".ps-js-groups-viewmode").on("click",e=>{e.preventDefault();e=(0,p.default)(e.currentTarget).data("mode");+peepsodata.currentuserid&&u.ls.set("groups_viewmode_"+peepsodata.currentuserid,e),this.toggleViewMode(e)}),this._filter()}toggleViewMode(e){var t=(0,p.default)(".ps-js-groups-viewmode"),o=t.filter(`[data-mode="${e}"]`),r=(0,p.default)(".ps-js-groups"),s="ps-btn--active",i="ps-groups__list--single";o.addClass(s),t.not(o).removeClass(s),"list"===e?r.addClass(i):r.removeClass(i)}_search_render_html(e){let t=(0,u.template)(h),o=((0,u.template)(_),this._search_params.query),r="",s,i,a,n,d;if(e.groups&&e.groups.length)for(d=0;d<e.groups.length;d++)(s=e.groups[d]).nameHighlight=s.name||"",n=s.description.match("peepso-markdown"),s.description=n?u.default.observer.applyFilters("peepso_parse_content",'<div class="peepso-markdown">'+s.description+"</div>"):(0,p.default)("<div/>").html(s.description||"").text(),o&&(i=l.default.filter(o.split(" "),function(e){return""!==e}),i=l.default.map(i,function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}),i=RegExp("("+i.join("|")+")","ig"),a='<span style="background:'+u.default.getLinkColor(.3)+'">$1</span>',s.nameHighlight=s.nameHighlight.replace(i,a),n||(s.description=(s.description||"").replace(i,a))),r+=t(p.default.extend({},s,{member_actions:""})),l.default.defer(function(e){var t=(0,p.default)(".ps-js-group-item--"+e.id).find(".ps-js-member-actions"),e=new c.default({id:e.id,member_actions:e.groupuserajax.member_actions,follower_actions:e.groupfollowerajax.follower_actions});t.html(e.$el)},s);return r}_search_get_items(){return this._search_$ct.children(".ps-js-group-item")}_search_should_load_more(){var e=+peepsodata.activity_limit_below_fold,t=this._search_get_items();return this._search_loadmore_enable&&this._search_loadmore_repeat?!(t.length>=this._search_loadmore_repeat*this._search_params.page):(e=0<e?e:3,this._search_params.limit&&(e*=this._search_params.limit),!!((t=t.slice(0-e).eq(0)).length&&(this._search_loadmore_enable?t.eq(0).offset():t.get(0).getBoundingClientRect()).top<(window.innerHeight||document.documentElement.clientHeight)))}_fetch(r){return p.default.Deferred(t=>{var e=u.default.disableAuth().disableError(),o=this._search_url;r=p.default.extend({},r),this._search_loadmore_enable&&this._search_loadmore_repeat?r.limit=this._search_loadmore_repeat:l.default.isUndefined(r.limit)||(r.limit*=2),this._fetch_xhr&&this._fetch_xhr.abort(),this._fetch_xhr=e.getJson(o,r,e=>{e.success?t.resolveWith(this,[e.data]):t.rejectWith(this,[e.errors])})})}_filter(){this._fetch_xhr&&this._fetch_xhr.abort(),this._search_params.query=p.default.trim(this._search_$query.val()),this._search_params.category=this._search_$category.val(),this._search_params.order_by=this._search_$sortby.val(),this._search_params.order=this._search_$sortorder.val(),this._search_params.search_mode=this._search_$searchmode.val(),this._search_params.page=1,this._search()}_filter_category(e){this._filter();let t=window.location.href,o=/(category=)-?\d+/,r=e.target.value||0;t.match(o)&&(t=t.replace(o,"$1"+r),window.history)&&history.pushState&&history.pushState(null,"",t)}_toggle(){(0,p.default)(".ps-js-page-filters").stop().slideToggle()}}new t(".ps-js-groups")}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./group-actions":1}],6:[function(e,t,o){e("./postbox"),e("./postbox-new")},{"./postbox":8,"./postbox-new":7}],7:[function(e,t,o){!function(t){!function(){var u=e("undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null),o=(e("undefined"!=typeof window?window._:void 0!==t?t._:null),"undefined"!=typeof window?window.peepso:void 0!==t?t.peepso:null),c="undefined"!=typeof window?window.peepsodata:void 0!==t?t.peepsodata:null;function e(e){return e&&e.__esModule?e:{default:e}}let r=window.peepsogroupsdata&&+peepsogroupsdata.group_id,s=window.peepsogroupsdata&&+peepsogroupsdata.module_id;o.hooks.addFilter("postbox_data",(e,t)=>(r&&(e.module_id=s,e.group_id=r),e)),o.hooks.addFilter("postbox_validate",(e,t,o)=>e=!(window.peepsoGroupCategory&&+peepsoGroupCategory.id)||o.module_id&&o.group_id?e:!1,100),o.hooks.addAction("postbox_option_init",(e,t)=>{if(void 0!==e.postTo){e=e.$dropdown.find("[data-value=group]");if(e.length){let r=window.peepsoGroupCategory&&+peepsoGroupCategory.id,s=e.find("[name=query]"),i=e.find(".ps-js-loading"),a=e.find(".ps-js-result"),n=e.find(".ps-js-result-list"),d=(0,o.template)(e.find(".ps-js-result-item-template").text()),p,l;s.one("focus",()=>s.trigger("input")),s.on("input",e=>{let o=p=Date.now();var t;n.empty(),a.hide(),i.show(),l&&l.abort(),l=([t=""]=[s.val().trim()],t={uid:c.currentuserid,user_id:c.currentuserid,category:r,query:t.trim(),writable_only:1,keys:"id,name,description,avatar_url_full,privacy,groupuserajax.can_pin_posts",order_by:"post_title",order:"ASC",limit:40,page:1},u.default.ajax({url:c.ajaxurl_legacy+"groupsajax.search",type:"GET",dataType:"json",beforeSend:e=>e.setRequestHeader("X-PeepSo-Nonce",c.peepso_nonce),data:t}).always(()=>l=null).done(t=>{if(o===p&&(i.hide(),a.show(),t)&&t.data){t=t.data;let e=`<i>${c.groups.textNoResult}</i>`;t.groups&&t.groups.length&&(e=t.groups.map(e=>d(e))),n.html(e)}}))})}}})}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(e,t,o){!function(p){!function(){var r=e("undefined"!=typeof window?window.jQuery:void 0!==p?p.jQuery:null),s=(e("undefined"!=typeof window?window._:void 0!==p?p._:null),((e,t)=>{if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};if((t=a(t))&&t.has(e))return t.get(e);var o,r,s={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(o in e)"default"!==o&&{}.hasOwnProperty.call(e,o)&&((r=i?Object.getOwnPropertyDescriptor(e,o):null)&&(r.get||r.set)?Object.defineProperty(s,o,r):s[o]=e[o]);return s.default=e,t&&t.set(e,s),s})("undefined"!=typeof window?window.peepso:void 0!==p?p.peepso:null)),i="undefined"!=typeof window?window.peepsodata:void 0!==p?p.peepsodata:null;function a(e){var t,o;return"function"!=typeof WeakMap?null:(t=new WeakMap,o=new WeakMap,(a=function(e){return e?o:t})(e))}function e(e){return e&&e.__esModule?e:{default:e}}let o=window.peepsogroupsdata.module_id,n=+window.peepsogroupsdata.force_posts_in_groups;var t=s.observer.applyFilters("class_postbox_dropdown",10,1);class d extends t{constructor(e){super(e.find("#group-tab")[0]),this.$postbox=e,this.$selected=this.$container.find(".ps-postbox__menu-item-label").hide(),this.$radio=this.$container.find("[type=radio]"),this.$finder=this.$container.find(".ps-js-group-finder"),this.$search=this.$finder.find("input[type=text]"),this.$loading=this.$finder.find(".ps-js-loading"),this.$result=this.$finder.find(".ps-js-result"),this.CATEGORY_ID=void 0,window.peepsoGroupCategory&&(this.CATEGORY_ID=+window.peepsoGroupCategory.id),this.resultTemplate=s.default.template(this.$result.find(".ps-js-result-item-template").text()),this.$dropdown.on("click","[data-option-value]",e=>{var t=(0,r.default)(e.currentTarget).data("optionValue");e.stopPropagation(),this.select(t),"group"!==t&&this.hide()}),this.$postbox.on("postbox.post_cancel postbox.post_saved",()=>this.remove()),s.observer.addFilter("postbox_req",r.default.proxy(this.filterPostboxReq,this),10,1),s.hooks.addFilter("postbox_can_submit","postbox_group",r.default.proxy(this.filterPostboxCanSubmit,this))}show(){super.show(),(n||this.CATEGORY_ID)&&(this.$radio.eq(0).closest("[data-option-value]").hide(),this.$dropdown.find("[data-option-value] .ps-checkbox").hide(),this.select("group"),this.$finder.show())}hide(){super.hide(),this.$radio.get(1).checked&&!this.value()&&(this.$radio.get(0).checked=!0,this.$finder.hide(),this.$container.removeClass("active"),this.$selected.hide())}value(){let e;return e=this.$radio.get(1).checked&&this.selectedGroup?this.selectedGroup:e}select(e){n||"group"===e?!n&&"group"!==e||(this.$radio.get(1).checked=!0,this.$finder.show(),this.initFinder()):(this.remove(),this.hide())}remove(){var e=!!this.selectedGroup;this.selectedGroup=void 0,this.$radio.get(0).checked=!0,this.$finder.hide(),this.$container.removeClass("active"),this.$selected.hide(),e&&s.observer.doAction("postbox_group_reset",this.$postbox)}search(t,o){var e,r;return t=(t||"").trim(),o=parseInt(o)||1,e={uid:i.currentuserid,user_id:i.currentuserid,category:this.CATEGORY_ID,query:t,writable_only:1,keys:"id,name,description,avatar_url_full,privacy,groupuserajax.can_pin_posts",order_by:"post_title",order:"ASC",limit:10,page:o},r=e=>{e&&e.data&&(this.query=t,this.page=o,this.render(e.data,o),this.searchEnd=!(e.data&&e.data.groups&&e.data.groups.length))},this.xhr&&this.xhr.abort(),this.xhr=s.default.disableAuth().getJson("groupsajax.search",e,r),this.xhr}render(t,e){var o=this.$result.children(".ps-js-result-list");if(t=t||{},1===(e=e||1)&&o.empty(),t&&t.groups&&t.groups.length)for(let e=0;e<t.groups.length;e++)o.append(this.resultTemplate(t.groups[e]));else 1===e&&o.append(`<li><em>${i.groups.textNoResult}</em></li>`)}initFinder(){this._initialSearch||(this.$search.on("keydown",r.default.proxy(this.onQueryEnter,this)),this.$search.on("input",r.default.proxy(this.onQueryInput,this)),this.$search.on("click",e=>e.stopPropagation()),this.$result.on("click","[data-id]",r.default.proxy(this.onResultSelect,this)),this.$result.on("scroll",r.default.proxy(this.onResultScroll,this)),this.$result.hide(),this.$loading.show(),this.search().always(()=>{this.$loading.hide(),this.$result.show()}),this._initialSearch=!0)}onQueryInput(){let e=this.$search.val(),t=e.replace(/^\s+/,"");e!==t&&this.$search.val(t),this.$result.hide(),this.$loading.show(),clearTimeout(this._onQueryTimer),this._onQueryTimer=setTimeout(r.default.proxy(function(){this.search(t,1).always(r.default.proxy(function(){this.$loading.hide(),this.$result.show()},this))},this),1e3)}onQueryEnter(e){13===e.keyCode&&(e.preventDefault(),e=this.$search.val().replace(/(^\s+|\s+$)/g,""),clearTimeout(this._onQueryTimer),this.$result.hide(),this.$loading.show(),this.search(e,1).always(r.default.proxy(function(){this.$loading.hide(),this.$result.show()},this)))}onResultSelect(e){var e=(0,r.default)(e.currentTarget),t=e.data("id"),o=e.data("name"),e={can_pin_posts:e.data("can-pin-posts")};this.selectedGroup=t,this.$container.addClass("active"),this.$selected.html(o).show(),this.hide(),s.observer.doAction("postbox_group_set",this.$postbox,this.selectedGroup,e)}onResultScroll(e){e.stopPropagation(),!this.searchEnd&&this.$loading.is(":hidden")&&this.$result[0].scrollHeight<=this.$result.scrollTop()+this.$result.innerHeight()&&(this.$loading.show(),this.search(this.query,this.page+1).always(()=>this.$loading.hide()))}filterPostboxReq(e){var t=this.value();return t&&(e.module_id=o,e.group_id=t,e.force_as_group_post=1,e.acc=void 0),e}filterPostboxCanSubmit(e,t){return t!==this.$postbox||!n&&!this.CATEGORY_ID||this.value()||(e=!1,this.show()),e}}s.observer.addAction("peepso_postbox_addons",e=>(e.push({init(){},set_postbox(e){e.find("#group-tab").length&&new d(e)}}),e),10,1),s.observer.addAction("postbox_init",e=>{e.$el.find("#group-tab").remove()},10,1)}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[3]);