!function s(i,p,h){function n(t,o){if(!p[t]){if(!i[t]){var e="function"==typeof require&&require;if(!o&&e)return e(t,!0);if(r)return r(t,!0);throw(o=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",o}e=p[t]={exports:{}},i[t][0].call(e.exports,function(o){return n(i[t][1][o]||o)},e,e.exports,s,i,p,h)}return p[t].exports}for(var r="function"==typeof require&&require,o=0;o<h.length;o++)n(h[o]);return n}({1:[function(o,t,e){o("./postbox"),o("./postbox-new"),o("./messagebox")},{"./messagebox":2,"./postbox":4,"./postbox-new":3}],2:[function(o,t,e){peepso.hooks.addAction("messagebox_init","photo",o=>{var t,e="MessageboxTypePhoto";t=e,peepso.class(t)||peepso.class(t,function(o,s,t){return class extends s.class("MessageboxType"){constructor(o,t="photo"){super(o,t),this.valid=!1,this.dropzone=null,this.lastData=null,this.$uploadButton=this.$el.find(".ps-postbox-photo-upload"),this.$uploadPreview=this.$el.find(".ps-postbox-preview"),this.$uploadButton.on("click",()=>this.upload())}show(){super.show(),this.dropzoneInit()}upload(){this.dropzone.triggerUpload()}onFilterData(o,t){return t===this.messagebox&&this.active&&(this.maybeMoveTempFiles(o,this.lastData),this.lastData=Object.assign({},o),o.type="photo",o.files=this.dropzone.getPhotos()),o}onFilterValidate(o,t,e){return o=t===this.messagebox&&this.active?this.valid:o}onFilterIsEmpty(o,t,e){return o=t===this.messagebox&&this.active&&0<e.files.length?!1:o}onActionSaved(o){o===this.messagebox&&(this.saved=!0)}onActionReset(o){o===this.messagebox&&(this.hide(),this.dropzone&&this.dropzone.empty(this.saved?"save":""),this.lastData=null,this.$uploadPreview.hide(),this.$uploadButton.show(),delete this.saved)}onClickToggle(o){super.onClickToggle(o),this.dropzone.getPhotos().length||this.upload()}onClickShortcut(o){super.onClickShortcut(o),this.dropzone.getPhotos().length||this.upload()}dropzoneInit(){this.dropzone||(this.dropzone=new s.PhotoDropzone(this.$uploadPreview),this.dropzone.on("photo_added",()=>this.dropzonePhotoAdded()),this.dropzone.on("photo_upload_start",()=>this.dropzonePhotoUploadStart()),this.dropzone.on("photo_upload_done",o=>this.dropzonePhotoUploadDone(o)),this.dropzone.on("photo_empty",()=>this.dropzonePhotoEmpty()),this.dropzone.addDroppable(this.$uploadButton[0]))}dropzonePhotoAdded(){this.$uploadButton.hide(),this.$uploadPreview.show()}dropzonePhotoUploadStart(){this.valid=!1}dropzonePhotoUploadDone(o){o<=0&&(this.valid=!0,this.messagebox.$textarea.trigger("input"))}dropzonePhotoEmpty(){this.valid=!1,this.$uploadPreview.hide(),this.$uploadButton.show(),this.messagebox.$textarea.trigger("input")}maybeMoveTempFiles(o,t){var e;t&&!this.saved&&(e=this.dropzone.getPhotos())&&e.length&&(o.page_id===t.page_id&&o.group_id===t.group_id||(t={user_id:peepsodata.currentuserid,old_group_id:t.group_id,old_page_id:t.page_id,group_id:o.group_id,page_id:o.page_id,photo:e,_wpnonce:this.$typeInput.find("[name=_wpnonce_remove_temp_files]").val(),_wp_http_referer:this.$typeInput.find("[name=_wp_http_referer]").val()},s.postJson("photosajax.move_temp_files",t)))}}}),new(peepso.class(e))(o)})},{}],3:[function(o,t,e){peepso.class("PostboxTypePhoto",function(t,s,o){var e=s.hooks;return e.addAction("postbox_init","photo",o=>new(s.class(t))(o)),class extends s.class("PostboxType"){constructor(o,t="photo"){super(o,t),this.valid=!1,this.dropzone=null,this.lastData=null,this.$uploadButton=this.$postbox.find(".ps-postbox-photo-upload"),this.$uploadPreview=this.$postbox.find(".ps-postbox-preview"),this.$uploadButton.on("click",()=>this.upload())}show(){super.show(),this.dropzoneInit()}upload(){this.dropzone.triggerUpload()}onFilterData(o,t){return t===this.postbox&&this.active&&(this.maybeMoveTempFiles(o,this.lastData),this.lastData=Object.assign({},o),o.type="photo",o.files=this.dropzone.getPhotos()),o}onFilterValidate(o,t,e){return o=t===this.postbox&&this.active?this.valid:o}onFilterIsEmpty(o,t,e){return o=t===this.postbox&&this.active&&0<e.files.length?!1:o}onActionSaved(o){o===this.postbox&&(this.saved=!0)}onActionReset(o){o===this.postbox&&(this.hide(),this.dropzone&&this.dropzone.empty(this.saved?"save":""),this.lastData=null,this.$uploadPreview.hide(),this.$uploadButton.show(),delete this.saved)}onClickToggle(o){super.onClickToggle(o),this.dropzone.getPhotos().length||this.upload()}onClickShortcut(o){super.onClickShortcut(o),this.dropzone.getPhotos().length||this.upload()}dropzoneInit(){this.dropzone||(this.dropzone=new s.PhotoDropzone(this.$uploadPreview),this.dropzone.on("photo_added",()=>this.dropzonePhotoAdded()),this.dropzone.on("photo_upload_start",()=>this.dropzonePhotoUploadStart()),this.dropzone.on("photo_upload_done",o=>this.dropzonePhotoUploadDone(o)),this.dropzone.on("photo_empty",()=>this.dropzonePhotoEmpty()),this.dropzone.addDroppable(this.$uploadButton[0]))}dropzonePhotoAdded(){this.$uploadButton.hide(),this.$uploadPreview.show()}dropzonePhotoUploadStart(){this.valid=!1}dropzonePhotoUploadDone(o){o<=0&&(this.valid=!0,this.postbox.$textarea.trigger("input"))}dropzonePhotoEmpty(){this.valid=!1,this.$uploadPreview.hide(),this.$uploadButton.show(),this.postbox.$textarea.trigger("input")}maybeMoveTempFiles(o,t){var e;t&&!this.saved&&(e=this.dropzone.getPhotos())&&e.length&&(o.page_id===t.page_id&&o.group_id===t.group_id||(t={user_id:peepsodata.currentuserid,old_group_id:t.group_id,old_page_id:t.page_id,group_id:o.group_id,page_id:o.page_id,photo:e,_wpnonce:this.$typeInput.find("[name=_wpnonce_remove_temp_files]").val(),_wp_http_referer:this.$typeInput.find("[name=_wp_http_referer]").val()},s.postJson("photosajax.move_temp_files",t)))}}})},{}],4:[function(o,t,e){var s,i,p,h;s=jQuery,i="PsPostboxPhoto",p=s,h=peepso.createClass(i,{__constructor:function(){this.canSubmitFlag=!1,this.dropzone=null},set_postbox:function(o){this.$postbox=o,this.$posttab=o.$posttabs},init:function(){this.initialize()},initialize:function(){this.$text=this.$postbox.$textarea,this.$textContainer=this.$text.closest(".ps-postbox-status");var o=this.$postbox.find(".ps-postbox-tabs").children("[data-tab-id=photos]");this.$uploadButton=o.find(".ps-postbox-photo-upload"),this.$uploadPreview=o.find(".ps-postbox-preview"),this.$posttab.on("peepso_posttabs_show-photos",p.proxy(this.show,this)),this.$posttab.on("peepso_posttabs_cancel-photos",p.proxy(this.cancel,this)),this.$posttab.on("peepso_posttabs_submit-photos",p.proxy(this.post,this)),peepso.observer.addAction("postbox_type_set",p.proxy(function(o,t){o===this.$postbox&&"photos"===t&&this.$phototab.trigger("click")},this),10,2),this.$uploadButton.on("click",p.proxy(this.upload,this)),this.$phototab=this.$postbox.find("#photo-post"),this.$phototab.on("click",p.proxy(this.onCameraTabClick,this)),this.placeholderDefault=this.$text.attr("placeholder"),this.placeholderPhoto=p("#photo-comment-label").text(),peepso.observer.addFilter("peepso_postbox_can_submit",p.proxy(this.canSubmit,this),20,1),peepso.observer.addAction("psmessage_new_message_close",p.proxy(function(o){this.dropzone.empty()},this),10,1),peepso.observer.addAction("postbox_group_set",p.proxy(function(o,t){this.oldGroupId=this.groupId,this.groupId=t,this.$postbox===o&&this.dropzone.movePhotos(this.oldGroupId,this.groupId)},this),10,2),peepso.observer.addAction("postbox_group_reset",p.proxy(function(o,t){this.$postbox===o&&(this.dropzone.movePhotos(this.groupId,void 0),this.groupId=void 0)},this),10,2),peepso.observer.addFilter("photos_validate_req",p.proxy(function(o,t){return this.dropzone===t&&this.groupId&&(o.group_id=this.groupId,o.module_id=window.peepsogroupsdata&&peepsogroupsdata.module_id),o},this),10,2),peepso.observer.addFilter("photos_upload_req",p.proxy(function(o,t){return this.dropzone===t&&this.groupId&&(o.group_id=this.groupId,o.module_id=window.peepsogroupsdata&&peepsogroupsdata.module_id),o},this),10,2),peepso.observer.addFilter("photos_rotate_req",p.proxy(function(o,t){return this.dropzone===t&&this.groupId&&(o.group_id=this.groupId,o.module_id=window.peepsogroupsdata&&peepsogroupsdata.module_id),o},this),10,2)},show:function(o,t){t.show(),this.showButton(),this.$phototab.addClass("active"),this.$text.attr("placeholder",this.placeholderPhoto),this.dropzoneInit()},showButton:function(){this.$uploadPreview.hide(),this.$textContainer.show(),this.$uploadButton.show(),this.$postbox.on_change()},showPreview:function(){this.$uploadButton.hide(),this.$uploadPreview.show(),this.$textContainer.show(),this.$text.focus()},upload:function(){this.dropzone.triggerUpload()},cancel:function(){this.dropzone.empty(),this.showButton(),this.$phototab.removeClass("active"),this.$text.attr("placeholder",this.placeholderDefault)},post:function(){var o="postbox_req_"+this.$postbox.guid;peepso.observer.addFilter(o,this.postSetRequest,10,1,this),this.$postbox.save_post(),peepso.observer.removeFilter(o,this.postSetRequest,10),this.dropzone.empty("save")},postSetRequest:function(o){return p.extend(o,{files:this.dropzone.getPhotos(),type:"photo"})},canSubmit:function(o){return"photos"===this.$posttab.current_tab_id&&o.hard.push(this.canSubmitFlag),o},dropzoneInit:function(){this.dropzone||(this.dropzone=new peepso.PhotoDropzone(this.$uploadPreview),this.dropzone.on("photo_added",p.proxy(this.dropzonePhotoAdded,this)),this.dropzone.on("photo_upload_start",p.proxy(this.dropzonePhotoUploadStart,this)),this.dropzone.on("photo_upload_done",p.proxy(this.dropzonePhotoUploadDone,this)),this.dropzone.on("photo_empty",p.proxy(this.dropzonePhotoEmpty,this)),this.dropzone.addDroppable(this.$uploadButton[0]))},dropzonePhotoAdded:function(){this.showPreview()},dropzonePhotoUploadStart:function(){this.canSubmitFlag=!1},dropzonePhotoUploadDone:function(o){o<=0&&(this.canSubmitFlag=!0,this.$postbox.on_change())},dropzonePhotoEmpty:function(){this.canSubmitFlag=!1,"photos"===this.$posttab.current_tab_id&&this.showButton()},onCameraTabClick:function(){"photos"!==this.$posttab.current_tab_id&&this.$postbox.find("[data-tab=photos]").trigger("click")}}),peepso.observer.addFilter("peepso_postbox_addons",function(o){return o.push(new h),o},10,1),peepso.observer.addAction("postbox_init",function(o){o.$tabContext.find("#photo-post").remove()},10,1)},{}]},{},[1]);