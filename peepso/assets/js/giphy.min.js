!function s(o,n,r){function h(e,t){if(!n[e]){if(!o[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(a)return a(e,!0);throw(t=new Error("Cannot find module '"+e+"'")).code="MODULE_NOT_FOUND",t}i=n[e]={exports:{}},o[e][0].call(i.exports,function(t){return h(o[e][1][t]||t)},i,i.exports,s,o,n,r)}return n[e].exports}for(var a="function"==typeof require&&require,t=0;t<r.length;t++)h(r[t]);return h}({1:[function(t,e,i){var s,h,r,o,n;s=window,n=o="PsGiphyComment",h=s.jQuery,r=t("./giphy.js"),n=peepso.createClass(n,{__constructor:function(){this.template=peepsogiphydata.dialogGiphyTemplate,peepso.observer.addFilter("comment_show_button",this.shouldShowButton,10,1),peepso.observer.addFilter("comment_can_submit",this.isSubmittable,10,1),peepso.observer.addFilter("comment_req",this.filterRequest,10,2),peepso.observer.addAction("comment_edit",this.onEdit,10,2),h(h.proxy(this.onDocumentLoaded,this))},onDocumentLoaded:function(){h(document).on("click",".ps-js-comment-giphy",h.proxy(this.onAttach,this)),h(document).on("click",".ps-js-addon-giphy .ps-js-remove",h.proxy(this.onRemove,this)),h(document).on("ps_comment_aftersave",h.proxy(this.onSaved,this))},onAttach:_.throttle(function(t){var e,i="ps-giphy-initialized",s="ps-giphy-loading",o=peepso.rtl,n=h(t.currentTarget);function r(t){t.show(),t[0].focus(),t.css({backgroundColor:peepso.getLinkColor()}),t.css({transition:"background-color 3s ease"}),setTimeout(()=>{t.css({backgroundColor:""})},500)}t.preventDefault(),t.stopPropagation(),t=n.closest(".ps-js-comment-new, .ps-js-comment-edit"),(e=t.prev(".ps-js-giphy-container")).length||((e=h(this.template)).data("act-id",t.data("id")),e.find(".ps-js-giphy-list").css("transition",`margin-${o?"right":"left"} .5s`),e.hide().insertBefore(t),e.on("input",".ps-js-giphy-query",h.proxy(this.onSearch,this)),e.on("click",".ps-js-giphy-list img",h.proxy(this.onSelectImage,this)),e.on("click",".ps-js-giphy-nav-left",t=>this.onScroll(t,"left")),e.on("click",".ps-js-giphy-nav-right",t=>this.onScroll(t,"right"))),e.is(":visible")?e.hide():(e.show(),e.data(i)||e.data(s)?r(e.find(".ps-js-giphy-query")):(e.data(s,!0),this.search(e).done(h.proxy(function(){e.data(i,!0),e.removeData(s),r(e.find(".ps-js-giphy-query"))},this))))},1e3),search:function(o,n){return h.Deferred(h.proxy(function(e){var t=r.getInstance(),i=o.find(".ps-js-giphy-loading").show(),s=o.find(".ps-js-giphy-list").hide();t.search(n).done(h.proxy(function(t){this.render(o,t),i.hide(),s.show(),e.resolveWith(this)},this))},this))},render:function(t,e){var i=t.find(".ps-js-giphy-list"),t=t.find(".ps-js-giphy-list-item"),n=peepso.template(t.html()),r=peepsogiphydata.giphy_rendition_comments||"fixed_width",t=_.map(e,function(t,e){var i=t.images,s=i[r],o="";return s&&(i=i.preview_gif||i.downsized_still||i.fixed_width_still||i.original_still)&&(h.extend(t,{src:s.url,preview:i.url}),o=n(t)),o});i.html(t.join(""))},onSearch:function(t){var t=h(t.currentTarget),e=t.closest(".ps-js-giphy-container"),i=e.find(".ps-js-giphy-list"),s=e.find(".ps-js-giphy-loading"),o=peepso.rtl;i.hide().css(o?"marginRight":"marginLeft",0),s.show(),this._onSearch(e,t)},_onSearch:_.debounce(function(t,e){this.search(t,h.trim(e.val()))},1e3),onSelectImage:function(t){var t=h(t.currentTarget),e=t.closest(".ps-js-giphy-container"),i=t.attr("src"),t=t.attr("data-url");this.select(e,i,t),e.hide()},onScroll:function(t,e){var i=peepso.rtl,t=h(t.currentTarget).closest(".ps-js-slider"),s=t.find(".ps-js-giphy-list"),t=t.width(),o=parseInt(s.css(i?"marginRight":"marginLeft"))||0;e===(i?"right":"left")?o=Math.min(o+t,0):e===(i?"left":"right")&&(e=s.children(".ps-js-giphy-item").last(),e=i?Math.abs(e.position().left):e.position().left+e.width()-t,o-=Math.min(t,e)),s.css(i?"marginRight":"marginLeft",o)},select:function(t,e,i){t=t.siblings(".ps-js-comment-new, .ps-js-comment-edit").find(".ps-js-addons").find(".ps-js-addon-giphy");t.find(".ps-js-remove").show(),t.find(".ps-js-img").attr("src",e).attr("data-url",i).show(),t.show(),h(document).trigger("ps_comment_addon_added",t)},onRemove:function(t){t=h(t.currentTarget).closest(".ps-js-addon-giphy");t.find(".ps-js-remove").hide(),t.find(".ps-js-img").attr("src","").attr("data-url","").hide(),t.hide(),h(document).trigger("ps_comment_addon_removed",t)},shouldShowButton:function(t){var e=h(t.el).closest(".ps-js-comment-new, .ps-js-comment-edit").find(".ps-js-addon-giphy");return e.is(":visible")&&(e=e.find(".ps-js-img")).length&&e.attr("src")&&(t.show=!0),t},isSubmittable:function(t){var e=h(t.el).closest(".ps-js-comment-new, .ps-js-comment-edit").find(".ps-js-addon-giphy");return e.is(":visible")&&(e=e.find(".ps-js-img")).length&&e.attr("src")&&(t.can_submit=!0),t},filterRequest:function(t,e){var e=h(e).closest(".ps-js-comment-new, .ps-js-comment-edit").find(".ps-js-addon-giphy");return e.is(":visible")&&(e=e.find(".ps-js-img")).length&&e.attr("data-url")&&(t.giphy=e.attr("data-url"),t.giphy=t.giphy.replace(/^[a-z]+:\/\//i,"")),t},onSaved:function(t,e,i){i=h(i).closest(".ps-js-comment-new, .ps-js-comment-edit").find(".ps-js-addon-giphy");i.find(".ps-js-remove").hide(),i.find(".ps-js-img").attr("src","").hide(),i.hide(),h(document).trigger("ps_comment_addon_removed",i)},onEdit:function(t,e){var e=h(e).find(".ps-js-addon-giphy"),i=e.find(".ps-js-img");i.length&&i.attr("src")?(e.find(".ps-js-remove").show(),e.find(".ps-js-img").show(),e.show(),h(document).trigger("ps_comment_addon_added",e)):(e.find(".ps-js-remove").hide(),e.find(".ps-js-img").hide(),e.hide(),h(document).trigger("ps_comment_addon_removed",e))}}),"object"==typeof e&&e.exports?e.exports=n:s[o]=n,new n},{"./giphy.js":2}],2:[function(t,e,i){var s,o,n,r,h;s=window,n="PsGiphy",o=s.jQuery,r=peepso.createClass(n,{__constructor:function(){this.apiKey=peepsogiphydata.giphy_api_key,this.displayLimit=peepsogiphydata.giphy_display_limit,this.rating=peepsogiphydata.giphy_rating},search:function(i){return i=o.trim(i||""),o.Deferred(o.proxy(function(e){this._result||(this._result={});var t=this._result[i];t?e.resolveWith(this,[t]):this._giphy(i).done(o.proxy(function(t){this._result[i]=t.data,e.resolveWith(this,[t.data])},this))},this))},_giphy:function(t){var e="https://api.giphy.com/v1/gifs/trending",i={api_key:this.apiKey,limit:this.displayLimit};return this.rating&&(i.rating=this.rating),t&&(e="https://api.giphy.com/v1/gifs/search",i=_.extend(i,{q:t,offset:0})),o.get(e,i)}}),h={getInstance:function(){return this._instance||(this._instance=new r),this._instance}},"object"==typeof e&&e.exports?e.exports=h:s[n]=h},{}],3:[function(i,t,e){!function(e){!function(){var s=(t="undefined"!=typeof window?window.jQuery:void 0!==e?e.jQuery:null)&&t.__esModule?t:{default:t},t="undefined"!=typeof window?window.peepso:void 0!==e?e.peepso:null;i("./comment"),i("./message"),i("./postbox"),i("./postbox-new"),i("./messagebox"),t.observer.addFilter("human_friendly_extras",function(t,e,i){return e||!i||i.querySelector(".ps-js-post-header")||(e=(0,s.default)(i).find(".ps-comment-media .ps-js-giphy [data-preview]")).length&&t.push(e.data("preview")),t},20,3)}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./comment":1,"./message":4,"./messagebox":5,"./postbox":7,"./postbox-new":6}],4:[function(t,e,i){var s,h,r,o,n;s=window,n=o="PsGiphyMessage",h=s.jQuery,r=t("./giphy.js"),n=peepso.createClass(n,{__constructor:function(){h(h.proxy(this.onDocumentLoaded,this))},onDocumentLoaded:function(){h(document).on("click",".ps-js-chat-window .ps-js-giphy-trigger",h.proxy(this.onToggle,this))},onToggle:function(t){var e=h(t.currentTarget).siblings(".ps-js-giphy-container"),i="ps-giphy-initialized",s="ps-giphy-loading";function o(t){t.show(),t[0].focus(),t.css({backgroundColor:peepso.getLinkColor()}),t.css({transition:"background-color 3s ease"}),setTimeout(()=>{t.css({backgroundColor:""})},500)}t.preventDefault(),t.stopPropagation(),e.is(":visible")?e.hide():(e.show(),e.data(i)||e.data(s)?o(e.find(".ps-js-giphy-query")):(e.data(s,!0),e.on("input",".ps-js-giphy-query",h.proxy(this.onSearch,this)),e.on("click",".ps-js-giphy-list img",h.proxy(this.onSelectImage,this)),e.on("click",".ps-js-giphy-nav-left",t=>this.onScroll(t,"left")),e.on("click",".ps-js-giphy-nav-right",t=>this.onScroll(t,"right")),this.search(e).done(h.proxy(function(){e.data(i,!0),e.removeData(s),o(e.find(".ps-js-giphy-query"))},this))))},search:function(o,n){return h.Deferred(h.proxy(function(e){var t=r.getInstance(),i=o.find(".ps-js-giphy-loading").show(),s=o.find(".ps-js-giphy-list").hide();t.search(n).done(h.proxy(function(t){this.render(o,t),i.hide(),s.show(),e.resolveWith(this)},this))},this))},render:function(t,e){var i=t.find(".ps-js-giphy-list"),t=t.find(".ps-js-giphy-list-item"),n=peepso.template(t.html()),r=peepsogiphydata.giphy_rendition_messages||"fixed_width",t=_.map(e,function(t,e){var i=t.images,s=i[r],o="";return s&&(i=i.preview_gif||i.downsized_still||i.fixed_width_still||i.original_still)&&(h.extend(t,{src:s.url,preview:i.url}),o=n(t)),o});i.html(t.join(""))},onSearch:function(t){var t=h(t.currentTarget),e=t.closest(".ps-js-giphy-container"),i=e.find(".ps-js-giphy-list"),s=e.find(".ps-js-giphy-loading");i.hide().css({marginLeft:"",marginRight:""}),s.show(),this._onSearch(e,t)},_onSearch:_.debounce(function(t,e){this.search(t,h.trim(e.val()))},1e3),onSelectImage:function(t){var t=h(t.currentTarget),e=t.closest(".ps-js-giphy-container"),i=e.closest(".ps-js-chat-window").data("id"),t=t.attr("data-url");e.hide(),this.post(i,t)},onScroll:function(t,e){var i=peepso.rtl,t=h(t.currentTarget).closest(".ps-js-slider"),s=t.find(".ps-js-giphy-list"),t=t.width(),o=parseInt(s.css(i?"marginRight":"marginLeft"))||0;e===(i?"right":"left")?o=Math.min(o+t,0):e===(i?"left":"right")&&(e=s.children(".ps-js-giphy-item").last(),e=i?Math.abs(e.position().left):e.position().left+e.width()-t,o-=Math.min(t,e)),s.css(i?"marginRight":"marginLeft",o)},post:function(t,e){peepso.observer.doAction("msgso_send_message",t,"",{type:"giphy",giphy:e})}}),"object"==typeof e&&e.exports?e.exports=n:s[o]=n,new n,peepso.observer.addFilter("giphy_rendition_posts",function(t,e){return t="messagesajax.add_message"===e.opts.save_url?window.peepsogiphydata.giphy_rendition_messages||"fixed_width":t},10,2)},{"./giphy.js":2}],5:[function(i,t,e){!function(e){!function(){t("undefined"!=typeof window?window._:void 0!==e?e._:null);var r=t(i("./giphy"));function t(t){return t&&t.__esModule?t:{default:t}}peepso.hooks.addAction("messagebox_init","giphy",t=>{var e,i="MessageboxTypeGiphy";e=i,peepso.class(e)||peepso.class(e,function(t,o,i){let s=o.template;let n=(window.peepsogiphydata||{}).giphy_rendition_messages||"fixed_width";return class extends o.class("MessageboxType"){constructor(t,e="giphy"){super(t,e),this.giphy=null,this.selectedImage=null,this.$typeInput=this.$typeInputs.children(`[data-id=${this.type}]`),this.$preview=this.$typeInput.find("[data-ps=preview]").hide(),this.$selector=this.$typeInput.find("[data-ps=container]").show(),this.$loading=this.$selector.find("[data-ps=loading]"),this.$query=this.$selector.find("[data-ps=query]"),this.$result=this.$selector.find("[data-ps=list]"),this.$slider=this.$selector.find("[data-ps=slider]"),this.itemTemplate=s(this.$typeInput.find("[data-tmpl=item]").html()),this.$query.on("input",t=>this.onInputQuery(t)),this.$result.on("click","[data-ps=item]",t=>this.onClickItem(t)),this.$preview.on("click","[data-ps=btn-change]",t=>this.onClickBtnChange(t)),this.$slider.on("click","[data-ps=nav-left]",t=>this.onClickSlider(t,"left")),this.$slider.on("click","[data-ps=nav-right]",t=>this.onClickSlider(t,"right"))}show(){function t(t){t.show(),t[0].focus(),t.css({backgroundColor:o.getLinkColor()}),t.css({transition:"background-color 3s ease"}),setTimeout(()=>{t.css({backgroundColor:""})},500)}super.show(),this.giphy?t(this.$query):(this.giphy=r.default.getInstance(),this.search().done(()=>t(this.$query)))}search(t=""){return this.$result.hide(),this.$loading.show(),i.Deferred(e=>{clearTimeout(this.searchDelay);let i=this.searchDelay=setTimeout(()=>{this.giphy.search(t).done(t=>{this.searchDelay===i&&(this.render(t),this.$loading.hide(),this.$result.show(),this.$query.show()),e.resolveWith(this)})},1e3)})}render(t){t=t.map(t=>{var e=t.images,i=e[n],s="";return i&&(e=e.preview_gif||e.downsized_still||e.fixed_width_still||e.original_still)&&(Object.assign(t,{src:i.url,preview:e.url}),s=this.itemTemplate(t)),s});this.$result.html(t.join(""))}onFilterData(t,e){return e===this.messagebox&&this.active&&(t.type="giphy",t.giphy=this.selectedImage||void 0),t}onFilterValidate(t,e,i){return t=e===this.messagebox&&this.active?!!i.giphy:t}onFilterIsEmpty(t,e,i){return t=e===this.messagebox&&this.active&&i.giphy?!1:t}onActionReset(t){t===this.messagebox&&(this.hide(),this.selectedImage=null,this.$preview.hide(),this.$selector.show())}onInputQuery(t){t=t.target.value;this.$result.hide(),this.$loading.show(),this.search(t.trim())}onClickItem(t){var t=i(t.currentTarget).find("img"),e=t.attr("src"),t=t.attr("data-url");this.selectedImage=t,this.$selector.hide(),this.$preview.find("img").attr("src",e),this.$preview.show(),this.messagebox.$textarea.trigger("input")}onClickBtnChange(t){this.selectedImage=null,this.$preview.hide(),this.$selector.show(),this.messagebox.$textarea.trigger("input")}onClickSlider(t,e){t.preventDefault(),t.stopPropagation();var t=o.rtl,i=this.$slider.width();let s=parseInt(this.$result.css(t?"marginRight":"marginLeft"))||0;e===(t?"right":"left")?s=Math.min(s+i,0):e===(t?"left":"right")&&(e=this.$result.children("[data-ps=item]").last(),e=t?Math.abs(e.position().left):e.position().left+e.width()-i,s-=Math.min(i,e)),this.$result.css(t?"marginRight":"marginLeft",s)}}}),new(peepso.class(i))(t)})}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./giphy":2}],6:[function(i,t,e){!function(e){!function(){t("undefined"!=typeof window?window._:void 0!==e?e._:null);var r=t(i("./giphy"));function t(t){return t&&t.__esModule?t:{default:t}}peepso.class("PostboxTypeGiphy",function(e,o,i){let{hooks:t,template:s}=o;let n=(window.peepsogiphydata||{}).giphy_rendition_posts||"fixed_width";return t.addAction("postbox_init","giphy",t=>new(o.class(e))(t)),class extends o.class("PostboxType"){constructor(t,e="giphy"){super(t,e),this.giphy=null,this.selectedImage=null,this.$typeInput=this.$typeInputs.children(`[data-id=${this.type}]`),this.$preview=this.$typeInput.find("[data-ps=preview]").hide(),this.$selector=this.$typeInput.find("[data-ps=container]").show(),this.$loading=this.$selector.find("[data-ps=loading]"),this.$query=this.$selector.find("[data-ps=query]"),this.$result=this.$selector.find("[data-ps=list]"),this.$slider=this.$selector.find("[data-ps=slider]"),this.itemTemplate=s(this.$typeInput.find("[data-tmpl=item]").html()),this.$query.on("input",t=>this.onInputQuery(t)),this.$result.on("click","[data-ps=item]",t=>this.onClickItem(t)),this.$preview.on("click","[data-ps=btn-change]",t=>this.onClickBtnChange(t)),this.$slider.on("click","[data-ps=nav-left]",t=>this.onClickSlider(t,"left")),this.$slider.on("click","[data-ps=nav-right]",t=>this.onClickSlider(t,"right"))}show(){function t(t){t.show(),t[0].focus(),t.css({backgroundColor:o.getLinkColor()}),t.css({transition:"background-color 3s ease"}),setTimeout(()=>{t.css({backgroundColor:""})},500)}super.show(),this.giphy?t(this.$query):(this.giphy=r.default.getInstance(),this.search().done(()=>t(this.$query)))}search(t=""){return this.$result.hide(),this.$loading.show(),i.Deferred(e=>{clearTimeout(this.searchDelay);let i=this.searchDelay=setTimeout(()=>{this.giphy.search(t).done(t=>{this.searchDelay===i&&(this.render(t),this.$loading.hide(),this.$result.show(),this.$query.show()),e.resolveWith(this)})},1e3)})}render(t){t=t.map(t=>{var e=t.images,i=e[n],s="";return i&&(e=e.preview_gif||e.downsized_still||e.fixed_width_still||e.original_still)&&(Object.assign(t,{src:i.url,preview:e.url}),s=this.itemTemplate(t)),s});this.$result.html(t.join(""))}onFilterData(t,e){return e===this.postbox&&this.active&&(t.type="giphy",t.giphy=this.selectedImage||void 0),t}onFilterValidate(t,e,i){return t=e===this.postbox&&this.active?!!i.giphy:t}onFilterIsEmpty(t,e,i){return t=e===this.postbox&&this.active&&i.giphy?!1:t}onActionReset(t){t===this.postbox&&(this.hide(),this.selectedImage=null,this.$preview.hide(),this.$selector.show())}onInputQuery(t){t=t.target.value;this.$result.hide(),this.$loading.show(),this.search(t.trim())}onClickItem(t){var t=i(t.currentTarget).find("img"),e=t.attr("src"),t=t.attr("data-url");this.selectedImage=t,this.$selector.hide(),this.$preview.find("img").attr("src",e),this.$preview.show(),this.postbox.$textarea.trigger("input")}onClickBtnChange(t){this.selectedImage=null,this.$preview.hide(),this.$selector.show(),this.postbox.$textarea.trigger("input")}onClickSlider(t,e){t.preventDefault(),t.stopPropagation();var t=o.rtl,i=this.$slider.width();let s=parseInt(this.$result.css(t?"marginRight":"marginLeft"))||0;e===(t?"right":"left")?s=Math.min(s+i,0):e===(t?"left":"right")&&(e=this.$result.children("[data-ps=item]").last(),e=t?Math.abs(e.position().left):e.position().left+e.width()-i,s-=Math.min(i,e)),this.$result.css(t?"marginRight":"marginLeft",s)}}})}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./giphy":2}],7:[function(h,t,e){!function(o){!function(){var n=t("undefined"!=typeof window?window.jQuery:void 0!==o?o.jQuery:null),e=t("undefined"!=typeof window?window._:void 0!==o?o._:null),a=((t,e)=>{if(!e&&t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};if((e=r(e))&&e.has(t))return e.get(t);var i,s,o={__proto__:null},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(i in t)"default"!==i&&{}.hasOwnProperty.call(t,i)&&((s=n?Object.getOwnPropertyDescriptor(t,i):null)&&(s.get||s.set)?Object.defineProperty(o,i,s):o[i]=t[i]);return o.default=t,e&&e.set(t,o),o})("undefined"!=typeof window?window.peepso:void 0!==o?o.peepso:null),i=t(h("./giphy"));function r(t){var e,i;return"function"!=typeof WeakMap?null:(e=new WeakMap,i=new WeakMap,(r=function(t){return t?i:e})(t))}function t(t){return t&&t.__esModule?t:{default:t}}class s{constructor(t){this.$postbox=t,this.$postboxTab=this.$postbox.$posttabs,this.$postboxStatusTextarea=this.$postbox.$textarea,this.$postboxStatus=this.$postboxStatusTextarea.closest(".ps-postbox-status"),this.$postboxGiphy=this.$postbox.find(".ps-postbox-tabs [data-tab-id=giphy]"),this.$preview=this.$postboxGiphy.find(".ps-js-giphy-preview").hide(),this.$selector=this.$postboxGiphy.find(".ps-js-giphy-container").show(),this.$loading=this.$selector.find(".ps-js-giphy-loading"),this.$query=this.$selector.find(".ps-js-giphy-query"),this.$result=this.$selector.find(".ps-js-giphy-list"),this.$slider=this.$result.parent(),this.onScroll=e.default.throttle(this.onScroll,500),this.$preview.on("click",".ps-js-giphy-change",t=>this.onChangeImage(t)),this.$query.on("input",t=>this.onInput(t)),this.$result.on("click","img",t=>this.onSelect(t.target)),this.$slider.find(".ps-js-giphy-nav-left").on("click",()=>this.onScroll("left")),this.$slider.find(".ps-js-giphy-nav-right").on("click",()=>this.onScroll("right")),this.giphy=null,this.itemTemplate=a.default.template(this.$slider.find(".ps-js-giphy-list-item").html()),this.$postboxTab.on("peepso_posttabs_show-giphy",n.default.proxy(this.show,this)),this.$postboxTab.on("peepso_posttabs_cancel-giphy",n.default.proxy(this.cancel,this)),this.$postboxTab.on("peepso_posttabs_submit-giphy",n.default.proxy(this.post,this)),a.observer.addAction("postbox_type_set",n.default.proxy(this.actionPostboxTypeSet,this),10,2),a.observer.addFilter("peepso_postbox_can_submit",n.default.proxy(this.filterCanSubmit,this),10,2)}show(){function t(t){t.show(),t[0].focus(),t.css({backgroundColor:a.default.getLinkColor()}),t.css({transition:"background-color 3s ease"}),setTimeout(()=>{t.css({backgroundColor:""})},500)}this.$postboxStatus.show(),this.$postboxGiphy.show(),this.giphy?t(this.$query):(this.giphy=i.default.getInstance(),this.search().done(()=>t(this.$query)))}cancel(){this.selectedImage=null,this.$postboxGiphy.hide(),this.$preview.hide(),this.$selector.show(),this.$postbox.on_change()}post(){var t="postbox_req_"+this.$postbox.guid;a.observer.addFilter(t,this.filterPostboxReq,10,1,this),this.$postbox.save_post(),a.observer.removeFilter(t,this.filterPostboxReq,10)}value(){let t;return t=this.selectedImage?this.selectedImage:t}search(t=""){return this.$result.hide(),this.$loading.show(),n.default.Deferred(e=>{clearTimeout(this.searchDelay);let i=this.searchDelay=setTimeout(()=>{this.giphy.search(t).done(t=>{this.searchDelay===i&&(this.render(t),this.$loading.hide(),this.$result.show(),this.$query.show()),e.resolveWith(this)})},1e3)})}render(t){let o=a.observer.applyFilters("giphy_rendition_posts",peepsogiphydata.giphy_rendition_posts||"fixed_width",this.$postbox);t=t.map(t=>{var e=t.images,i=e[o],s="";return i&&(e=e.preview_gif||e.downsized_still||e.fixed_width_still||e.original_still)&&(n.default.extend(t,{src:i.url,preview:e.url}),s=this.itemTemplate(t)),s});this.$result.html(t.join(""))}select(t,e){this.selectedImage=e,this.$selector.hide(),this.$preview.find("img").attr("src",t),this.$preview.show(),this.$postbox.on_change()}scroll(t){let e=a.default.rtl,i=this.$selector.find(".ps-js-slider"),s=i.find(".ps-js-giphy-list"),o=i.width(),n=parseInt(s.css(e?"marginRight":"marginLeft"))||0,r,h;t===(e?"right":"left")?n=Math.min(n+o,0):t===(e?"left":"right")&&(h=s.children(".ps-js-giphy-item").last(),r=e?Math.abs(h.position().left):h.position().left+h.width()-o,n-=Math.min(o,r)),s.css(e?"marginRight":"marginLeft",n)}onChangeImage(t){t.preventDefault(),t.stopPropagation(),this.selectedImage=null,this.$postbox.on_change(),this.$preview.hide(),this.$selector.show()}onInput(t){t=t.target.value;this.$result.hide(),this.$loading.show(),this.search(t.trim())}onScroll(t){this.scroll(t)}onSelect(t){this.select(t.src,t.getAttribute("data-url"))}filterPostboxReq(t){var e=this.value();return e&&(t.type="giphy",t.giphy=e),t}filterCanSubmit(t,e){return this.$postbox===e&&"giphy"===this.$postboxTab.current_tab_id&&t.hard.push(!!this.value()),t}actionPostboxTypeSet(t,e){t===this.$postbox&&"giphy"===e&&"giphy"!==this.$postboxTab.current_tab_id&&this.$postbox.find("[data-tab=giphy]").trigger("click")}}a.observer.addAction("peepso_postbox_addons",t=>(t.push({init(){},set_postbox(t){t.find("[data-tab-id=giphy]").length&&new s(t)}}),t),10,1)}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./giphy":2}]},{},[3]);