(e=>{var c,n;function t(){t.super_.apply(this,arguments),c(c.proxy(this.init_page,this))}c=e,n=+peepsodata.members_hide_before_search,peepso.npm.inherits(t,PsPageAutoload),peepso.npm.objectAssign(t.prototype,{onDocumentLoaded:function(){this._search_$ct=c(this._css_prefix).eq(0),this._search_$trigger=c(this._css_prefix+"-triggerscroll"),this._search_$loading=c(this._css_prefix+"-loading"),this._search_$noquery=c(this._css_prefix+"-noquery"),this._search_$nomore=c(peepsodata.activity.template_no_more).hide().insertBefore(this._search_$trigger),this._search_$filters=c(this._css_prefix+"-filters"),this._search_$filters_toggle=c(this._css_prefix+"-filters-toggle")},init_page:function(){this._search_$query=c(".ps-js-members-query").on("input",c.proxy(this._filter,this)),this._search_$gender=c(".ps-js-members-gender").on("change",c.proxy(this._filter,this)),this._search_$sortby=c(".ps-js-members-sortby").on("change",c.proxy(this._filter,this)),this._search_$reported=c(".ps-js-members-reported").on("change",c.proxy(this._filter,this)),this._search_$avatar=c(".ps-js-members-avatar").on("click",c.proxy(this._filter,this)),this._search_$following=c(".ps-js-members-following").on("change",c.proxy(this._filter,this)),this._search_$extended=c(".ps-js-filter-extended").find("input[type=text], input[type=radio], select"),this._search_$extended.prop("oninput",""),this._search_$extended.filter("select").addClass("ps-select").on("change",c.proxy(this._filter,this)),this._search_$extended.filter("input[type=radio]").on("click",c.proxy(function(e){e=c(e.target);e.data("ps-checked")?(e.removeData("ps-checked"),e[0].checked=!1):e.data("ps-checked",1),this._filter()},this)),this._search_$extended.filter("input[type=text]").on("focus",e=>{e=c(e.target);e.data("value",e.val())}).on("blur",e=>{e=c(e.target);void 0!==e.data("value")&&e.data("value")!==e.val()&&(e.removeData("value"),this._filter())}).on("keyup",e=>{"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),c(e.target).removeData("value"),this._filter())}),this._search_$dropdown=this._search_$filters.find(".ps-js-dropdown[data-name]"),this._search_$dropdown.find(".ps-js-dropdown-menu [data-option-value]").on("click",e=>{e.preventDefault();var e=c(e.currentTarget),t=e.closest(".ps-js-dropdown").children(".ps-js-dropdown-toggle").children("[data-value]");t.attr("data-value")!==e.attr("data-option-value")&&(t.attr("data-value",e.attr("data-option-value")),t.html(e.html()),this._filter())}),this._search_$filters_toggle.on("click",e=>{e.preventDefault(),this._search_$filters.stop().slideToggle("fast")}),"#reports"===location.hash?(this._search_$reported.val("1"),this._search_$filters.stop().slideDown("fast",()=>this._filter())):this._filter()},_search_url:"membersearch.search",_search_params:{uid:peepsodata.currentuserid,user_id:peepsodata.userid,query:void 0,order_by:void 0,order:void 0,peepso_reported:void 0,peepso_gender:void 0,peepso_avatar:void 0,peepso_following:void 0,limit:2,page:1},_search_render_html:function(e){return e.members&&e.members.length?e.members.join(""):""},_search_get_items:function(){return this._search_$ct.children(".ps-js-member")},_search_should_load_more:function(){var e=+peepsodata.activity_limit_below_fold,t=this._search_get_items();return this._search_loadmore_enable&&this._search_loadmore_repeat?!(t.length>=this._search_loadmore_repeat*this._search_params.page):(e=0<e?e:3,this._search_params.limit&&(e*=this._search_params.limit),!!((t=t.slice(0-e).eq(0)).length&&(this._search_loadmore_enable?t.eq(0).offset():t.get(0).getBoundingClientRect()).top<(window.innerHeight||document.documentElement.clientHeight)))},_fetch:function(r){return c.Deferred(c.proxy(function(t){var e=peepso.disableAuth().disableError(),s=this._search_url;r=c.extend({},r),this._search_loadmore_enable&&this._search_loadmore_repeat?r.limit=this._search_loadmore_repeat:_.isUndefined(r.limit)||(r.limit*=2),this._fetch_xhr&&this._fetch_xhr.abort(),this._fetch_xhr=e.getJson(s,r,e=>{e.success?t.resolveWith(this,[e.data]):t.rejectWith(this,[e.errors])})},this))},_filter:function(){var e=this._search_$query.val().trim(),t=this._search_$sortby.val().split("|"),s=this._search_$gender.val(),r=this._search_$reported.val(),a=this._search_$avatar[0].checked?1:0,i=this._search_$following[0].value,h={},o={};if(this._fetch_xhr&&this._fetch_xhr.abort(),n){if(!e)return clearTimeout(this._search_debounced_timer),this._search_toggle_autoscroll("off"),this._search_toggle_loading("hide"),this._search_$ct.empty(),this._search_$nomore.hide(),void this._search_$noquery.show();this._search_$noquery.hide()}this._search_params.query=e||void 0,this._search_params.order_by=t[0]||void 0,this._search_params.order=t[1]||void 0,this._search_params.peepso_gender=s||void 0,this._search_params.peepso_reported=r||void 0,this._search_params.peepso_avatar=a||void 0,this._search_params.peepso_following=i||void 0,this._search_params.page=1,"peepso_last_activity"===this._search_params.order_by?this._search_params.limit=25:this._search_params.limit=2,this._search_$extended.each(function(){var e=c(this);"SELECT"===e[0].tagName?h[this.name]=this.value:"radio"===e.attr("type")?(void 0===h[this.name]&&(h[this.name]=void 0),e[0].checked&&(h[this.name]=this.value)):"text"===e.attr("type")&&(h[this.name]=this.value)}),_.extend(this._search_params,h),this._search_$dropdown.each(function(){var e=c(this),t=e.find(".ps-js-dropdown-toggle [data-value]").attr("data-value");o[e.attr("data-name")]=t||void 0}),_.extend(this._search_params,o),this._search()}}),new t(".ps-js-members")})(jQuery);