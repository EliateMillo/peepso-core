!function i(s,d,a){function n(t,e){if(!d[t]){if(!s[t]){var o="function"==typeof require&&require;if(!e&&o)return o(t,!0);if(r)return r(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}o=d[t]={exports:{}},s[t][0].call(o.exports,function(e){return n(s[t][1][e]||e)},o,o.exports,i,s,d,a)}return d[t].exports}for(var r="function"==typeof require&&require,e=0;e<a.length;e++)n(a[e]);return n}({1:[function(h,e,t){!function(d){!function(){var r=e("undefined"!=typeof window?window.jQuery:void 0!==d?d.jQuery:null),o=e("undefined"!=typeof window?window._:void 0!==d?d._:null),n="undefined"!=typeof window?window.peepso:void 0!==d?d.peepso:null;function e(e){return e&&e.__esModule?e:{default:e}}let l="probably"===(0,h("./video").supportsType)("webm"),i=window.peepsovideosdata&&+peepsovideosdata.autoplay;(0,r.default)(document).on("ps_activitystream_loaded ps_activitystream_append",o.default.throttle(()=>{(0,r.default)(".ps-js-activity").not("[data-video-init]").each(function(){var e=(0,r.default)(this).attr("data-video-init","").find(".ps-js-video");e.length&&(i=>{let s=i.find(".ps-video-thumbnail"),e=s.find(".ps-js-media-play"),t=s.find("img"),o=t.attr("src"),d=t.data("animated"),a=t.data("animated-webm"),n;s.on("mouseenter",()=>{a&&l?n?(t.hide(),n.show(),n.get(0).play()):(n=(0,r.default)(`<video src="${a}" />`).css({maxWidth:"100%"})).get(0).addEventListener("loadeddata",()=>{t.hide(),n.insertAfter(t),n.show(),n.get(0).play()}):d&&t.parent().css("background-image",`url('${d}')`)}).on("mouseleave",()=>{a&&l?n&&(n.hide(),n.get(0).pause(),t.show()):d&&t.parent().css("background-image",`url('${o}')`)}),e.on("click",()=>{let e=i.children("script");var t,o;e.length?(e=(0,r.default)(e.text()),o=+(t=i.find(".ps-video-thumbnail").find("img")).prop("naturalWidth"),t=+t.prop("naturalHeight"),o&&t&&e.find("video").css("aspect-ratio",o+"/"+t),i.html(e)):(o=i.find(".wp-video video")).length&&(s.remove(),o[0].controls=!0,o[0].play())})})(e)})},3e3));var t=navigator.userAgent,t=-1<t.indexOf("Safari")&&-1===t.indexOf("Chrome");(n.browser.isIOS()||t)&&n.observer.addFilter("peepso_activity",function(e){return e.each(function(){var e,t=(0,r.default)(this).find("audio.wp-audio-shortcode");t.length&&(e=t.find("source")).length&&(t.attr("src",e.attr("src")),e.remove())})},10,1),n.observer.addFilter("peepso_activity",e=>e.map(function(){if(i&&1===this.nodeType){var e=this.querySelector(".ps-js-activity-attachments");if(e){let t=e.querySelector('iframe[src*="youtube.com/embed"]');if(t){let e=t.getAttribute("src");var o=e.match(/\/embed\/([^?#\/]+)/)[1];-1===e.indexOf("enablejsapi")&&(e+=`${-1===e.indexOf("?")?"?":"&"}enablejsapi=1&origin=${location.protocol}//`+location.hostname,t.setAttribute("src",e),t.setAttribute("id","ps-js-yt-"+o))}if(t=e.querySelector('iframe[src*="dailymotion.com/embed"]')){let e=t.getAttribute("src");o=e.match(/\/embed\/video\/([^?#\/]+)/)[1];o&&(e+=`${-1===e.indexOf("?")?"?":"&"}api=postMessage`,t.setAttribute("src",e),t.setAttribute("id","ps-js-dailymotion-"+o))}}}return this}),10,1);let s;function p(){return new Promise((o,i)=>{if(s)if("progress"===s){let e=0,t=setInterval(function(){("progress"!==s||30<=++e)&&(clearInterval(t),"undefined"!=typeof YT?o(YT):i())},1e3)}else"undefined"!=typeof YT?o(YT):i();else{s="progress",window.onYouTubeIframeAPIReady_old=window.onYouTubeIframeAPIReady,window.onYouTubeIframeAPIReady=function(){window.onYouTubeIframeAPIReady=window.onYouTubeIframeAPIReady_old,delete window.onYouTubeIframeAPIReady_old,s=!0,o(YT)};var e=document.createElement("script"),t=(e.src="https://www.youtube.com/iframe_api",document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)}})}let a;function u(){return new Promise((o,i)=>{if(a)if("progress"===a){let e=0,t=setInterval(function(){("progress"!==a||30<=++e)&&(clearInterval(t),"undefined"!=typeof Vimeo?o(Vimeo):i())},1e3)}else"undefined"!=typeof Vimeo?o(Vimeo):i();else{a="progress";var s=document.createElement("script"),d=(s.src="https://player.vimeo.com/api/player.js",document.getElementsByTagName("script")[0]);d.parentNode.insertBefore(s,d);let e=0,t=setInterval(function(){("undefined"!=typeof Vimeo||30<=++e)&&(clearInterval(t),a=!0,"undefined"!=typeof Vimeo?o(Vimeo):i())},1e3)}})}(0,r.default)(function(){if(i){let e=document.getElementById("ps-activitystream");if(e){let s={},d={};var t=o.default.debounce(function(){var t,o=[...e.querySelectorAll(".ps-js-activity")].map(e=>{e=e.querySelector(".ps-js-activity-attachments");return e?e.querySelector(".ps-js-video .ps-media__video-thumb")||e.querySelector(".wp-video video")||e.querySelector('iframe[src*="youtube.com/embed"]')||e.querySelector('iframe[src*="player.vimeo.com"]')||e.querySelector('iframe[src*="dailymotion.com/embed"]'):null}).filter(e=>e);let i;for(let e=0;e<o.length;e++)!n.util.isElementInViewport(o[e])||(t=o[e].closest(".ps-js-activity-attachments"))&&t.classList.contains("ps-post__attachments--nsfw")||(i=o[e]);i?(a(o.filter(e=>e!==i)),[i].forEach(t=>{var e,o=t.tagName.toLowerCase(),i=t.closest(".ps-media--iframe");"iframe"===o?-1<t.src.indexOf("youtube.com/embed")?p().then(e=>{s[t.id]?s[t.id].playVideo():s[t.id]=new e.Player(t.id,{events:{onReady:e=>e.target.playVideo()}})}):-1<t.src.indexOf("player.vimeo.com")?u().then(e=>{t.id||(t.id="ps-js-vimeo-"+t.src.match(/video\/(\d+)/)[1]),d[t.id]||(d[t.id]=new e.Player(t)),d[t.id].play()}):-1<t.src.indexOf("dailymotion.com/embed")&&t.contentWindow.postMessage("play","*"):"video"===o?(e=i.querySelector(".ps-js-media-play"))?(0,r.default)(e).trigger("click"):t.play():"div"===o&&(e=i.querySelector(".ps-js-media-play"))&&(0,r.default)(e).trigger("click")})):a(o.filter(e=>!n.util.isElementPartlyInViewport(e)))},300);function a(e){e.forEach(t=>{var e=t.tagName.toLowerCase();"iframe"===e?-1<t.src.indexOf("youtube.com/embed")?p().then(e=>{s[t.id]?s[t.id].pauseVideo():s[t.id]=new e.Player(t.id,{events:{onReady:e=>e.target.pauseVideo()}})}):-1<t.src.indexOf("player.vimeo.com")?u().then(e=>{t.id||(t.id="ps-js-vimeo-"+t.src.match(/video\/(\d+)/)[1]),d[t.id]||(d[t.id]=new e.Player(t)),d[t.id].pause()}):-1<t.src.indexOf("dailymotion.com/embed")&&t.contentWindow.postMessage("pause","*"):"video"===e&&t.pause()})}document.addEventListener("scroll",t),n.hooks.addAction("nsfw_reveal","video_autoplay",t)}}})}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./video":21}],2:[function(e,t,o){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;e=(e=e("eventemitter3"))&&e.__esModule?e:{default:e};class i extends e.default{constructor(e){super(),this.source=e,this.data=null}fetch(){throw new Error("Must be implemented by subclass!")}fetchAbort(){throw new Error("Must be implemented by subclass!")}getHTML(){return new Promise((t,o)=>{this.fetch().then(e=>{t(e.html)}).catch(e=>{o(e)})})}getData(){return new Promise((t,o)=>{this.fetch().then(e=>{t(e)}).catch(e=>{o(e)})})}}o.default=i},{eventemitter3:23}],3:[function(d,e,a){!function(s){!function(){Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var i=t("undefined"!=typeof window?window.peepso:void 0!==s?s.peepso:null),e=t(d("./abstract"));function t(e){return e&&e.__esModule?e:{default:e}}class o extends e.default{fetch(){return new Promise((t,o)=>{var e;this.data?t(this.data):(e={url:this.source,accepted_type:"audio"},this.xhr=i.default.postJson("videosajax.get_preview",e,e=>{e.success?(this.data=e.data,t(this.data)):o(e&&e.errors&&e.errors[0])}).ret)})}fetchAbort(){this.xhr&&(this.xhr.abort(),this.xhr=void 0)}}a.default=o}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./abstract":2}],4:[function(e,t,o){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;e=(e=e("./embed"))&&e.__esModule?e:{default:e};class i extends e.default{}o.default=i},{"./embed":3}],5:[function(e,t,o){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var i=d(e("./abstract")),s=d(e("../uploader"));function d(e){return e&&e.__esModule?e:{default:e}}class a extends i.default{fetch(){return new Promise((t,o)=>{this.data?t(this.data):this.validate().then(()=>{this.upload().then(e=>{this.data=_.extend({},e,{html:`<iframe src="${e.link}embed" />`}),t(this.data)}).catch(e=>{o(e)})}).catch(e=>{o(e)})})}validate(){return new Promise((t,o)=>{var e=this.source.files[0],e={type:e.type,size:parseInt(e.size),is_audio:1};peepso.postJson("videosajax.validate_video_upload",e,e=>{e&&e.success?t():o(e&&e.errors&&e.errors[0])})})}upload(){return new Promise((t,o)=>{var e=new s.default(this.source,{data:{is_audio:1}});e.on("progress",e=>{this.emit("progress",e)}),e.upload().then(e=>{t(e)}).catch(e=>{o(e)})})}}o.default=a},{"../uploader":16,"./abstract":2}],6:[function(e,t,o){Object.defineProperty(o,"__esModule",{value:!0}),o.supportsType=o.default=void 0;var i=a(e("eventemitter3")),s=a(e("./file")),d=a(e("./embed"));a(e("./facebook"));function a(e){return e&&e.__esModule?e:{default:e}}class n extends i.default{constructor(e){super(),this.source=e,this.object=null,"object"==typeof e&&e.files?(this.object=new s.default(e),this.object.on("progress",e=>{this.emit("progress",e)})):"string"==typeof e&&""!==e&&(this.object=new d.default(e))}fetchAbort(){return this.object.fetchAbort()}getHTML(){return this.object.getHTML()}getData(){return this.object.getData()}}o.default=n;let r;o.supportsType=e=>(r=r||document.createElement("video"))&&"function"==typeof r.canPlayType?r.canPlayType({ogg:'video/ogg; codecs="theora"',h264:'video/mp4; codecs="avc1.42E01E"',webm:'video/webm; codecs="vp8, vorbis"',vp9:'video/webm; codecs="vp9"',hls:'application/x-mpegURL; codecs="avc1.42E01E"'}[e]||e):""},{"./embed":3,"./facebook":4,"./file":5,eventemitter3:23}],7:[function(e,t,p){!function(l){!function(){Object.defineProperty(p,"__esModule",{value:!0}),p.default=void 0;var e,a=(e="undefined"!=typeof window?window.jQuery:void 0!==l?l.jQuery:null)&&e.__esModule?e:{default:e},o=t("undefined"!=typeof window?window.peepso:void 0!==l?l.peepso:null),s=t("undefined"!=typeof window?window.peepsodata:void 0!==l?l.peepsodata:null);function n(e){var t,o;return"function"!=typeof WeakMap?null:(t=new WeakMap,o=new WeakMap,(n=function(e){return e?o:t})(e))}function t(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};t=n(t);if(t&&t.has(e))return t.get(e);var o,i,s={__proto__:null},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(o in e)"default"!==o&&{}.hasOwnProperty.call(e,o)&&((i=d?Object.getOwnPropertyDescriptor(e,o):null)&&(i.get||i.set)?Object.defineProperty(s,o,i):s[o]=e[o]);return s.default=e,t&&t.set(e,s),s}function i(e,t,o){(t=(e=>"symbol"==typeof(e=((e,t)=>{if("object"!=typeof e||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);if("object"!=typeof(o=o.call(e,t||"default")))return o;throw new TypeError("@@toPrimitive must return a primitive value.")})(e,"string"))?e:e+"")(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o}class r{static create(){let e=r.$outer,t=r.$inner;return e||((t=r.$inner=(0,a.default)("<div />").append(s.media.templateCard)).css({position:"absolute"}),(e=r.$outer=(0,a.default)("<div />").css({display:"none",height:1,overflow:"visible",position:"absolute",width:1,zIndex:100001})).on("mouseenter",function(e){e.stopPropagation(),r.show()}),e.on("mouseleave",function(e){e.stopPropagation(),r.hide()}),e.append(t).appendTo(document.body)),e}static show(e,t){clearTimeout(r.hideTimer);var o,i,s=r.create(),d=r.$inner;"loading"===e?s.find(".ps-js-loading").show():e&&(s.find(".ps-js-loading").hide(),s.find(".ps-js-cover").css({backgroundImage:`url(${encodeURI(e.cover)})`}),e.artist?s.find(".ps-js-artist").html(e.artist).show():s.find(".ps-js-artist").hide(),e.album?s.find(".ps-js-album").html(e.album).show():s.find(".ps-js-album").hide()),s.show(),t&&t.currentTarget&&t.clientX&&(o=(e=(0,a.default)(t.currentTarget)).offset(),i=window.innerWidth<=480,d.css({top:"",left:0,bottom:0,right:i?0:""}),s.css({top:o.top-s.height(),left:i?0:t.clientX,right:i?0:"",width:i?"":1}),(t=d.get(0).getBoundingClientRect()).top<0&&(s.css({top:o.top+e.height()}),d.css({bottom:"",top:0})),i||t.right>(window.innerWidth||document.documentElement.clientWidth)&&d.css({left:"",right:0}))}static hide(){let e=r.$outer;e&&(r.hideTimer=setTimeout(function(){e.hide()},200))}}i(r,"$outer",void 0),i(r,"$inner",void 0),i(r,"hideTimer",void 0);class d{constructor(e,t){i(this,"$elem",void 0),i(this,"opts",void 0),i(this,"showTimer",void 0),this.$elem=(0,a.default)(e),this.opts=t,this.$elem.on("mouseenter",e=>{e.stopPropagation(),this.show(e)}),this.$elem.on("mouseleave",e=>{e.stopPropagation(),this.hide()}),o.default.isTouch()&&this.$elem.on("click",e=>{e.preventDefault(),e.stopPropagation()})}getData(){return new o.Promise(t=>{let o=this.opts.artist+":"+this.opts.album,i=d.cache[o];i?t(i):a.default.post(s.default.ajaxurl,{action:"peepso_audio_album_info",artist:this.opts.artist,album:this.opts.album},e=>{i=d.cache[o]=e,t(i)},"json")})}show(o){this.showTimer=setTimeout(()=>{let t=setTimeout(()=>{r.show("loading",o)},500);this.getData().then(e=>{clearTimeout(t),this.showTimer&&r.show(e,o)})},300)}hide(){clearTimeout(this.showTimer),this.showTimer=null,r.hide()}}i(d,"cache",{});p.default=d;(0,a.default)(function(){var e=o.default.isTouch()?"touchstart":"mouseenter";(0,a.default)(document).on(e,"[data-artist][data-album]",function(e){var t,o,i=(0,a.default)(e.currentTarget);i.data("ps-mediacard")||(o=i.data("artist"),t=i.data("album"),o&&t?(o=new d(i[0],{artist:o,album:t}),i.data("ps-mediacard",o),o.show(e)):i.data("ps-mediacard","do_not_trigger"))})})}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(d,e,t){!function(s){!function(){var e="undefined"!=typeof window?window.peepso:void 0!==s?s.peepso:null,t=(i(d("./videos")),i(d("./page-videos")),i(d("./postbox"))),o=i(d("./postbox-audio"));function i(e){return e&&e.__esModule?e:{default:e}}d("./activitystream"),d("./card"),e.observer.addFilter("peepso_postbox_addons",e=>(e.push({init(){},set_postbox(e){new t.default(e),new o.default(e)}}),e),10,1)}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./activitystream":1,"./card":7,"./page-videos":9,"./postbox":13,"./postbox-audio":10,"./videos":22}],9:[function(e,t,o){!function(o){!function(){var e,d=(e="undefined"!=typeof window?window.jQuery:void 0!==o?o.jQuery:null)&&e.__esModule?e:{default:e},a="undefined"!=typeof window?window.peepso:void 0!==o?o.peepso:null;function t(){t.super_.apply(this,arguments),(0,d.default)(d.default.proxy(this.init_page,this))}(0,d.default)(function(){let t=["small","large"],o=(0,d.default)(".ps-js-media-viewmode"),i=(0,d.default)(".ps-js-videos");function s(e){e=0<=t.indexOf(e)?e:t[0],o.removeClass("ps-btn--active"),o.filter(`[data-mode="${e}"]`).addClass("ps-btn--active"),i.removeClass(t.map(e=>"ps-media__page-list--"+e).join(" ")),i.addClass("ps-media__page-list--"+e),a.ls.set("media_viewmode",e)}o.length&&i.length&&(s(a.ls.get("media_viewmode")),o.on("click",function(e){e.preventDefault(),s((0,d.default)(this).data("mode"))}))}),peepso.npm.inherits(t,PsPageAutoload),peepso.npm.objectAssign(t.prototype,{init_page:function(){this._search_$sortby=(0,d.default)(".ps-js-videos-sortby").on("change",d.default.proxy(this._filter,this)),this._search_$sortby.length&&this._search_$sortby.trigger("change"),peepso.observer.addAction("peepso_delete_post",function(e){(0,d.default)(".ps-js-video").filter('[data-post-id="'+e+'"]').remove()},10,1)},_search_url:"videosajax.get_user_videos",_search_params:{uid:peepsodata.currentuserid,user_id:peepsodata.userid,sort:void 0,limit:3,page:1},_search_render_html:function(e){return e.videos||""},_search_get_items:function(){return this._search_$ct.children(".ps-js-video")},_fetch:function(e){return d.default.Deferred(d.default.proxy(function(t){e=peepso.observer.applyFilters("peepso_list_videos",e),e=d.default.extend({},e),_.isUndefined(e.limit)||(e.limit*=2),this._fetch_xhr&&this._fetch_xhr.abort(),this._fetch_xhr=peepso.getJson(this._search_url,e,d.default.proxy(function(e){e.success?t.resolveWith(this,[e.data]):t.rejectWith(this,[e.errors])},this))},this))},_filter:function(){var e=this._search_$sortby.val();this._fetch_xhr&&this._fetch_xhr.abort(),this._search_params.sort=e||void 0,this._search_params.page=1,this._search()}}),new t(".ps-js-videos")}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],10:[function(e,t,o){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var i=(i=e("./postbox"))&&i.__esModule?i:{default:i};e("./postbox-new");o.default=i.default},{"./postbox":12,"./postbox-new":11}],11:[function(o,e,t){!function(t){!function(){var d=e("undefined"!=typeof window?window._:void 0!==t?t._:null),a=((e,t)=>{if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};if((t=r(t))&&t.has(e))return t.get(e);var o,i,s={__proto__:null},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(o in e)"default"!==o&&{}.hasOwnProperty.call(e,o)&&((i=d?Object.getOwnPropertyDescriptor(e,o):null)&&(i.get||i.set)?Object.defineProperty(s,o,i):s[o]=e[o]);return s.default=e,t&&t.set(e,s),s})("undefined"!=typeof window?window.peepso:void 0!==t?t.peepso:null),n=e(o("../audio"));function r(e){var t,o;return"function"!=typeof WeakMap?null:(t=new WeakMap,o=new WeakMap,(r=function(e){return e?o:t})(e))}function e(e){return e&&e.__esModule?e:{default:e}}a.default.class("PostboxTypeAudio",function(t,o,e){var i=o.hooks;return i.addAction("postbox_init","audio",e=>new(o.class(t))(e)),class extends o.class("PostboxType"){constructor(e,t="audio"){super(e,t),this.config=window.peepsoaudiosdata||{},this.$embed=this.$typeInput.find(".ps-js-audio-embed"),this.$embedUrl=this.$embed.find(".ps-js-url"),this.$embedLoading=this.$embed.find(".ps-js-loading"),this.$embedUrl.on("input",d.default.debounce(e=>this.embed(e.target.value),2e3)),this.$embedUrl.on("paste",e=>d.default.defer(()=>this.embed(e.target.value))),this.$embedUrl.on("blur",e=>{this.$uploadBtn.off("click"),d.default.defer(()=>this.$uploadBtn.on("click",()=>this.onUploadClick())),this.embed(e.target.value)}),this.$upload=this.$typeInput.find(".ps-js-audio-upload"),this.$uploadBtn=this.$upload.find(".ps-js-btn"),this.$uploadForm=this.$upload.find(".ps-js-form"),this.$uploadTitle=this.$upload.find(".ps-js-title"),this.$uploadArtist=this.$upload.find(".ps-js-artist"),this.$uploadAlbum=this.$upload.find(".ps-js-album"),this.$uploadProgress=this.$upload.find(".ps-js-progress"),this.$uploadDone=this.$upload.find(".ps-js-done"),this.$uploadFailed=this.$upload.find(".ps-js-failed"),this.$uploadSuccess=this.$upload.find(".ps-js-success"),this.$uploadBtn.on("click",()=>this.onUploadClick()),this.$separator=this.$postbox.find(".ps-js-audio-separator"),this.$preview=this.$postbox.find(".ps-js-audio-preview"),this.mode=null,this.data=null,this.uploadInit()}onFilterData(e,t){return t===this.postbox&&this.active&&(e.type="audio","embed"===this.mode?e.url=this.data.url:"upload"===this.mode&&(e.audio=this.data.file,e.audio_title=this.$uploadTitle.val().trim(),e.audio_artist=this.$uploadArtist.val().trim(),e.audio_album=this.$uploadAlbum.val().trim())),e}onFilterValidate(e,t,o){return e=t===this.postbox&&this.active?"embed"===this.mode?!!o.url:"upload"===this.mode&&!!o.audio:e}onFilterIsEmpty(e,t,o){return e=t===this.postbox&&this.active&&("embed"===this.mode&&o.url||"upload"===this.mode&&o.audio)?!1:e}onActionReset(e){e===this.postbox&&(this.hide(),this.mode=null,this.data=null,this.$embedUrl.val(this._embedUrl=""),this.$preview.empty(),this.postbox.$textarea.trigger("click"))}show(){super.show(),this.mode=null,this.$embed.show(),this.$separator.show(),this.$upload.show(),this.$uploadBtn.show(),this.$uploadForm.hide(),this.$uploadSuccess.hide(),this.$preview.hide(),+this.config.upload_enable||(this.mode="embed")}showEmbed(){this.mode="embed",this.$embed.show(),this.$separator.hide(),this.$upload.hide(),this.$preview.show()}showUpload(){this.mode="upload",this.$embed.hide(),this.$separator.hide(),this.$upload.show(),this.$uploadTitle.val(""),this.$uploadBtn.hide(),this.$uploadForm.show(),this.$uploadProgress.show(),this.$uploadDone.hide(),this.$uploadFailed.hide(),this.$preview.show()}cancel(){this.mode=null,this.data=null,this.$embedUrl.val(this._embedUrl=""),this.$preview.empty(),this.$postbox.on_change()}post(){var e="postbox_req_"+this.$postbox.guid;a.observer.addFilter(e,this.postSetRequest,10,1,this),this.$postbox.save_post(),a.observer.removeFilter(e,this.postSetRequest,10)}postSetRequest(e){return"embed"===this.mode?d.default.extend(e,{type:"audio",url:this.data.url}):"upload"===this.mode&&d.default.extend(e,{type:"audio",audio:this.data.file,audio_title:this.$uploadTitle.val().trim()}),e}embed(e=""){if((e=e.trim()).match(/^https?:\/\//i)&&e!==this._embedUrl){if(this._embedUrl=e,this.audio)try{this.audio.fetchAbort()}catch(e){}this.showEmbed(),this.$embedLoading.show(),this.audio=new n.default(e),this.audio.getHTML().then(e=>{this.$preview.html(e),this.audio.getData().then(e=>{this.data=e,this.postbox.$textarea.trigger("input")})}).catch(e=>{this.$embedUrl.val(this._embedUrl=""),this.show(),(0,a.dialog)(e,{error:!0}).show()}).finally(()=>{this.$embedLoading.hide()})}}onUploadClick(e){this.uploadInitialized||(this.uploadInit(),this.uploadInitialized=!0);try{this.$uploadFile[0].value=null}catch(e){}this.$uploadFile.click()}uploadInit(){this.$uploadFile||(this.$uploadFile=this.$upload.find(".ps-js-file"),this.$uploadFile.psFileupload({replaceFileInput:!1,dropZone:this.$uploadBtn,add:(e,t)=>{let o=t,i=this.$uploadProgress.find(".ps-js-percent-bar"),s=this.$uploadProgress.find(".ps-js-percent");this.showUpload(),s.html(""),i.css({transition:"",width:1}),this.audio=new n.default(o),this.audio.on("progress",d.default.throttle(e=>{let t=+e,o=Math.min(100,+e);0<t&&t<100&&(t=t.toFixed(2)),s.html(t+"%"),i.css({transition:"width 1s",width:o+"%"}),100===o&&setTimeout(()=>{this.$uploadProgress.hide()},1500)},a.browser.isIOS()?1500:250)),this.audio.getHTML().then(()=>{this.$uploadDone.show(),this.audio.getData().then(e=>{this.data=e,this.postbox.$textarea.trigger("input")})}).catch(e=>{this.show(),e?e.errors&&(e=e.errors):e="Undefined error.",(0,a.dialog)(e).error()})}}))}}})}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../audio":6}],12:[function(i,e,s){!function(o){!function(){Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var t=e("undefined"!=typeof window?window.jQuery:void 0!==o?o.jQuery:null),d=e("undefined"!=typeof window?window._:void 0!==o?o._:null),a=((e,t)=>{if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};if((t=r(t))&&t.has(e))return t.get(e);var o,i,s={__proto__:null},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(o in e)"default"!==o&&{}.hasOwnProperty.call(e,o)&&((i=d?Object.getOwnPropertyDescriptor(e,o):null)&&(i.get||i.set)?Object.defineProperty(s,o,i):s[o]=e[o]);return s.default=e,t&&t.set(e,s),s})("undefined"!=typeof window?window.peepso:void 0!==o?o.peepso:null),n=e(i("../audio"));function r(e){var t,o;return"function"!=typeof WeakMap?null:(t=new WeakMap,o=new WeakMap,(r=function(e){return e?o:t})(e))}function e(e){return e&&e.__esModule?e:{default:e}}s.default=class{constructor(e){this.config=window.peepsoaudiodata||{},this.$postbox=e,this.$postboxTab=this.$postbox.$posttabs,this.$postboxStatusTextarea=this.$postbox.$textarea,this.$postboxStatus=this.$postboxStatusTextarea.closest(".ps-postbox-status"),this.$postboxAudio=this.$postbox.find(".ps-postbox-tabs [data-tab-id=audio]"),this.$postboxAudioShortcut=this.$postbox.find("#audio-post"),this.$postboxTab.on("peepso_posttabs_show-audio",()=>{this.show()}),this.$postboxTab.on("peepso_posttabs_cancel-audio",()=>{this.cancel()}),this.$postboxTab.on("peepso_posttabs_submit-audio",()=>{this.post()}),this.$postboxAudioShortcut.on("click",()=>{this.$postboxTab.find("[data-tab=audio]").click()}),a.observer.addAction("postbox_type_set",t.default.proxy(function(e,t){e===this.$postbox&&"audio"===t&&this.$postboxAudioShortcut.trigger("click")},this),10,2),this.$embed=this.$postbox.find(".ps-js-audio-embed"),this.$embedUrl=this.$embed.find(".ps-js-url"),this.$embedLoading=this.$embed.find(".ps-js-loading"),this.$embedUrl.on("input",d.default.debounce(e=>this.embed(e.target.value),2e3)),this.$embedUrl.on("paste",e=>d.default.defer(()=>this.embed(e.target.value))),this.$embedUrl.on("blur",e=>{this.$uploadBtn.off("click"),d.default.defer(()=>this.$uploadBtn.on("click",()=>this.onUploadClick())),this.embed(e.target.value)}),this.$upload=this.$postbox.find(".ps-js-audio-upload"),this.$uploadBtn=this.$upload.find(".ps-js-btn"),this.$uploadForm=this.$upload.find(".ps-js-form"),this.$uploadTitle=this.$upload.find(".ps-js-title"),this.$uploadArtist=this.$upload.find(".ps-js-artist"),this.$uploadAlbum=this.$upload.find(".ps-js-album"),this.$uploadProgress=this.$upload.find(".ps-js-progress"),this.$uploadDone=this.$upload.find(".ps-js-done"),this.$uploadFailed=this.$upload.find(".ps-js-failed"),this.$uploadSuccess=this.$upload.find(".ps-js-success"),this.$uploadBtn.on("click",()=>this.onUploadClick()),this.$separator=this.$postbox.find(".ps-js-audio-separator"),this.$preview=this.$postbox.find(".ps-js-audio-preview"),this.mode=null,this.data=null,this.$uploadTitle.on("input",d.default.throttle(()=>{this.$postbox.on_change()},500)),a.observer.addFilter("peepso_postbox_can_submit",(e,t)=>(this.$postbox===t&&"audio"===this.$postboxTab.current_tab_id&&("embed"===this.mode?e.hard.push(!!this.data):"upload"===this.mode?(t=this.$uploadTitle.val().trim(),e.hard.push(!(!this.data||!t))):e.hard.push(!1)),e),10,2),a.observer.addFilter("peepso_postbox_onsave",(e,t)=>(this.$postbox!==t||"audio"!==this.$postboxTab.current_tab_id||"upload"!==this.mode||this.data&&this.data.is_audio||(this.uploadShowNotice=!0),e),10,2),this.$postbox.on("postbox.post_saved",()=>{if(this.uploadShowNotice){delete this.uploadShowNotice;let e=this.$uploadSuccess.clone();e.show().insertAfter(this.$postbox),e.delay(3e3).fadeOut("slow",function(){e.remove()})}}),this.uploadInit(),this.uploadInitialized=!0}show(){this.mode=null,this.$postboxAudioShortcut.addClass("active"),this.$postboxAudio.show(),this.$embed.show(),this.$separator.show(),this.$upload.show(),this.$uploadBtn.show(),this.$uploadForm.hide(),this.$uploadSuccess.hide(),this.$preview.hide(),+this.config.upload_enable?this.$postboxStatus.show():(this.$postboxStatus.show(),this.mode="embed"),this.$postbox.on_change()}showEmbed(){this.mode="embed",this.$postboxStatus.show(),this.$embed.show(),this.$separator.hide(),this.$upload.hide(),this.$preview.show()}showUpload(){this.mode="upload",this.$postboxStatus.show(),this.$embed.hide(),this.$separator.hide(),this.$upload.show(),this.$uploadTitle.val(""),this.$uploadArtist.val(""),this.$uploadAlbum.val(""),this.$uploadBtn.hide(),this.$uploadForm.show(),this.$uploadProgress.show(),this.$uploadDone.hide(),this.$uploadFailed.hide(),this.$preview.show()}cancel(){this.mode=null,this.data=null,this.$postboxAudioShortcut.removeClass("active"),this.$embedUrl.val(this._embedUrl=""),this.$preview.empty(),this.$postbox.on_change()}post(){var e="postbox_req_"+this.$postbox.guid;a.observer.addFilter(e,this.postSetRequest,10,1,this),this.$postbox.save_post(),a.observer.removeFilter(e,this.postSetRequest,10)}postSetRequest(e){return"embed"===this.mode?d.default.extend(e,{type:"audio",url:this.data.url}):"upload"===this.mode&&d.default.extend(e,{type:"audio",audio:this.data.file,audio_title:this.$uploadTitle.val().trim(),audio_artist:this.$uploadArtist.val().trim(),audio_album:this.$uploadAlbum.val().trim()}),e}embed(e=""){if((e=e.trim()).match(/^https?:\/\//i)&&e!==this._embedUrl){if(this._embedUrl=e,this.audio)try{this.audio.fetchAbort()}catch(e){}this.showEmbed(),this.$embedLoading.show(),this.audio=new n.default(e),this.audio.getHTML().then(e=>{this.$preview.html(e),this.audio.getData().then(e=>{this.data=e,this.$postbox.on_change()})}).catch(e=>{this.$embedUrl.val(this._embedUrl=""),this.show(),(0,a.dialog)(e,{error:!0}).show()}).finally(()=>{this.$embedLoading.hide()})}}onUploadClick(e){this.uploadInitialized||(this.uploadInit(),this.uploadInitialized=!0);try{this.$uploadFile[0].value=null}catch(e){}this.$uploadFile.click()}uploadInit(){this.$uploadFile||(this.$uploadFile=this.$upload.find(".ps-js-file"),this.$uploadFile.psFileupload({replaceFileInput:!1,dropZone:this.$uploadBtn,add:(e,t)=>{let o=t,i=this.$uploadProgress.find(".ps-js-percent-bar"),s=this.$uploadProgress.find(".ps-js-percent");this.showUpload(),s.html(""),i.css({transition:"",width:1}),this.beforeUnloadHandler||(this.beforeUnloadHandler=()=>!0,a.observer.addFilter("beforeunload",this.beforeUnloadHandler)),this.audio=new n.default(o),this.audio.on("progress",d.default.throttle(e=>{let t=+e,o=Math.min(100,+e);0<t&&t<100&&(t=t.toFixed(2)),s.html(t+"%"),i.css({transition:"width 1s",width:o+"%"}),100===o&&setTimeout(()=>{this.$uploadProgress.hide()},1500)},a.browser.isIOS()?1500:250)),this.audio.getHTML().then(()=>{this.$uploadDone.show(),this.audio.getData().then(e=>{this.beforeUnloadHandler&&(a.observer.removeFilter("beforeunload",this.beforeUnloadHandler),this.beforeUnloadHandler=null),this.data=e,this.$postbox.on_focus(),this.$postbox.on_change()})}).catch(e=>{this.show(),e?e.errors&&(e=e.errors):e="Undefined error.",(0,a.dialog)(e).error()})}}))}}}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../audio":6}],13:[function(e,t,o){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var i=(i=e("./postbox"))&&i.__esModule?i:{default:i};e("./postbox-new");o.default=i.default},{"./postbox":15,"./postbox-new":14}],14:[function(o,e,t){!function(t){!function(){var d=e("undefined"!=typeof window?window._:void 0!==t?t._:null),a=((e,t)=>{if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};if((t=r(t))&&t.has(e))return t.get(e);var o,i,s={__proto__:null},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(o in e)"default"!==o&&{}.hasOwnProperty.call(e,o)&&((i=d?Object.getOwnPropertyDescriptor(e,o):null)&&(i.get||i.set)?Object.defineProperty(s,o,i):s[o]=e[o]);return s.default=e,t&&t.set(e,s),s})("undefined"!=typeof window?window.peepso:void 0!==t?t.peepso:null),n=e(o("../video"));function r(e){var t,o;return"function"!=typeof WeakMap?null:(t=new WeakMap,o=new WeakMap,(r=function(e){return e?o:t})(e))}function e(e){return e&&e.__esModule?e:{default:e}}a.default.class("PostboxTypeVideo",function(t,o,e){var i=o.hooks;return i.addAction("postbox_init","video",e=>new(o.class(t))(e)),class extends o.class("PostboxType"){constructor(e,t="video"){super(e,t),this.config=window.peepsovideosdata||{},this.$embed=this.$typeInput.find(".ps-js-video-embed"),this.$embedUrl=this.$embed.find(".ps-js-url"),this.$embedLoading=this.$embed.find(".ps-js-loading"),this.$embedUrl.on("input",d.default.debounce(e=>this.embed(e.target.value),2e3)),this.$embedUrl.on("paste",e=>d.default.defer(()=>this.embed(e.target.value))),this.$embedUrl.on("blur",e=>{this.$uploadBtn.off("click"),d.default.defer(()=>this.$uploadBtn.on("click",()=>this.onUploadClick())),this.embed(e.target.value)}),this.$upload=this.$typeInput.find(".ps-js-video-upload"),this.$uploadBtn=this.$upload.find(".ps-js-btn"),this.$uploadForm=this.$upload.find(".ps-js-form"),this.$uploadTitle=this.$upload.find(".ps-js-title"),this.$uploadProgress=this.$upload.find(".ps-js-progress"),this.$uploadDone=this.$upload.find(".ps-js-done"),this.$uploadFailed=this.$upload.find(".ps-js-failed"),this.$uploadSuccess=this.$upload.find(".ps-js-success"),this.$uploadBtn.on("click",()=>this.onUploadClick()),this.$separator=this.$postbox.find(".ps-js-video-separator"),this.$preview=this.$postbox.find(".ps-js-video-preview"),this.mode=null,this.data=null,this.uploadInit()}onFilterData(e,t){return t===this.postbox&&this.active&&(e.type="video","embed"===this.mode?e.url=this.data.url:"upload"===this.mode&&(e.video=this.data.file,e.video_title=this.$uploadTitle.val().trim())),e}onFilterValidate(e,t,o){return e=t===this.postbox&&this.active?"embed"===this.mode?!!o.url:"upload"===this.mode&&!!o.video:e}onFilterIsEmpty(e,t,o){return e=t===this.postbox&&this.active&&("embed"===this.mode&&o.url||"upload"===this.mode&&o.video)?!1:e}onActionReset(e){e===this.postbox&&(this.hide(),this.mode=null,this.data=null,this.$embedUrl.val(this._embedUrl=""),this.$preview.empty(),this.postbox.$textarea.trigger("click"))}show(){super.show(),this.mode=null,this.$embed.show(),this.$separator.show(),this.$upload.show(),this.$uploadBtn.show(),this.$uploadForm.hide(),this.$uploadSuccess.hide(),this.$preview.hide(),+this.config.upload_enable||(this.mode="embed")}showEmbed(){this.mode="embed",this.$embed.show(),this.$separator.hide(),this.$upload.hide(),this.$preview.show()}showUpload(){this.mode="upload",this.$embed.hide(),this.$separator.hide(),this.$upload.show(),this.$uploadTitle.val(""),this.$uploadBtn.hide(),this.$uploadForm.show(),this.$uploadProgress.show(),this.$uploadDone.hide(),this.$uploadFailed.hide(),this.$preview.show()}cancel(){this.mode=null,this.data=null,this.$embedUrl.val(this._embedUrl=""),this.$preview.empty(),this.$postbox.on_change()}post(){var e="postbox_req_"+this.$postbox.guid;a.observer.addFilter(e,this.postSetRequest,10,1,this),this.$postbox.save_post(),a.observer.removeFilter(e,this.postSetRequest,10)}postSetRequest(e){return"embed"===this.mode?d.default.extend(e,{type:"video",url:this.data.url}):"upload"===this.mode&&d.default.extend(e,{type:"video",video:this.data.file,video_title:this.$uploadTitle.val().trim()}),e}embed(e=""){if((e=e.trim()).match(/^https?:\/\//i)&&e!==this._embedUrl){if(this._embedUrl=e,this.video)try{this.video.fetchAbort()}catch(e){}this.showEmbed(),this.$embedLoading.show(),this.video=new n.default(e),this.video.getHTML().then(e=>{this.$preview.html(e),this.video.getData().then(e=>{this.data=e,this.postbox.$textarea.trigger("input")})}).catch(e=>{this.$embedUrl.val(this._embedUrl=""),this.show(),(0,a.dialog)(e,{error:!0}).show()}).finally(()=>{this.$embedLoading.hide()})}}onUploadClick(e){this.uploadInitialized||(this.uploadInit(),this.uploadInitialized=!0);try{this.$uploadFile[0].value=null}catch(e){}this.$uploadFile.click()}uploadInit(){this.$uploadFile||(this.$uploadFile=this.$upload.find(".ps-js-file"),this.$uploadFile.psFileupload({replaceFileInput:!1,dropZone:this.$uploadBtn,add:(e,t)=>{let o=t,i=this.$uploadProgress.find(".ps-js-percent-bar"),s=this.$uploadProgress.find(".ps-js-percent");this.showUpload(),s.html(""),i.css({transition:"",width:1}),this.video=new n.default(o),this.video.on("progress",d.default.throttle(e=>{let t=+e,o=Math.min(100,+e);0<t&&t<100&&(t=t.toFixed(2)),s.html(t+"%"),i.css({transition:"width 1s",width:o+"%"}),100===o&&setTimeout(()=>{this.$uploadProgress.hide()},1500)},a.browser.isIOS()?1500:250)),this.video.getHTML().then(()=>{this.$uploadDone.show(),this.video.getData().then(e=>{this.data=e,this.postbox.$textarea.trigger("input")})}).catch(e=>{this.show(),e?e.errors&&(e=e.errors):e="Undefined error.",(0,a.dialog)(e).error()})}}))}}})}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../video":21}],15:[function(i,e,s){!function(o){!function(){Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var t=e("undefined"!=typeof window?window.jQuery:void 0!==o?o.jQuery:null),d=e("undefined"!=typeof window?window._:void 0!==o?o._:null),a=((e,t)=>{if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};if((t=r(t))&&t.has(e))return t.get(e);var o,i,s={__proto__:null},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(o in e)"default"!==o&&{}.hasOwnProperty.call(e,o)&&((i=d?Object.getOwnPropertyDescriptor(e,o):null)&&(i.get||i.set)?Object.defineProperty(s,o,i):s[o]=e[o]);return s.default=e,t&&t.set(e,s),s})("undefined"!=typeof window?window.peepso:void 0!==o?o.peepso:null),n=e(i("../video"));function r(e){var t,o;return"function"!=typeof WeakMap?null:(t=new WeakMap,o=new WeakMap,(r=function(e){return e?o:t})(e))}function e(e){return e&&e.__esModule?e:{default:e}}s.default=class{constructor(e){this.config=window.peepsovideosdata||{},this.$postbox=e,this.$postboxTab=this.$postbox.$posttabs,this.$postboxStatusTextarea=this.$postbox.$textarea,this.$postboxStatus=this.$postboxStatusTextarea.closest(".ps-postbox-status"),this.$postboxVideo=this.$postbox.find(".ps-postbox-tabs [data-tab-id=videos]"),this.$postboxVideoShortcut=this.$postbox.find("#video-post"),this.$postboxTab.on("peepso_posttabs_show-videos",()=>{this.show()}),this.$postboxTab.on("peepso_posttabs_cancel-videos",()=>{this.cancel()}),this.$postboxTab.on("peepso_posttabs_submit-videos",()=>{this.post()}),this.$postboxVideoShortcut.on("click",()=>{this.$postboxTab.find("[data-tab=videos]").click()}),a.observer.addAction("postbox_type_set",t.default.proxy(function(e,t){e===this.$postbox&&"videos"===t&&this.$postboxVideoShortcut.trigger("click")},this),10,2),this.$embed=this.$postbox.find(".ps-js-video-embed"),this.$embedUrl=this.$embed.find(".ps-js-url"),this.$embedLoading=this.$embed.find(".ps-js-loading"),this.$embedUrl.on("input",d.default.debounce(e=>this.embed(e.target.value),2e3)),this.$embedUrl.on("paste",e=>d.default.defer(()=>this.embed(e.target.value))),this.$embedUrl.on("blur",e=>{this.$uploadBtn.off("click"),d.default.defer(()=>this.$uploadBtn.on("click",()=>this.onUploadClick())),this.embed(e.target.value)}),this.$upload=this.$postbox.find(".ps-js-video-upload"),this.$uploadBtn=this.$upload.find(".ps-js-btn"),this.$uploadForm=this.$upload.find(".ps-js-form"),this.$uploadTitle=this.$upload.find(".ps-js-title"),this.$uploadProgress=this.$upload.find(".ps-js-progress"),this.$uploadDone=this.$upload.find(".ps-js-done"),this.$uploadFailed=this.$upload.find(".ps-js-failed"),this.$uploadSuccess=this.$upload.find(".ps-js-success"),this.$uploadBtn.on("click",()=>this.onUploadClick()),this.$separator=this.$postbox.find(".ps-js-video-separator"),this.$preview=this.$postbox.find(".ps-js-video-preview"),this.mode=null,this.data=null,this.$uploadTitle.on("input",d.default.throttle(()=>{this.$postbox.on_change()},500)),a.observer.addFilter("peepso_postbox_can_submit",(e,t)=>(this.$postbox===t&&"videos"===this.$postboxTab.current_tab_id&&("embed"===this.mode?e.hard.push(!!this.data):"upload"===this.mode?(t=this.$uploadTitle.val().trim(),e.hard.push(!(!this.data||!t))):e.hard.push(!1)),e),10,2),a.observer.addFilter("peepso_postbox_onsave",(e,t)=>(this.$postbox!==t||"videos"!==this.$postboxTab.current_tab_id||"upload"!==this.mode||this.data&&this.data.is_audio||(this.uploadShowNotice=!0),e),10,2),this.$postbox.on("postbox.post_saved",()=>{if(this.uploadShowNotice){delete this.uploadShowNotice;let e=this.$uploadSuccess.clone();e.show().insertAfter(this.$postbox),e.delay(3e3).fadeOut("slow",function(){e.remove()})}}),this.uploadInit(),this.uploadInitialized=!0}show(){this.mode=null,this.$postboxVideoShortcut.addClass("active"),this.$postboxVideo.show(),this.$embed.show(),this.$separator.show(),this.$upload.show(),this.$uploadBtn.show(),this.$uploadForm.hide(),this.$uploadSuccess.hide(),this.$preview.hide(),+this.config.upload_enable?this.$postboxStatus.show():(this.$postboxStatus.show(),this.mode="embed"),this.$postbox.on_change()}showEmbed(){this.mode="embed",this.$postboxStatus.show(),this.$embed.show(),this.$separator.hide(),this.$upload.hide(),this.$preview.show()}showUpload(){this.mode="upload",this.$postboxStatus.show(),this.$embed.hide(),this.$separator.hide(),this.$upload.show(),this.$uploadTitle.val(""),this.$uploadBtn.hide(),this.$uploadForm.show(),this.$uploadProgress.show(),this.$uploadDone.hide(),this.$uploadFailed.hide(),this.$preview.show()}cancel(){this.mode=null,this.data=null,this.$postboxVideoShortcut.removeClass("active"),this.$embedUrl.val(this._embedUrl=""),this.$preview.empty(),this.$postbox.on_change()}post(){var e="postbox_req_"+this.$postbox.guid;a.observer.addFilter(e,this.postSetRequest,10,1,this),this.$postbox.save_post(),a.observer.removeFilter(e,this.postSetRequest,10)}postSetRequest(e){return"embed"===this.mode?d.default.extend(e,{type:"video",url:this.data.url}):"upload"===this.mode&&d.default.extend(e,{type:"video",video:this.data.file,video_title:this.$uploadTitle.val().trim()}),e}embed(e=""){if((e=e.trim()).match(/^https?:\/\//i)&&e!==this._embedUrl){if(this._embedUrl=e,this.video)try{this.video.fetchAbort()}catch(e){}this.showEmbed(),this.$embedLoading.show(),this.video=new n.default(e),this.video.getHTML().then(e=>{this.$preview.html(e),this.video.getData().then(e=>{this.data=e,this.$postbox.on_change()})}).catch(e=>{this.$embedUrl.val(this._embedUrl=""),this.show(),(0,a.dialog)(e,{error:!0}).show()}).finally(()=>{this.$embedLoading.hide()})}}onUploadClick(e){this.uploadInitialized||(this.uploadInit(),this.uploadInitialized=!0);try{this.$uploadFile[0].value=null}catch(e){}this.$uploadFile.click()}uploadInit(){this.$uploadFile||(this.$uploadFile=this.$upload.find(".ps-js-file"),this.$uploadFile.psFileupload({replaceFileInput:!1,dropZone:this.$uploadBtn,add:(e,t)=>{let o=t,i=this.$uploadProgress.find(".ps-js-percent-bar"),s=this.$uploadProgress.find(".ps-js-percent");this.showUpload(),s.html(""),i.css({transition:"",width:1}),this.beforeUnloadHandler||(this.beforeUnloadHandler=()=>!0,a.observer.addFilter("beforeunload",this.beforeUnloadHandler)),this.video=new n.default(o),this.video.on("progress",d.default.throttle(e=>{let t=+e,o=Math.min(100,+e);0<t&&t<100&&(t=t.toFixed(2)),s.html(t+"%"),i.css({transition:"width 1s",width:o+"%"}),100===o&&setTimeout(()=>{this.$uploadProgress.hide()},1500)},a.browser.isIOS()?1500:250)),this.video.getHTML().then(()=>{this.$uploadDone.show(),this.video.getData().then(e=>{this.beforeUnloadHandler&&(a.observer.removeFilter("beforeunload",this.beforeUnloadHandler),this.beforeUnloadHandler=null),this.data=e,this.$postbox.on_focus(),this.$postbox.on_change()})}).catch(e=>{this.show(),e?e.errors&&(e=e.errors):e="Undefined error.",(0,a.dialog)(e).error()})}}))}}}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../video":21}],16:[function(r,e,l){!function(n){!function(){Object.defineProperty(l,"__esModule",{value:!0}),l.default=void 0;var e=o("undefined"!=typeof window?window.jQuery:void 0!==n?n.jQuery:null),t=o(r("eventemitter3"));function o(e){return e&&e.__esModule?e:{default:e}}let i=peepsodata.peepso_nonce,s=peepsovideosdata.upload_url,d=peepsovideosdata.nonce;class a extends t.default{constructor(e,t={}){e=e.files[0];if(super(),this.data=new FormData,this.data.append("filedata",e),this.data.append("size",e.size),this.data.append("name",e.name),this.data.append("_wpnonce",d),"object"==typeof t.data)for(var o in t.data)this.data.append(o,t.data[o])}upload(){return new Promise((t,o)=>{e.default.ajax({url:s,data:this.data,beforeSend:function(e){e.setRequestHeader("X-PeepSo-Nonce",i)},processData:!1,contentType:!1,dataType:"json",type:"POST",xhr:()=>{let e=null;return(e=window.ActiveXObject?new window.ActiveXObject("Microsoft.XMLHTTP"):new window.XMLHttpRequest).upload.addEventListener("progress",e=>{e.lengthComputable&&(e=+(100*e.loaded/e.total).toFixed(2),this.emit("progress",e))},!1),e}}).done(e=>{e.success?t(e.data):o(e)}).fail((e,t)=>{o(t)})})}}l.default=a}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{eventemitter3:23}],17:[function(e,t,o){arguments[4][2][0].apply(o,arguments)},{dup:2,eventemitter3:23}],18:[function(d,e,a){!function(s){!function(){Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var e=o("undefined"!=typeof window?window.peepso:void 0!==s?s.peepso:null),t=o(d("./abstract"));function o(e){return e&&e.__esModule?e:{default:e}}class i extends t.default{fetch(){return new Promise((t,o)=>{this.data?t(this.data):this.xhr=e.default.postJson("videosajax.get_preview",{url:this.source},e=>{e.success?(this.data=e.data,t(this.data)):o(e&&e.errors&&e.errors[0])}).ret})}fetchAbort(){this.xhr&&(this.xhr.abort(),this.xhr=void 0)}}a.default=i}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./abstract":17}],19:[function(e,t,o){arguments[4][4][0].apply(o,arguments)},{"./embed":18,dup:4}],20:[function(e,t,o){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var i=d(e("./abstract")),s=d(e("../uploader"));function d(e){return e&&e.__esModule?e:{default:e}}class a extends i.default{fetch(){return new Promise((t,o)=>{this.data?t(this.data):this.validate().then(()=>{this.upload().then(e=>{this.data=_.extend({},e,{html:`<iframe src="${e.link}embed" />`}),t(this.data)}).catch(e=>{o(e)})}).catch(e=>{o(e)})})}validate(){return new Promise((t,o)=>{var e=this.source.files[0],e={type:e.type,size:parseInt(e.size)};peepso.postJson("videosajax.validate_video_upload",e,e=>{e&&e.success?t():o(e&&e.errors&&e.errors[0])})})}upload(){return new Promise((t,o)=>{var e=new s.default(this.source);e.on("progress",e=>{this.emit("progress",e)}),e.upload().then(e=>{t(e)}).catch(e=>{o(e)})})}}o.default=a},{"../uploader":16,"./abstract":17}],21:[function(e,t,o){arguments[4][6][0].apply(o,arguments)},{"./embed":18,"./facebook":19,"./file":20,dup:6,eventemitter3:23}],22:[function(i,e,t){!function(o){!function(){var s,e,n=t("undefined"!=typeof window?window.jQuery:void 0!==o?o.jQuery:null),r=((e,t)=>{if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};if((t=a(t))&&t.has(e))return t.get(e);var o,i,s={__proto__:null},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(o in e)"default"!==o&&{}.hasOwnProperty.call(e,o)&&((i=d?Object.getOwnPropertyDescriptor(e,o):null)&&(i.get||i.set)?Object.defineProperty(s,o,i):s[o]=e[o]);return s.default=e,t&&t.set(e,s),s})("undefined"!=typeof window?window.peepso:void 0!==o?o.peepso:null),d=t(i("./uploader"));function a(e){var t,o;return"function"!=typeof WeakMap?null:(t=new WeakMap,o=new WeakMap,(a=function(e){return e?o:t})(e))}function t(e){return e&&e.__esModule?e:{default:e}}window.ps_videos=r.default.videos=(window.PsVideos=function(){this._fileList=[],this.show_progress=null,this.queue_filesize=0,this.$url_textarea=null,this.$uploader=null,this.has_valid_url=!1,this.preview_request=!1,this.save_post=null,this.last_error=null},e=new PsVideos,PsVideos.prototype.init=function(){var i=this,e=(r.observer.addFilter("peepso_postbox_can_submit",function(e){return"videos"===i.$postbox.$posttabs.current_tab_id&&e.hard.push(s||!!i.has_valid_url),e},30,1),this.$postbox.$textarea.attr("placeholder"));jQuery(this.$postbox.$posttabs).on("peepso_posttabs_show-videos",function(e,t,o){jQuery("#video-post",i.$postbox).hide(),t.show(),void 0!==postbox.$textarea&&postbox.$textarea.attr("placeholder","Say something about this video..."),jQuery(".ps-postbox-status",o.options.container).show()}),this.$url_textarea=jQuery(".ps-videos-url",this.$postbox),this.$uploader=jQuery("[data-tab-id=videos]").find("#ps-upload-container > div").eq(0),this.$postbox.$posttabs.on("peepso_posttabs_submit-videos",function(){s||i.has_valid_url?(r.observer.addFilter("postbox_req_"+i.$postbox.guid,function(e){return i.set_post_filter(e)},10,1),i.$postbox.save_post(),r.observer.removeFilter("postbox_req_"+i.$postbox.guid,function(e){return i.set_post_filter(e)},10,1)):null!==i.last_error&&alert(i.last_error)}),this.$postbox.$posttabs.on("peepso_posttabs_cancel-videos",function(){jQuery("#video-post",i.$postbox).show(),i.$postbox.$textarea.attr("placeholder",e),i.on_cancel()}),jQuery("#video-post",this.$postbox).on("click",function(){"videos"!==i.$postbox.$posttabs.current_tab().data("tab")&&(jQuery(i.$postbox.$posttabs).find("[data-tab='videos']").trigger("click"),i.$postbox.$textarea.focus())}),this.$url_textarea.on("change",function(){i.on_url_input(i.$url_textarea.val())}),this.$uploader.on("click",function(){i.browseFile()}),r.observer.addFilter("postbox_req_edit",function(e,t){var o=jQuery(".ps-videos-edit-url",this.$postbox);return 0<o.length&&(e.url=o.val(),e.type="video"),e},10,2),this.save_post=jQuery.proxy(activity.option_savepost,activity),activity.option_savepost=function(e){i.option_savepost(e)}},PsVideos.prototype.on_url_input=function(e){var s=this.$postbox.find(".ps-postbox-videos .ps-postbox-input .ps-postbox-loading"),d=this.$postbox.find(".ps-postbox-videos .ps-postbox-preview"),a=this.$postbox.find(".ps-postbox-action > .ps-button-action.postbox-submit");this.preview_request&&this.preview_request.ret&&this.preview_request.ret.abort(),s.show(),this.preview_request=r.default.postJson("videosajax.get_preview",{url:e},n.default.proxy(function(e){var t,o,i=/<div[^<]+fb-root[^<]+<[^>]+>/i;s.hide(),e.success?(this.has_valid_url=!0,(o=(t=e.data.html).match(i))&&(t=(t=t.replace(i,"")).replace(/<script[^<]+<\/script>/i,"")),d.empty().show().html(t),o&&r.default.util.fbParseXFBML()):(this.has_valid_url=!1,d.hide().empty(),a.hide(),e.errors&&(this.last_error=e.errors[0],alert(this.last_error))),this.$postbox.on_change(),this.preview_request=!1},this))},PsVideos.prototype.set_postbox=function(e){this.$postbox=e},PsVideos.prototype.on_cancel=function(){this.preview_request&&(this.preview_request.ret.abort(),jQuery(".ps-postbox-videos .ps-postbox-input .ps-postbox-loading",this.$postbox).hide()),this.has_valid_url=!1,jQuery("#ps-videos-input",this.$postbox).hide(),this.$url_textarea.val(""),s=!1,jQuery(".ps-postbox-videos .ps-postbox-preview",this.$postbox).hide().html(""),this.$postbox.on_change()},PsVideos.prototype.set_post_filter=function(e){return s?e.video_id=s:e.url=this.$url_textarea.val(),e.type="video",console.log(e),e},PsVideos.prototype.play_video=function(e,t){var o;return"vimeo"===(t=t||{}).type?this.play_vimeo_video(e,t):($player=jQuery("#peepso-video-player-"+jQuery(e).data("post-id")).find("iframe"),jQuery("#peepso-video-player-"+jQuery(e).data("post-id")).fadeIn(),(t=jQuery(e).parents(".video-avatar")).siblings(".video-description").css("display","block"),e=((e=jQuery("#peepso-video-player-"+jQuery(e).data("post-id")).parent()).show(),t.parent().prepend(e),t.fadeOut().remove(),$player.width()),$player.width()/$player.height()<$player.parent().width()/$player.parent().height()?(o={width:"100%"},$player.css(o),new_width=$player.width(),$player.css("height",$player.height()*(new_width/e))):o={width:"100%",height:"390"},$player.css(o)),!1},PsVideos.prototype.play_vimeo_video=function(e,t){var o=(e=(0,n.default)(e)).closest(".ps-media-video");o.length&&(o=o.prev(".cstream-attachment")).length&&(o.find("iframe").length||(0,n.default)('<iframe src="https://player.vimeo.com/video/'+t.id+'?autoplay=1" width="500" height="281" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen style="width:100%"></iframe>').appendTo(o),(t=e.closest(".video-avatar")).siblings(".video-description").css("display","block"),t.remove(),o.show())},PsVideos.prototype.option_savepost=function(t){var e,o=this,i=jQuery(".ps-js-activity--"+t);0<i.length&&void 0!==(e=r.observer.applyFilters("postbox_req_edit",{},jQuery(".cstream-edit textarea",i))).type&&void 0!==e.url&&"video"===e.type?(jQuery(".cstream-edit textarea, .cstream-edit input",i).attr("disabled","disabled"),jQuery(".ps-edit-loading",i).show(),jQuery(".cstream-edit button",i).hide(),r.default.postJson("videosajax.get_preview",{url:e.url},function(e){void 0!==e.errors?(alert(e.errors[0]),jQuery(".cstream-edit textarea, .cstream-edit input",i).removeAttr("disabled"),jQuery(".ps-edit-loading",i).hide(),jQuery(".cstream-edit button",i).show()):o.save_post(t)})):this.save_post(t)},PsVideos.prototype.browseFile=function(){var e,i=this;this.$file||(this.$file=(0,n.default)('<input type="file" name="filedata[]" accept="video/mp4,video/x-m4v,video/*" />'),(e=(0,n.default)("<div />").append(this.$file)).css({position:"absolute",top:0,right:0,width:1,height:1,overflow:"hidden"}),e.insertAfter(this.$uploader),this.$file.on("change",function(e){var t=e.target,o=t.files[0];e.preventDefault(),i.validate(o).then(function(){new d.default(t).upload().then(function(e){s=e.id})}).fail(function(e){alert(e[0])})})),this.$file.click()},PsVideos.prototype.validate=function(o){return n.default.Deferred(function(t){var e={type:o.type,size:parseInt(o.size)};r.default.postJson("videosajax.validate_video_upload",e,function(e){e&&e.success?t.resolve():t.reject(e&&e.errors)})})},e),r.observer.addAction("postbox_init",function(e){e.$tabContext.find("#audio-post").remove(),e.$tabContext.find("#video-post").remove()},10,1),r.observer.addAction("peepso_delete_post",function(e){(0,n.default)(".ps-widget--videos").find(".ps-js-video").filter('[data-post-id="'+e+'"]').remove()},10,1)}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./uploader":16}],23:[function(e,t,o){var i=Object.prototype.hasOwnProperty,c="~";function s(){}function d(e,t,o){this.fn=e,this.context=t,this.once=o||!1}function a(e,t,o,i,s){if("function"!=typeof o)throw new TypeError("The listener must be a function");o=new d(o,i||e,s),i=c?c+t:t;return e._events[i]?e._events[i].fn?e._events[i]=[e._events[i],o]:e._events[i].push(o):(e._events[i]=o,e._eventsCount++),e}function r(e,t){0==--e._eventsCount?e._events=new s:delete e._events[t]}function n(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(c=!1)),n.prototype.eventNames=function(){var e,t,o=[];if(0===this._eventsCount)return o;for(t in e=this._events)i.call(e,t)&&o.push(c?t.slice(1):t);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(e)):o},n.prototype.listeners=function(e){var e=c?c+e:e,t=this._events[e];if(!t)return[];if(t.fn)return[t.fn];for(var o=0,i=t.length,s=new Array(i);o<i;o++)s[o]=t[o].fn;return s},n.prototype.listenerCount=function(e){e=c?c+e:e,e=this._events[e];return e?e.fn?1:e.length:0},n.prototype.emit=function(e,t,o,i,s,d){var a=c?c+e:e;if(!this._events[a])return!1;var n,r=this._events[a],l=arguments.length;if(r.fn){switch(r.once&&this.removeListener(e,r.fn,void 0,!0),l){case 1:return r.fn.call(r.context),!0;case 2:return r.fn.call(r.context,t),!0;case 3:return r.fn.call(r.context,t,o),!0;case 4:return r.fn.call(r.context,t,o,i),!0;case 5:return r.fn.call(r.context,t,o,i,s),!0;case 6:return r.fn.call(r.context,t,o,i,s,d),!0}for(h=1,n=new Array(l-1);h<l;h++)n[h-1]=arguments[h];r.fn.apply(r.context,n)}else for(var p,u=r.length,h=0;h<u;h++)switch(r[h].once&&this.removeListener(e,r[h].fn,void 0,!0),l){case 1:r[h].fn.call(r[h].context);break;case 2:r[h].fn.call(r[h].context,t);break;case 3:r[h].fn.call(r[h].context,t,o);break;case 4:r[h].fn.call(r[h].context,t,o,i);break;default:if(!n)for(p=1,n=new Array(l-1);p<l;p++)n[p-1]=arguments[p];r[h].fn.apply(r[h].context,n)}return!0},n.prototype.on=function(e,t,o){return a(this,e,t,o,!1)},n.prototype.once=function(e,t,o){return a(this,e,t,o,!0)},n.prototype.removeListener=function(e,t,o,i){e=c?c+e:e;if(this._events[e])if(t){var s=this._events[e];if(s.fn)s.fn!==t||i&&!s.once||o&&s.context!==o||r(this,e);else{for(var d=0,a=[],n=s.length;d<n;d++)(s[d].fn!==t||i&&!s[d].once||o&&s[d].context!==o)&&a.push(s[d]);a.length?this._events[e]=1===a.length?a[0]:a:r(this,e)}}else r(this,e);return this},n.prototype.removeAllListeners=function(e){return e?(e=c?c+e:e,this._events[e]&&r(this,e)):(this._events=new s,this._eventsCount=0),this},n.prototype.off=n.prototype.removeListener,n.prototype.addListener=n.prototype.on,n.prefixed=c,n.EventEmitter=n,void 0!==t&&(t.exports=n)},{}]},{},[8]);